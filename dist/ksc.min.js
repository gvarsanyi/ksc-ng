var __hasProp={}.hasOwnProperty,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;ksc=angular.module("ksc",[]),ksc.factory("ksc.ArrayTracker",["ksc.error","ksc.util",function(e,t){var r,n,o,u;return n=t.defineGetSet,o=t.defineValue,u=t.hasOwn,r=function(){function t(r,i,s,a){var l,c,p,f,d,y,h,g;null==i&&(i={}),u(r,"_tracker")&&e.Value({list:r,description:"List is already tracked"}),Array.isArray(r)||e.Type({list:r,description:"Must be an array"}),"object"!=typeof i&&e.Type({store:i,description:"Must be an object"}),d=this,o(r,"_tracker",d),o(d,"list",r,0,1),o(d,"store",i,0,1),c=function(t){return null!=t?"function"!=typeof t&&e.Type({fn:t,"Must be a function":"Must be a function"}):t=null,t},a=c(a),s=c(s),n(d,"get",function(){return a},function(e){return a=c(e)},1),n(d,"set",function(){return s},function(e){return s=c(e)},1);for(f in t)l=t[f],"_"===f.substr(0,1)&&!function(e){return o(r,e.substr(1),function(){var r;return r=1<=arguments.length?__slice.call(arguments,0):[],t[e].apply(d,r)})}(f);for(p=h=0,g=r.length;g>h;p=++h)y=r[p],t.getterify(d,p),t.set(d,p,y)}return t.prototype.get=void 0,t.prototype.list=void 0,t.prototype.set=void 0,t.prototype.store=void 0,t.getterify=function(e,r){return n(e.list,r,function(){return t.get(e,r)},function(n){return t.set(e,r,n)},1)},t.get=function(e,t){return e.get?e.get(t,e.store[t]):e.store[t]},t.set=function(e,t,r){var n;return n=function(){return arguments.length&&(r=arguments[0]),e.store[t]===r?!1:(e.store[t]=r,!0)},e.set?e.set(t,r,n):n()},t.add=function(e,r,n){var o,u,i,s,a,l,c,p,f,d;for(s=e.list,l=e.store,i=r.length,a=s.length,o=c=d=a-1;c>=n;o=c+=-1)l[o+i]=l[o];for(o=p=0,f=r.length;f>p;o=++p)u=r[o],s[o+a]=null,t.getterify(e,o+a),t.set(e,o+n,u);return s.length},t._pop=function(){var e,t,r,n;return t=this.list,n=this.store,(e=t.length-1)>-1?(r=t[e],t.length=e,delete n[e],r):void 0},t._shift=function(){var e,t,r,n,o,u;if(r=this.list,o=this.store,(t=r.length-1)>-1){for(n=r[0],e=u=1;t>=u;e=u+=1)o[e-1]=o[e];return r.length=t,delete o[t],n}},t._push=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],t.add(this,e,this.list.length)},t._unshift=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],t.add(this,e,0)},t._splice=function(){var e,r,n,o,u,i,s,a,l,c,p;if(n=arguments[0],e=arguments[1],o=3<=arguments.length?__slice.call(arguments,2):[],u=this.list,a=this.store,s=[],i=u.length,n=parseInt(n,10)||0,n=0>n?Math.max(0,i+n):Math.min(n,i),e=parseInt(e,10)||0,e=Math.max(0,Math.min(e,i-n))){for(r=l=n,p=n+e;p>l;r=l+=1)s.push(u[r]),delete a[i+r-n];for(r=c=n;i>c;r=c+=1)a[r]=a[r+e];u.length=i-e}return o.length&&t.add(this,o,n),s},t._sort=function(){var e,r,n,o,u,i,s,a,l,c,p,f;for(e=1<=arguments.length?__slice.call(arguments,0):[],f=a=this,u=f.list,s=f.store,r=function(){var e,t,r;for(r=[],n=e=0,t=u.length;t>e;n=e+=1)r.push(s[n]);return r}(),u.length=0,Array.prototype.push.apply(u,r),i=Array.prototype.sort.apply(u,e),o=c=0,p=u.length;p>c;o=++c)l=u[o],t.getterify(a,o),t.set(a,o,l);return i},t}()}]),ksc.service("ksc.batchLoaderRegistry",["ksc.error","ksc.util",function(e,t){var r;return new(r=function(){function r(){}return r.prototype.map={},r.prototype.get=function(e,t){var r,n,o,u;u=this.map;for(r in u)if(n=u[r],o=n.get(e,t))return o;return!1},r.prototype.register=function(r){var n;return"string"==typeof(n=null!=r?r.endpoint:void 0)&&t.isKeyConform(n)||e.Key({endpoint:n,required:"url"}),this.map[n]&&e.Key({endpoint:n,description:"already registered"}),this.map[n]=r},r.prototype.unregister=function(e){return this.map[e.endpoint]?delete this.map[e.endpoint]:!1},r}())}]),ksc.factory("ksc.BatchLoader",["$http","$q","ksc.batchLoaderRegistry","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s;return i=n.ArgumentType,s=o.isObject,u=function(){function u(e,t){var u,a,l,c,p;this.endpoint=e,this.map=t,a=this,e&&"string"==typeof e||i({endpoint:e,required:"string"}),s(t)||i({map:t,required:"object"});for(u in t)p=t[u],"string"==typeof p&&u||n.Type({key:u,url:p,required:"url string"});l=!0,c=function(e){return l&&!e&&a.flush(),l=!!e},o.defineGetSet(a,"open",function(){return l},c,1),o.defineValue(a,"requests",[],0,1),r.register(a)}return u.prototype.endpoint=null,u.prototype.map=null,u.prototype.open=!0,u.prototype.requests=null,u.prototype.get=function(e,r){var n,o,u,a,l,c,p;if(u=this,l=u.requests,e&&"string"==typeof e||i({url:e,required:"string"}),null==r||s(r)||i({query_parameters:r,required:"object"}),!u.open)return!1;p=u.map;for(o in p)if(c=p[o],e===c){a=o;break}return a?(n=t.defer(),l.push({resource:a,deferred:n}),r&&(l[l.length-1].query=r),n.promise):!1},u.prototype.flush=function(){var t,r,n,o,u,i,s;for(n=this,u=n.requests,r=[],i=0,s=u.length;s>i;i++)o=u[i],o.deferred&&(r.push(o.deferred),delete o.deferred);return r.length?(t=e.put(n.endpoint,u),t.success(function(e,t,n,o){var u,i,s,a,l,c,p;for(i=l=0,c=r.length;c>l;i=++l)u=r[i],null!=(a=e[i])?(s={data:a.body,status:a.status,headers:n,config:o},200<=(p=a.status)&&400>p?u.resolve(s):u.reject(s)):u.reject({data:e,status:t,headers:n,config:o})}),t.error(function(e,t,n,o){var u,i,s;for(i=0,s=r.length;s>i;i++)u=r[i],u.reject({data:e,status:t,headers:n,config:o})})):!1},u}()}]),ksc.factory("ksc.EditableRecord",["ksc.Record","ksc.error","ksc.util",function(e,t,r){var n,o,u,i,s,a,l,c,p,f,d,y,h,g;return o="_changes",n="_changedKeys",u="_deletedKeys",i="_edited",s="_events",l="_options",c="_parent",p="_parentKey",f="_saved",d=r.defineValue,y=r.hasOwn,h=r.isEnumerable,g=r.isObject,a=function(a){function _(e,r,n,o){null==e&&(e={}),null==r&&(r={}),g(r)||t.ArgumentType({options:r,argument:2,required:"object"}),r.subtreeClass=_,_.__super__.constructor.call(this,e,r,n,o)}return __extends(_,a),_.prototype._changedKeys=null,_.prototype._changes=0,_.prototype._deletedKeys=null,_.prototype._edited=null,_.prototype._clone=function(t,r){var o,i,s,a,l,c;if(null==t&&(t=!1),null==r&&(r=!1),a=this,t){o={},l=r?a[f]:a;for(s in l)c=l[s],c instanceof e&&(c=c._clone(!0,r)),o[s]=c;return o}if(o=new a.constructor(a[f]),!r){for(s in a)(a[n][s]||!y(a[f],s))&&(c=a[s],g(c)&&(c=c._clone(!0)),o[s]=c);if(i=a[u])for(s in a[u])o._delete(s)}return o},_.prototype._delete=function(){var s,a,c,p,g,_,m,v,b;for(_=1<=arguments.length?__slice.call(arguments,0):[],_.length||t.MissingArgument({name:"key",argument:1}),m=this,s=[],c=v=0,b=_.length;b>v;c=++v)if(g=_[c],r.isKeyConform(g)||t.Key({key:g,argument:c,required:"key conform value"}),!c&&(a=m[l].contract)&&t.ContractBreak({key:g,value:value,contract:a[g]}),((p=m[l].idProperty)===g||p instanceof Array&&__indexOf.call(p,g)>=0)&&t.Permission({key:g,description:"._options.idProperty keys can not be deleted"}),y(m[f],g)){if(m[u][g])continue;m[u][g]=!0,m[n][g]||(d(m,o,m[o]+1),d(m[n],g,!0,0,1)),delete m[i][g],Object.defineProperty(m,g,{enumerable:!1}),s.push(g)}else y(m,g)&&(h(m,g)||t.Key({key:g,description:"can not be changed"}),delete m[g],s.push(g));return s.length&&e.emitUpdate(m,"delete",{keys:s}),!!s.length},_.prototype._replace=function(e){var t,r,n,o;o=this,(n=o[s])&&n.halt();try{return r=o._revert(!1),t=_.__super__._replace.call(this,e,!1)}catch(u){}},_.prototype._revert=function(t){var r,s,a;null==t&&(t=!0),r=!1,a=this;for(s in a[u])delete a[u][s],delete a[n][s],r=!0;for(s in a[i])delete a[i][s],delete a[n][s],r=!0;for(s in a)y(a[f],s)||(delete a[s],r=!0);return r&&t&&(d(a,o,0),e.emitUpdate(a,"revert")),r},_.setProperty=function(s,a){var m,v,b,k,O,j;O=s[f],v=s[i],k=s[l],m=k.contract,b=function(){return m||!s[u][a]?y(v,a)?v[a]:O[a]:void 0},j=function(u){var i,f,b,k,j,P,w,A;if("function"==typeof u&&t.Type({update:u,description:"must not be function"}),((f=s[l].idProperty)===a||f instanceof Array&&__indexOf.call(f,a)>=0)&&null!==u&&"string"!=(A=typeof u)&&"number"!==A&&t.Value({update:u,required:"string or number or null"}),r.identical(O[a],u))delete v[a],i=!0;else if(!r.identical(v[a],u)){if(null!=m&&m._match(a,u),k=u,g(u)){if(g(O[a])){k=O[a];for(b in k)h(k,b)&&!y(u,b)&&k._delete(b)}else j={},m&&(j.contract=m[a].contract),k=new _({},j,s,a);for(b in u)P=u[b],k[b]=P}v[a]=k,i=!0}return v[a]===O[a]&&delete v[a],w=s[n][a],g(O[a])&&O[a]._changes||y(v,a)&&!r.identical(O[a],v[a])?w||(d(s,o,s[o]+1),d(s[n],a,!0,0,1)):w&&(d(s,o,s[o]-1),delete s[n][a]),i?(s[p]&&_.subChanges(s[c],s[p],s[o]),Object.defineProperty(s,a,{enumerable:!0}),e.emitUpdate(s,"set",{key:a})):void 0},r.defineGetSet(s,a,b,j,1)},_.subChanges=function(e,t,r){var u;e[n][t]?r||(d(e,o,e[o]-1),delete e[n][t],u=!0):r&&(d(e,o,e[o]+1),d(e[n],t,!0,0,1),u=!0),u&&e[p]&&_.subChanges(e[c],e[p],e[o])},_}(e)}]),ksc.factory("ksc.EditableRestRecord",["$http","ksc.EditableRecord","ksc.Mixin","ksc.RestRecord",function(e,t,r,n){var o;return o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),r.extend(o,n),o.prototype._restSave=function(t){var r;return r=o.getUrl(this),o.async(this,e.put(r,this._entity()),t)},o}(t)}]),ksc.service("ksc.error",function(){var e,t,r,n,o,u,i,s,a,l,c,p,f,d;r=function(e){function t(e){var t,r,n;if(r="",e&&"object"==typeof e)for(t in e){n=e[t];try{n=JSON.stringify(n,null,2)}catch(o){n=String(n)}r+="\n  "+t+": "+n}else null!=e&&(r+=String(e));this.message=r}return __extends(t,e),t}(Error),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),n=function(){function r(){}return r.ArgumentType=e,r.ContractBreak=t,r.Http=o,r.Key=u,r.MissingArgument=i,r.Permission=s,r.Type=a,r.Value=l,r}(),p={type:n},d=function(e){return p[f]=function(t){throw new e(t)}};for(f in n)c=n[f],c.prototype.name=f+"Error",d(c);return p}),ksc.factory("ksc.EventEmitter",["$interval","$rootScope","$timeout","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s,a,l,c,p,f;return s="__unsubscriber__",a=n.ArgumentType,l=o.isFunction,c=o.isObject,i=function(){function e(){}return e.prototype.names=null,e.prototype.emit=function(){var e,t,r,n,o,u,i,s,a,c,p,f;for(u=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i=null!=this.names?this.names:this.names={},t=null!=i[u]?i[u]:i[u]={},n=!1,t.fired=(t.fired||0)+1,t.lastArgs=e,p=[0,1],a=0,c=p.length;c>a;a++)if(s=p[a],t[s]){f=t[s];for(o in f)r=f[o],l(r)&&(n=!0,s&&delete t[s][o],r.apply(null,e))}return n},e.prototype.instantCall=function(e,t){var r,n;return r=null!=this.names?this.names:this.names={},(null!=(n=r[e])?n.fired:void 0)?(t.apply(null,r[e].lastArgs),!0):!1},e.prototype.push=function(e,t,r){var n,o,i,a,l,c,p,f,d,y;for(c=null!=this.names?this.names:this.names={},i=[],t=t?1:0,d=0,y=e.length;y>d;d++)a=e[d],null==c[a]&&(c[a]={}),n=null!=(f=c[a])[t]?f[t]:f[t]={i:0},n[n.i]=r,i.push({name:a,id:n.i}),n.i+=1;return p=!1,o=u.prototype.unsubscriber(),l=function(){var e,r,n;if(p)return!1;for(p=!0,r=0,n=i.length;n>r;r++)e=i[r],delete c[e.name][t][e.id];return!0},l[s]=!0,o.add(l),o},e}(),p=function(e){return"string"!=typeof e&&a({name:e,argument:1,required:"string"}),e?void 0:n.Value({name:e,description:"must be a non-empty string"})},f=function(e,r,n,o){var u,f,d,y,h;for(null==this.subscriptions&&(this.subscriptions=new i),l(n)||a({callback:n,argument:"last",required:"function"}),(null!=r?r[s]:void 0)||c(r)&&(f=t.isPrototypeOf(r))||(e.push(r),r=null),y=0,h=e.length;h>y;y++)u=e[y],p(u);return d=o.call(this),r?(f?r.$on("$destroy",d):r.add(d),!0):d},u=function(){function n(){this.on=__bind(this.on,this),this.on1=__bind(this.on1,this),this["if"]=__bind(this["if"],this),this.if1=__bind(this.if1,this)}return n.prototype.emit=function(){var e,t,r;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],p(t),this._halt&&(t=this._halt+"#!"+t),(r=null!=this.subscriptions?this.subscriptions:this.subscriptions=new i).emit.apply(r,[t].concat(__slice.call(e)))},n.prototype.emitted=function(e){var t,r,n;return p(e),(null!=(r=t=null!=(n=this.subscriptions)?n.names[e]:void 0)?r.fired:void 0)?t.lastArgs:!1},n.prototype.halt=function(){return this._halt=(this._halt||0)+1},n.prototype.unhalt=function(){return this._halt-=1},n.prototype.if1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o,u;for(n=[],o=0,u=t.length;u>o;o++)r=t[o],this.subscriptions.instantCall(r,e)||n.push(r);return this.subscriptions.push(n,1,e)})},n.prototype["if"]=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o;for(n=0,o=t.length;o>n;n++)r=t[n],this.subscriptions.instantCall(r,e);return this.subscriptions.push(t,0,e)})},n.prototype.on1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,1,e)})},n.prototype.on=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,0,e)})},n.prototype.unsubscriber=function(n){var o,u,i;return o={},i=0,u=function(){var t,n,u;u=null;for(t in o)n=o[t],l(n)?n()||(u=!1):null!=n.$$intervalId?e.cancel(n):r.cancel(n);return u},null!=n&&(t.isPrototypeOf(n)||a({scope:n,required:"$rootScope descendant"}),n.$on("$destroy",u)),u[s]=!0,u.add=function(e){return function(t){var r,n;return r=function(){return delete o[t]},n=function(){return a({unsubscriber:e,argument:1,required:["function","Promise"]})},c(e)?null!=e.$$timeoutId&&null!=e["finally"]?e["finally"](r):null!=e.$$intervalId&&null!=e["finally"]?e["finally"](r):n():l(e)&&e[s]||n(),o[t]=e}(i),i+=1,!0},u},n}()}]),ksc.factory("ksc.ListMapper",["ksc.util",function(e){var t,r,n;return n=e.defineValue,r=function(e,t){var r,n,o;if(t)for(n=0,o=t.length;o>n;n++)r=t[n],e=e[r];return e},t=function(){function t(e){var t,r,o;this.parent=e,r=this,o=e.source,n(r,"map",{},0,1),n(r,"pseudo",{},0,1),n(r,"multi",o&&!o._,0,1),n(r,"_sources",[],0,1),t=function(e,n,o,u){var i,s,a,l,c,p;if(l=e.source){if(l._)return t(l._,n,o,u);p=[];for(a in l)s=l[a],n[a]={},o[a]={},c=function(){var e,t,r;for(r=[],e=0,t=u.length;t>e;e++)i=u[e],r.push(i);return r}(),c.push(a),p.push(t(s,n[a],o[a],c));return p}return r._sources.push({names:u,source:e})},t(e,r.map,r.pseudo,[]),Object.freeze(r._sources)}return t.prototype.map=null,t.prototype.multi=null,t.prototype.parent=null,t.prototype.pseudo=null,t.prototype.add=function(e,t){var n,o,u;return o=this,null!=e._id?(n=e._id,u=o.map):(n=e._pseudo,u=o.pseudo),u=r(u,t),u[n]=e},t.prototype.del=function(t,n,o){var u,i;u=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(i=u.pseudo,t=n):i=u.map,i=r(i,o),delete i[t]},t.prototype.has=function(t,n,o){var u,i,s;return i=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(u=n,s=i.parent.pseudo):(u=t,s=i.parent.map),s=r(s,o),s[u]||!1},t.register=function(e){var r;r=new t(e),n(e,"_mapper",r,0,1),n(e,"map",r.map,0,1),n(e,"pseudo",r.pseudo,0,1)},t}()}]),ksc.factory("ksc.ListMask",["$rootScope","ksc.EventEmitter","ksc.List","ksc.ListMapper","ksc.ListSorter","ksc.error","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p,f,d,y,h,g,_,m,v;return a="_scopeUnsubscriber",c=u.ArgumentType,d=i.defineGetSet,y=i.defineValue,h=i.isObject,p=Array.prototype.push,l=function(e,t){var r,n,o,u,i;if(o=v(e,t),e.sorter)for(u=0,i=o.length;i>u;u++)r=o[u],n=e.sorter.position(r),Array.prototype.splice.call(e,n,0,r);else p.apply(e,o)},f=function(e,t){var r,n,o;for(o=[];r=Array.prototype.pop.call(e);)n=r._original||r,__indexOf.call(t,n)<0&&o.push(r);o.length&&(o.reverse(),p.apply(e,o))},g=function(e){var t,r,n,o,u,s,a,l;for(i.empty(e),a=e._mapper._sources,n=0,u=a.length;u>n;n++)for(r=a[n],l=r.source,o=0,s=l.length;s>o;o++)t=l[o],e.filter(t)&&p.apply(e,v(e,t))},_=function(e){var t,r,n,o;t=function(){return!0},(r=e.options.filter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({filter_function:n,required:"function"}),r=n,e.update()},d(e,"filter",n,o,1),d(e.options,"filter",n,o,1)},m=function(e){var t,r,n,o;t=function(){return!1},(r=e.options.splitter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({splitter_function:n,required:"function"}),r=n,e.update()},d(e,"splitter",n,o,1),d(e.options,"splitter",n,o,1)},v=function(e,t){var r,n,o,i,s,a,l,c,p;if((s=e.splitter(t))&&s instanceof Array){for(i=[],c=0,p=s.length;p>c;c++){r=s[c],h(r)||u.Type({splitter:e.splitter,description:"If Array is returned, all elements must be objects with override data"}),o=Object.create(t),l=function(e,t){var r,n;return r=function(){return t[e]},n=function(r){return t[e]=r},d(o,e,r,n,1)};for(n in t)l(n,t);for(n in r)a=r[n],y(o,n,a,0,1);y(o,"_original",t),i.push(o)}return i}return[t]},s=function(){function i(r,s,p,f){var d,g,v,b,k,O,j,P,w,A,q,C,x,S,R,T,K,$,M,L,V,E,I,U;(r instanceof Array||"object"!=typeof r)&&(r={_:r}),k=0;for(P in r)j=r[P],j instanceof Array&&j.options&&j.events instanceof t||c({source:j,name:P,required:"List"}),k+=1,y(r,P,j,0,1);Object.freeze(r),r._&&k>1&&c({source:r,conflict:'Can not have unnamed ("_") and named sources mixed'}),h(s)&&(f=p,p=s,s=null),null==p&&(p={}),h(p)||c({options:p,argument:3,required:"object"}),e.isPrototypeOf(p)&&(f=p,p={}),null!=f&&(e.isPrototypeOf(f)||c({scope:f,required:"$rootScope descendant"})),s&&(p.filter=s),v=[],V=this.constructor.prototype;for(g in V)q=V[g],y(v,g,q,0,1);for(E=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],x=0,K=E.length;K>x;x++)g=E[x],v[g]&&y(v,g,void 0);for(y(v,"events",new t,0,1),y(v,"options",p),y(v,"source",r,0,1),_(v),m(v),n.register(v),w=v._mapper._sources,f&&y(v,a,f.$on("$destroy",function(){return delete v[a],v.destroy()})),A=null,d=[],C=function(e){var t;return t=e.source.events.on("update",function(t){return i.update.call(v,t,e.names)}),A?A.add(t):A=t,A.add(e.source.events.on("destroy",function(){return v.destroy()}))},S=0,$=w.length;$>S;S++)O=w[S],I=O.source,__indexOf.call(d,I)>=0&&u.Value({sources:w,conflict:"Source can not be referenced twice to keep list unique"}),d.push(O.source),C(O);for(y(v,"_sourceUnsubscriber",A),o.register(v,p.sorter),R=0,M=w.length;M>R;R++)for(O=w[R],U=O.source,T=0,L=U.length;L>T;T++)b=U[T],v.filter(b)&&(v._mapper.add(b,O.names),l(v,b));return v}return i.prototype._mapper=null,i.prototype.events=null,i.prototype.filter=null,i.prototype.map=null,i.prototype.options=null,i.prototype.pseudo=null,i.prototype.sorter=null,i.prototype.source=null,i.prototype.splitter=null,i.prototype.destroy=r.prototype.destroy,i.prototype.update=function(){var e,t,r,n,o,u,i,s,a,c,p,d,y;for(e={},r=this,n=r._mapper,d=n._sources,s=0,c=d.length;c>s;s++)for(u=d[s],i=u.names,y=u.source,a=0,p=y.length;p>a;a++)o=y[a],t=n.has(o,null,i),r.filter(o)?t||(n.add(o,i),l(r,o),(null!=e.add?e.add:e.add=[]).push(o)):t&&(n.del(o,null,i),(null!=e.cut?e.cut:e.cut=[]).push(o));return e.cut&&f(r,e.cut),g(r),(e.add||e.cut)&&r.events.emit("update",{node:r,action:e}),e},i.update=function(e,t){var r,n,o,u,i,s,a,c,p,d,y,h,_,m,v,b,k,O,j,P,w,A,q,C,x,S,R,T,K,$,M,L;if(r=null,o=[],d=this,c=e.action,y=d._mapper,n=function(e,t){var n;return(null!=(n=null!=r?r:r={})[e]?n[e]:n[e]=[]).push(t)},u=function(e,r,u){return y.has(e,r,t)?(n("cut",u),o.push(u),y.del(e,r,t)):void 0},s=function(e,r,n){var o;return(o=y.has(e,r,t))||y.add(n,t),o},i=function(e,r){var n;return(n=y.has(e,r,t))&&y.del(e,r,t),n},c.cut)for(T=c.cut,A=0,x=T.length;x>A;A++)m=T[A],u(m._id,m._pseudo,m);if(c.add)for(K=c.add,q=0,S=K.length;S>q;q++)m=K[q],d.filter(m)&&(s(m._id,m._pseudo,m),l(d,m),n("add",m));if(c.update)for($=c.update,C=0,R=$.length;R>C;C++)if(e=$[C],M=e,m=M.record,e=M.info,h=M.merge,_=M.move,b=M.source,a=j=null,(v=h||_)&&(a=v.from,j=v.to),d.filter(m))if(k=a&&i(a.map,a.pseudo),O=j?s(j.map,j.pseudo,m):s(m._id,m._pseudo,m),k&&O)n("update",{record:m,info:e,merge:v,source:b}),o.push(b);else if(k)n("update",{record:m,info:e,move:v});else if(O){P={record:m},L={info:e,source:b};for(p in L)w=L[p],null!=w&&(P[p]=w);n("update",P)}else l(d,m),n("add",m);else h?(u(a.map,a.pseudo,b),u(j.map,j.pseudo,m)):_?u(a.map,a.pseudo,m):u(m._id,m._pseudo,m);d.sorter?o.length&&f(d,o):g(d),r&&d.events.emit("update",{node:d,action:r})},i}()}]),ksc.factory("ksc.ListSorter",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.defineValue,o=t.isKeyConform,r=function(){function r(u,i){var s,a,l;a=this,n(a,"list",u,0,0),"function"==typeof i?a.fn=i:((o(i)||i instanceof Array)&&(i={key:i}),t.isObject(i)&&(o(s=i.key)||s instanceof Array)||e.Value({sorter:i,requirement:"function or string or array or object: {key: <string|array>, reverse: <bool>, type: 'natural|number|byte'}"}),(l=i.type)?"byte"!==l&&"natural"!==l&&"number"!==l&&e.Value({type:l,required:"byte, natural or number"}):l="natural",n(a,"key",s,0,1),n(a,"reverse",!!i.reverse,0,1),n(a,"type",l,0,1),n(a,"fn",r.getSortFn(a),0,1)),Object.preventExtensions(a)}return r.prototype.fn=null,r.prototype.key=null,r.prototype.list=null,r.prototype.reverse=null,r.prototype.type=null,r.prototype.position=function(t){var r,n,o,u,i,s,a,l;return l=this,n=l.fn,i=l.list,(u=i.length)?(a=0,s=u-1,r=function(t){return("number"!=typeof t||isNaN(t))&&e.Type({sort_fn_output:t,required:"number"}),t},r(n(t,i[a]))<0?a:1===u?1:r(n(t,i[s]))>=0?s+1:(o=function(e,u){var s;return u-1>e?(s=Math.floor((u-e)/2+e),r(n(t,i[s]))<0?o(e,s):o(s,u)):u})(a,s)):0},r.getSortFn=function(e){var t,r,n,u,i,s;return r=e.key,i=e.reverse,s=e.type,i=i?-1:1,t=function(e,t){var r;return function(){var n,o,u;for(u=[],n=0,o=t.length;o>n;n++)r=t[n],null!=e[r]&&u.push(e[r]);return u}().join(" ")},u=function(e){return"number"!=typeof e?"string"==typeof e&&""!==e?Number(e):0/0:e},n=function(e,t){var r,n,o,u,i,s,a,l;if(e=String(e).toLowerCase(),t=String(t).toLowerCase(),s=0,l=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g,e===t)return 0;for(n=e.toLowerCase().match(l),u=t.toLowerCase().match(l),r=null!=n?n.length:0;r>s;)return null==u||void 0===u[s]?1:(o=n[s],i=u[s],s+=1,a=o-i,isNaN(a)?o>=i?1:-1:a);return-1},function(e,a){var l,c;if(o(r)?(e=e[r],a=a[r]):(e=t(e,r),a=t(a,r)),"number"===s){if(l=e,c=a,e=u(e),a=u(a),isNaN(e))return isNaN(a)?n(l,c)*i:-1*i;if(isNaN(a))return 1*i}else null==e&&(e=""),null==a&&(a="");return"natural"===s?n(e,a)*i:("byte"===s&&(e=String(e),a=String(a)),e===a?0:(e>a?1:-1)*i)}},r.register=function(e,n){var o,u,i;i=null,n&&(i=new r(e,n)),o=function(){return i},u=function(t){return t?(i=new r(e,t),Array.prototype.sort.call(e,i.fn),e.events.emit("update",{node:e,action:{sort:!0}})):i=null},t.defineGetSet(e,"sorter",o,u,1),t.defineGetSet(e.options,"sorter",o,u,1)},r}()}]),ksc.factory("ksc.List",["$rootScope","ksc.EditableRecord","ksc.EventEmitter","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,u,i,s){var a,l,c,p,f,d,y,h;return l="_scopeUnsubscriber",c=i.ArgumentType,p=s.defineValue,y=s.isObject,h=function(e,t){return"boolean"!=typeof t&&(e.push(t),t=!1),t},f=function(e,t){return e.events.emit("update",{node:e,action:t})},d=function(e,t,r){var n;(n=Array.prototype.splice).call.apply(n,[e,t,0].concat(__slice.call(r)))},a=function(){function a(t,u){var i,a,f,d,y;null==t&&(t={}),a=[],s.isObject(t)||c({options:t,argument:3,required:"object"}),e.isPrototypeOf(t)&&(u=t,t={}),null!=u&&(e.isPrototypeOf(u)||c({scope:u,required:"$rootScope descendant"})),y=this.constructor.prototype;for(i in y)f=y[i],-1===i.indexOf("constructor")&&p(a,i,f,0,1);return t=angular.copy(t),p(a,"options",t),null==(d=a.options).record&&(d.record={}),p(a,"events",new r,0,1),n.register(a),u&&p(a,l,u.$on("$destroy",function(){return delete a[l],a.destroy()})),o.register(a,t.sorter),a}return a.prototype._mapper=null,a.prototype.events=null,a.prototype.map=null,a.prototype.pseudo=null,a.prototype.options=null,a.prototype.sorter=null,a.prototype.destroy=function(){var e,t;if(t=this,Object.isFrozen(t))return!1;t.events.emit("destroy"),"function"==typeof t[l]&&t[l](),"function"==typeof t._sourceUnsubscriber&&t._sourceUnsubscriber(),s.empty(t);for(e in t)"destroy"!==e&&delete t[e];return delete t.options,delete t._sourceUnsubscriber,Object.freeze(t),!0},a.prototype.cut=function(){var e,t,r,n,o,u,s,a,l,c,p,h;for(a=1<=arguments.length?__slice.call(arguments,0):[],a.length||i.MissingArgument({name:"record",argument:1}),t=[],o=this,u=o._mapper,l=[],p=0,h=a.length;h>p;p++)s=a[p],y(s)?(__indexOf.call(o,s)<0&&i.Value({record:s,description:"not found in list"}),u.has(s)||i.Key({record:s,description:"map/pseudo id error"}),u.del(s),t.push(s)):(r=s,(s=u.has(r))||i.Key({id:r,description:"map id error"}),u.del(r),t.push(s._id!==r?r:s)),l.push(s);for(c=[];n=Array.prototype.pop.call(o);)__indexOf.call(l,n)<0&&c.push(n);return c.length&&(c.reverse(),d(o,o.length,c)),e={cut:t},f(o,e),e},a.prototype.empty=function(e){var t,r,n,o,u;n=this,t={cut:[]},n.events.halt();try{for(r=o=0,u=n.length;u>o;r=o+=1)t.cut.push(n.shift())}finally{n.events.unhalt()}return t.cut.length&&f(n,t),e?t:this},a.prototype.pop=function(){return a.remove(this,"pop")},a.prototype.push=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,r.length),n?e:r.length},a.prototype.shift=function(){return a.remove(this,"shift")},a.prototype.unshift=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,0),n?e:r.length},a.prototype.splice=function(){var e,t,r,n,o,u,i,l,p;u=arguments[0],t=arguments[1],r=4<=arguments.length?__slice.call(arguments,2,p=arguments.length-1):(p=2,[]),l=arguments[p++],l=h(r,l),"undefined"==typeof r[0]&&1===r.length&&r.pop(),"boolean"!=typeof t||r.length||(l=t,t=null),i=function(e,t){return"number"==typeof e&&(e>0||0===e)&&e===Math.floor(e)?void 0:c({value:e,argument:t,required:"int >= 0"})},e={},o=this,n=o.length,0>u&&(u=Math.max(n+u,0)),i(u),u=Math.min(n,u),null!=t?(i(t),t=Math.min(n-u,t)):t=n-u,o.events.halt();try{t>0&&(e=o.cut.apply(o,o.slice(u,u+t))),r.length&&s.mergeIn(e,a.add(o,r,u))}finally{o.events.unhalt()}return(e.cut||e.add||e.update)&&f(o,e),l?e:e.cut||[]},a.prototype.reverse=function(){var e;return e=this,e.sorter&&i.Permission("can not reverse an auto-sorted list"),e.length>1&&(Array.prototype.reverse.call(e),f(e,{reverse:!0})),e},a.prototype.sort=function(e){var t,r,n,o,u,s;if(n=this,n.sorter&&i.Permission("can not reverse an auto-sorted list"),n.length>1)for(t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o);return r}(),null==e&&(e=function(e,t){return null===e._id&&null===t._id?e._pseudo-t._pseudo:null===e._id?-1:null===t._id?1:e._id>t._id?1:-1}),Array.prototype.sort.call(n,e),r=u=0,s=n.length;s>u;r=++u)if(o=n[r],o!==t[r]){f(n,{sort:!0});break}return n},a.prototype._recordChange=function(e,t,r){var n,o,a,l,c,y,h,g,_,m;if(e instanceof u||i.Type({record:e,required:"Record"}),l=this,c=l.map,y=l._mapper,n=function(){return p(e,"_pseudo",null),y.add(e)},o={record:e,info:t},r!==e._id){l.events.halt();try{null==e._id?(y.del(r),p(e,"_pseudo",s.uid("record.pseudo")),y.add(e),o.move={from:{map:r},to:{pseudo:e._pseudo}}):null==r?c[e._id]?(o.merge={from:{pseudo:e._pseudo},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(e),l.push(e)):(o.move={from:{pseudo:e._pseudo},to:{map:e._id}},y.del(null,e._pseudo),n()):c[e._id]?(o.merge={from:{map:r},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(r),l.push(e)):(o.move={from:{map:r},to:{map:e._id}},y.del(r),n())}finally{l.events.unhalt()}}if(l.sorter)for(e=o.record,g=_=0,m=l.length;m>_;g=++_)if(a=l[g],a===e){Array.prototype.splice.call(l,g,1),h=l.sorter.position(e),d(l,h,[e]);break}return f(l,{update:[o]})},a.add=function(e,r,n){var o,a,l,c,y,h,g,_,m,v,b,k;r.length||i.MissingArgument({name:"item",argument:1}),o={},c=e._mapper,e.events.halt();try{for(_=[],g=e.options.record,h=g["class"]||t,m=0,b=r.length;b>m;m++)l=r[m],y=l,l instanceof h?(l._parent&&l._parent!==e&&l._parent.cut(l),p(l,"_parent",e)):(l instanceof u&&(l=l._clone(!0)),l=new h(l,g,e)),null!=l._id?((a=c.has(l._id))?(a._replace(l._clone(!0)),(null!=o.update?o.update:o.update=[]).push({record:a,source:y})):(c.add(l),_.push(l),(null!=o.add?o.add:o.add=[]).push(l)),l._pseudo&&p(l,"_pseudo",null)):(p(l,"_pseudo",s.uid("record.pseudo")),c.add(l),_.push(l),(null!=o.add?o.add:o.add=[]).push(l));if(_.length)if(e.sorter)for(v=0,k=_.length;k>v;v++)l=_[v],n=e.sorter.position(l),d(e,n,[l]);else d(e,n,_)}finally{e.events.unhalt()}return f(e,o),o},a.remove=function(e,t){var r;return(r=Array.prototype[t].call(e))&&(e._mapper.del(r),f(e,{cut:[r]})),r},a}()}]),ksc.factory("ksc.Mixin",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=function(r,n,o){var u,i,s;for(null!=r&&"boolean"!=typeof r&&(n.unshift(r),r=!0),i=0,s=n.length;s>i;i++)u=n[i],t.isKeyConform(u)||e.Key({property:u,required:"key conform value"});return o(r,n)},o=function(e,r,n,o){var u;return t.hasProperty(e,r)?!1:null==n?!0:(u=__indexOf.call(o,r)>=0,n&&u||!n&&!u)},r=function(){function e(){}return e.extend=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendProto.apply(e,[r,n,t].concat(__slice.call(o))),e.extendInstance.apply(e,[r,n,t].concat(__slice.call(o)))},e.extendInstance=function(){var e,t,r,u;return t=arguments[0],r=arguments[1],e=arguments[2],u=4<=arguments.length?__slice.call(arguments,3):[],n(e,u,function(e,n){var u,i;for(u in r)i=r[u],o(t,u,e,n)&&(t[u]=i)})},e.extendProto=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendInstance.apply(e,[r.prototype,n.prototype,t].concat(__slice.call(o)))},e}()}]),ksc.factory("ksc.RecordContract",["ksc.error","ksc.util",function(e,t){var r,n,o,u;return r="nullable",o=t.hasOwn,u=t.isObject,n=function(){function t(n){var i,s,a,l,c,p,f,d;if(null===n||n instanceof t)return n;u(n)||e.Type({contract:n,required:"object"});for(c in n){for(s=n[c],"_"===c.substr(0,1)&&e.Key({key:c,description:'can not start with "_"'}),this[c]=s,s[r]?s[r]=!0:delete s[r],l=0,d=["array","contract","default"],p=0,f=d.length;f>p;p++)a=d[p],s[a]&&(l+=1,l>1&&e.Value({key:a,contract:s,description:"array, default and contract are mutally exclusive"}));(i=s.array)||"array"!==s.type||e.Type({array:s.array,description:"array description object is required"}),i&&(o(s,"type")&&"array"!==s.type&&e.Type({type:type,array:s.array,requiredType:"array"}),delete s.type),"object"!==s.type||u(s.contract)||e.Type({contract:s.contract,description:"contract description object is required"}),s.contract&&(o(s,"type")&&"object"!==s.type&&e.Type({type:type,contract:s.contract,requiredType:"object"}),delete s.type),i||(s.contract?s.contract=new t(s.contract):(o(s,"default")&&!o(s,"type")&&null!=t.typeDefaults[typeof s["default"]]&&(s.type=typeof s["default"]),null==t.typeDefaults[s.type]&&e.Type({type:s.type,required:"array, boolean, number, object, string"}))),this._match(c,this._default(c))
}Object.freeze(this)}return t.prototype._default=function(n){var u,i,s;if(u=this[n],u||e.Key({key:n,description:"Key not found on contract"}),o(u,"default"))return u["default"];if(u[r])return null;if(u.array)return[];if(u.contract){i={},s=u.contract;for(n in s)__hasProp.call(s,n)&&(i[n]=u.contract._default(n));return i}return t.typeDefaults[u.type]},t.prototype._match=function(t,n){var o;return o=this[t],null!=o&&(o.array&&Array.isArray(n)||o.contract&&u(n)||typeof n===o.type||null===n&&o[r])?!0:e.ContractBreak({key:t,value:n,contract:o})},t.finalizeRecord=function(e){e._options.contract&&Object.isExtensible(e)&&Object.preventExtensions(e)},t.typeDefaults={"boolean":!1,number:0,string:""},t}()}]),ksc.factory("ksc.Record",["ksc.ArrayTracker","ksc.EventEmitter","ksc.RecordContract","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s,a,l,c,p,f,d,y,h,g,_,m,v,b,k,O,j;return y="_array",h="_deletedKeys",g="_edited",_="_events",m="_id",v="_options",b="_parent",k="_parentKey",O="_pseudo",j="_saved",u="array",i="contract",s="idProperty",l=o.defineValue,c=o.hasOwn,p=Array.isArray,f=o.isObject,d=function(e,t,r){var o;return f(t)?void 0:(o={},o[e]=t,o.argument=r,o.required="object",n.ArgumentType(o))},a=function(){function e(e,u,s,a){var p,y,h,g,P,w,A,q,C,x,S,R;for(null==e&&(e={}),null==u&&(u={}),f(e)||n.Type({data:e,required:"object"}),d("data",e,1),d("options",u,2),h=this,l(h,v,u),l(h,j,{}),c(u,i)&&(p=u[i]=new r(u[i])),(null!=s||null!=a)&&(d("options",s,3),l(h,b,s),null!=a&&(o.isKeyConform(a)||n.Type({parent_key:a,argument:4,required:"key conform value"}),l(h,k,a),delete h[m],delete h[O])),S=p?[h,p]:[h],A=0,C=S.length;C>A;A++){w=S[A],R=o.propertyRefs(Object.getPrototypeOf(w));for(y in R)for(P=R[y],q=0,x=P.length;x>q;q++)g=P[q],Object.defineProperty(g,y,{enumerable:!1})}null==a&&(l(h,m,void 0),l(h,O,void 0),l(h,_,new t),h[_].halt()),h._replace(e),null!=a?l(h,_,null):h[_].unhalt(),r.finalizeRecord(h)}return e.prototype._array=void 0,e.prototype._events=void 0,e.prototype._id=void 0,e.prototype._options=void 0,e.prototype._parent=void 0,e.prototype._parentKey=void 0,e.prototype._pseudo=void 0,e.prototype._saved=void 0,e.prototype._clone=function(e){var t,r,n,o;null==e&&(e=!1),t={},n=this;for(r in n)o=n[r],f(o)&&(o=o._clone(1)),t[r]=o;return e?t:new n.constructor(t)},e.prototype._entity=function(){return this._clone(1)},e.initIdProperty=function(e,t){var r,o,u,a,l,c,p,f,d;if(l=e[v],r=l[i],null==l[s])for(a in t){l[s]=a;break}if(u=function(e){var t;return r&&(null==r[e]&&n.ContractBreak({key:e,contract:r,mismatch:"idProperty"}),"string"!==(t=r[e].type)&&"number"!==t)?n.ContractBreak({key:e,contract:r,required:"string or number"}):void 0},e[_]&&(o=l[s])){if(o instanceof Array){for(d=[],p=0,f=o.length;f>p;p++)c=o[p],u(c),d.push(null!=t[c]?t[c]:t[c]=null);return d}return u(o),null!=t[o]?t[o]:t[o]=null}},e.prototype._valueCheck=function(e,t){var r;return(r=this[v][i])?r._match(this[y]?"all":e,t):("_"===e.substr(0,1)&&n.Key({key:e,description:'can not start with "_"'}),"function"==typeof t?n.Type({value:t,description:"can not be function"}):void 0)},e.valueWrap=function(t,r,n){var o,s,a,l,c;return s=t[v][i],f(n)&&(n instanceof e&&(n=n._clone(1)),o=t[v].subtreeClass||e,(a=null!=s?s[r]:void 0)&&((l=a[u])&&(c={contract:{all:l}}),(l=a[i])&&(c={contract:l})),n=new o(n,c,t,r)),n},e.prototype._getProperty=function(t){var r,n,o;return r=this,(null!=(o=r[h])?o[t]:0)?void 0:(n=c(r[g],t)?r[g][t]:r[j][t],(null!=n?n[y]:void 0)?e.arrayRecord(n[y]):n)},e.prototype._setProperty=function(t,r,u){var i,s;return i=this,u?s=i[j]:(s=i[g])||n.Permission({key:t,value:r,description:"Read-only Record"}),i._valueCheck(t,r),c(i,t)&&o.identical(r,i[t])?!1:(r=e.valueWrap(i,t,r),l(i[j],t,r,0,1),!0)},e.prototype._replace=function(t,r){var u,s,a,l,f,d,y;if(null==r&&(r=!0),f=this,null===f[_]&&n.Permission({key:f[k],description:"can not replace subobject"}),e.initIdProperty(f,t),u=!1,p(t));else{a={};for(l in t)d=t[l],a[l]=d;if(s=f[v][i])for(l in s)d=s[l],c(a,l)||(a[l]=s._default(l));y=function(e){return o.defineGetSet(f,e,function(){return f._getProperty(e)},function(t){return f._setProperty(e,t)},1)};for(l in a)d=a[l],y(l),f._setProperty(l,d,1)&&(u=!0);for(l in f[j])c(a,l)||(delete f[l],delete f[j][l])}return u&&f[_]&&r&&e.emitUpdate(f,"replace"),u},e.arrayRecord=function(e){var t,r,n,o,u,i,s,a;for(t=e[y],u=e,o={};u&&u.constructor!==Object;){for(a=Object.getOwnPropertyNames(u),i=0,s=a.length;s>i;i++)n=a[i],"_"!==n.substr(0,1)||c(o,n)||(o[n]=Object.getOwnPropertyDescriptor(u,n));u=Object.getPrototypeOf(u)}for(n in t)__hasProp.call(t,n)&&("_"!==n.substr(0,1)||c(o,n)||delete t[n]);for(n in o)r=o[n],Object.defineProperty(t,n,r);return t},e.emitUpdate=function(t,r,n){var o,u,i,s,a,l,c,p;for(null==n&&(n={}),a=[],l=t;!(o=l[_]);)a.unshift(l[k]),l=l[b];u={node:t},t!==l&&(u.parent=l,u.path=a),u.action=r;for(i in n)c=n[i],u[i]=c;s=l[m],e.setId(l),l[_]._halt||null!=(p=l[b])&&"function"==typeof p._recordChange&&p._recordChange(l,u,s),o.emit("update",u)},e.setId=function(e){var t,r,n,u,i,a,c,p;if(u=e[v][s])if(u instanceof Array){for(t=[],r=c=0,p=u.length;p>c;r=++c)if(i=u[r],o.isKeyConform(e[i]))t.push(e[i]);else if(!r)break;n=t.length?t.join("-"):null,l(e,m,n),l(e,"_primaryId",e[u[0]])}else a=e[u],l(e,m,null!=a?a:null)},e}()}]),ksc.factory("ksc.RestList",["$http","$q","ksc.List","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p;return a="restCache",l="restPending",s="_primaryId",p=i.defineValue,c=function(r){function a(){return a.__super__.constructor.apply(this,arguments)}return __extends(a,r),a.prototype.restCache=null,a.prototype.restPending=0,a.prototype.restGetRaw=function(t,r){var i,s,a,c,f,d,y;return"function"==typeof t&&(r=t,t=null),a=this,(i=a.options.endpoint)&&(d=i.url)&&"string"==typeof d||o.Type({"options.endpoint.url":d,required:"string"}),p(a,l,a[l]+1,0,1),(f=n.get(d,t))||(t&&(c=function(){var e;e=[];for(s in t)y=t[s],e.push(encodeURIComponent(s)+"="+encodeURIComponent(y));return e}(),c.length&&(d+=(d.indexOf("?")>-1?"&":"?")+c.join("&"))),f=e.get(d)),u.wrapPromise(f,function(e,t){return p(a,l,a[l]-1,0,1),r(e,t)})},a.prototype.restLoad=function(e,t,r){var n,o,i;return"boolean"!=typeof e&&(r=t,t=e,e=null),"function"==typeof t&&(r=t,t=null),o=this,i=o.options,n=function(){return o.restGetRaw(t,function(e,t){var n,u,i;if(!e)try{n=a.getResponseArray(o,t.data),u=o.push.apply(o,__slice.call(n).concat([!0]))}catch(s){i=s,e=i}return"function"==typeof r?r(e,u,t):void 0})},i.cache&&o.restCache&&!e?r&&u.wrapPromise(o.restCache,r):p(o,"restCache",n(),0,1),o.restCache},a.prototype.restSave=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,1,t,e)},a.prototype.restDelete=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,0,t,e)},a.getResponseArray=function(e,t){var r,n,u,i;if(r=e.options.endpoint,u="responseProperty","undefined"==typeof r[u]){Array.isArray(t)&&(r[u]=null);for(n in t)i=t[n],Array.isArray(i)&&(r[u]=n)}return null!=r[u]&&(t=t[r[u]]),t instanceof Array||o.Value({"options.endpoint.responseProperty":void 0,description:"array type property in response is not found or unspecified"}),t},a.relatedRecords=function(e,t){var r,n,o,u,i;if(null==(r=t[s]))return[t];for(i=[],o=0,u=e.length;u>o;o++)n=e[o],n[s]===r&&i.push(n);return i},a.updateOnSave=function(e,r,n,o){var u,i,a,l,c,p,f,d,y,h,g,_,m,v,b,k;for(f=[],h=[],a=m=0,b=r.length;b>m;a=++m)y=r[a],null!=(c=y[s])||e.options.reloadOnUpdate?(d={},l=y._options.idProperty,c?d[l[0]]=c:d[l]=y._id,f.push(e.restLoad(d))):h.push([y,n[a]]);if(h.length){e.events.halt(),u=[],_=e.events.on("1#!update",function(e){return u.push(e.action.update[0])});try{for(v=0,k=h.length;k>v;v++)g=h[v],y=g[0],i=g[1],y._replace(i)}finally{_(),e.events.unhalt()}u.length&&e.events.emit("update",{node:e,action:{update:u}})}f.length?(p=t.all(f),p.then(o,o)):o()},a.writeBack=function(e,t,r,n){var u,l,c,p,f,d,y,h,g,_,m;for(n&&"function"==typeof n||(n&&r.push(n),n=null),g={},c=_=0,m=r.length;m>_;c=++_)y=r[c],i.isObject(y)||(r[c]=y=e.map[y]),f=y,d=null,h="id:"+(p=null!=y?y._id:void 0),null==(p=null!=y?y._id:void 0)?(d=null!=y?y._pseudo:void 0,h="pseudo:"+d):null!=y[s]&&(h="id:"+y[s]),t?(y=d&&e.pseudo[d]||e.map[p],y||o.Key({key:f,description:"no such record on list"})):(y=e.map[p])||o.Key({key:f,description:"no such record on map"}),g[h]&&o.Value({uid:h,description:"not unique"}),g[h]=y;return r.length||o.MissingArgument({name:"record",argument:1}),l=e.options.endpoint||{},t&&l.bulkSave?(u=String(l.bulkSave).toLowerCase(),"post"!==u&&(u="put"),a.writeBulk(e,u,r,n)):!t&&l.bulkDelete?a.writeBulk(e,"delete",r,n):a.writeSolo(e,t,r,n)},a.writeBulk=function(t,r,n,i){var c,p,f,d,y,h,g;return(g=t.options.endpoint.url)&&"string"==typeof g||o.Type({"options.endpoint.url":g,required:"string"}),h="delete"!==r,p=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)y=n[e],h?r.push(y._entity()):(null==(f=y[s])&&(f=y._id),r.push(f));return r}(),c=[g],h&&c.push(p),t[l]+=1,d=e[r].apply(e,c),u.wrapPromise(d,function(e,r){var o,u,s,c;for(t[l]-=1,o=function(){return"function"==typeof i?i(e,u,r):void 0},u=[],s=0,c=n.length;c>s;s++)y=n[s],u.push.apply(u,a.relatedRecords(t,y));return e||(h?a.updateOnSave(t,n,r.data,o):(t.cut.apply(t,u),o())),o()})},a.writeSolo=function(t,r,n,i){var c,p,f,d,y;return y=[],c=d=null,p=function(e){var t;return t=Array.prototype.slice.call(arguments,1),c=[e,y].concat(__slice.call(t)),d?void 0:("function"==typeof i&&i.apply(null,c),c=null)},f=function(n){var p,f,h,g,_,m,v;return null==(f=n[s])&&(f=n._id),h="delete",_=null!=(m=t.options.record.endpoint)?m.url:void 0,r&&(h="put",n._pseudo&&(h="post",f=null,_=null!=(v=t.options.endpoint)?v.url:void 0)),_&&"string"==typeof _||o.Value({"options.record.endpoint.url":_,required:"string"}),_=_.replace("<id>",f),p=[_],r&&p.push(n._entity()),t[l]+=1,g=e[h].apply(e,p),u.wrapPromise(g,function(e,o){var u;t[l]-=1,u=a.relatedRecords(t,n),e||(r?(d=(d||0)+1,a.updateOnSave(t,[n],[o.data],function(){return d-=1,c&&"function"==typeof i?i.apply(null,c):void 0})):t.cut.apply(t,u)),y.push.apply(y,u)})},u.asyncSquash(n,f,p)},a}(r)}]),ksc.factory("ksc.RestRecord",["$http","ksc.Record","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u){var i,s,a,l,c;return i="_options",s="_restCache",a="_restPending",c=u.defineValue,l=function(t){function u(){c(this,a,0),u.__super__.constructor.apply(this,arguments)}return __extends(u,t),u.prototype._restCache=null,u.prototype._restPending=0,u.prototype._restLoad=function(t,n){var a,l;return l=this,a=function(){var t,o;return o=u.getUrl(l),(t=r.get(o))||(t=e.get(o)),u.async(l,t,n)},"boolean"!=typeof t&&(n=t,t=null),l[i].cache&&l[s]&&!t?n&&o.wrapPromise(l[s],n):c(l,s,a()),l[s]},u.async=function(e,t,r){return c(e,a,e[a]+1),o.wrapPromise(t,function(t,n){return c(e,a,e[a]-1),!t&&n.data&&e._replace(n.data),"function"==typeof r?r(t,n):void 0})},u.getUrl=function(e){var t,r;return(t=e[i].endpoint)&&null!=(r=t.url)||n.Value({"_options.endpoint.url":void 0}),"string"!=typeof r&&n.Type({"_options.endpoint.url":r,required:"string"}),r},u}(t)}]),ksc.service("ksc.restUtil",["$q","ksc.error",function(e,t){var r;return r=function(){function r(){}return r.asyncSquash=function(n,o,u){var i,s,a,l,c,p,f;return i=0,s=[],c=n.length,f=[],a=function(e,r){var n,o,a,l;return o=r.data,l=r.status,a=r.headers,n=r.config,i+=1,null!=e&&s.push(e),f.push({error:e,data:o,status:l,headers:a,config:n}),i===c&&u?(t=null,1===s.length?t=s[0]:s.length&&(t=s),u.apply(null,[t].concat(__slice.call(f)))):void 0},p=function(){var e,t,u;for(u=[],e=0,t=n.length;t>e;e++)l=n[e],u.push(r.wrapPromise(o(l),a));return u}(),p.length<2?p[0]:e.all(p)},r.wrapPromise=function(e,r){var n,o;return o=function(e){var t,n,o,u,i;return n=e.data,u=e.status,o=e.headers,t=e.config,i=e,r(null,i)},n=function(e){var n,o,u,i,s,a;return o=e.data,s=e.status,i=e.headers,n=e.config,a=e,u=new t.type.Http(e),a.error=u,r(u,a)},e.then(o,n),e},r}()}]),ksc.service("ksc.util",["ksc.error",function(e){var t,r,n,o,u,i,s,a;return n=Object.defineProperty,u=Object.getOwnPropertyDescriptor,i=Object.getPrototypeOf,r=function(t){return t.length?void 0:e.MissingArgument({name:"reference",argument:1})},t=function(){function t(){}return t.defineGetSet=function(e,t,r,o,u){return"function"!=typeof o&&(u=o,o=void 0),n(e,t,{configurable:!0,enumerable:!!u,get:r,set:o})},t.defineValue=function(e,t,r,o,i){var s;return(null!=(s=u(e,t))?s.writable:void 0)===!1&&n(e,t,{writable:!0}),n(e,t,{configurable:!0,enumerable:!!i,value:r,writable:!!o})},t.empty=function(){var t,r,n,o,u,i,s,l;for(o=1<=arguments.length?__slice.call(arguments,0):[],o.length||e.MissingArgument({argument:1}),a.apply(this,o)||e.Type({arguments:o,required:"All arguments must be objects"}),u=0,s=o.length;s>u;u++)if(n=o[u],Array.isArray(n))for(t=i=0,l=n.length;l>=0?l>i:i>l;t=l>=0?++i:--i)n.pop();else for(r in n)__hasProp.call(n,r)&&delete n[r]},t.hasOwn=function(e,t,r){return e&&e.hasOwnProperty(t)&&(null==r||r===e.propertyIsEnumerable(t))},t.hasProperty=function(e,t){for(;e;){if(e.hasOwnProperty(t))return!0;e=i(e)}return!1},t.identical=function(e,r){var n,o;if(!a(e,r))return e===r;for(n in e)if(o=e[n],!t.identical(o,r[n])||!s(r,n))return!1;for(n in r)if(!s(e,n))return!1;return!0},t.isEnumerable=function(e,t){try{return!!u(e,t).enumerable}catch(r){}return!1},t.isKeyConform=function(e){return!("string"!=typeof e||!e)||"number"==typeof e&&!isNaN(e)},t.isFunction=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],"function"!=typeof e)return!1;return!0},t.isObject=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],!e||"object"!=typeof e)return!1;return!0},t.mergeIn=function(){var t,r,n,o,u,i,s,l;for(u=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],o.length<1&&e.MissingArgument({required:"Merged and mergee objects"}),a(u)||e.Type({target_object:u,argument:1,required:"object"}),t=s=0,l=o.length;l>s;t=++s){n=o[t],a(n)||e.Type({object:n,argument:t+2,required:"object"});for(r in n)i=n[r],u[r]=i}return u},t.propertyRefs=function(t){var r,n,o;for(o={};a(t);){r=!0;for(n in t)__hasProp.call(t,n)&&(Array.isArray(o[n])||(o[n]=[]),o[n].push(t));t=i(t)}return r||e.ArgumentType({object:t,argument:1,accepts:"object"}),o},t.uid=function(r){var n,o;return o=null!=t._uidStore?t._uidStore:t._uidStore={named:{}},null!=r?(t.isKeyConform(r)||e.Key({name:r,requirement:"Key type name"}),n=o.named):(n=o,r="unnamed"),n[r]=(n[r]||0)+1},t}(),o=t.defineValue,s=t.hasOwn,a=t.isObject,t}]);