var __hasProp={}.hasOwnProperty,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;angular.module("ksc",[]),angular.module("ksc").service("ksc.batchLoaderRegistry",["ksc.error","ksc.util",function(e,t){var r;return new(r=function(){function r(){}return r.prototype.map={},r.prototype.get=function(e,t){var r,n,o,u;u=this.map;for(r in u)if(n=u[r],o=n.get(e,t))return o;return!1},r.prototype.register=function(r){var n;return"string"==typeof(n=null!=r?r.endpoint:void 0)&&t.isKeyConform(n)||e.Key({endpoint:n,required:"url"}),this.map[n]&&e.Key({endpoint:n,description:"already registered"}),this.map[n]=r},r.prototype.unregister=function(e){return this.map[e.endpoint]?delete this.map[e.endpoint]:!1},r}())}]),angular.module("ksc").factory("ksc.BatchLoader",["$http","$q","ksc.batchLoaderRegistry","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s;return i=n.ArgumentType,s=o.isObject,u=function(){function u(e,t){var u,a,l,c,p;this.endpoint=e,this.map=t,a=this,e&&"string"==typeof e||i({endpoint:e,required:"string"}),s(t)||i({map:t,required:"object"});for(u in t)p=t[u],"string"==typeof p&&u||n.Type({key:u,url:p,required:"url string"});l=!0,c=function(e){return l&&!e&&a.flush(),l=!!e},o.defineGetSet(a,"open",function(){return l},c,1),o.defineValue(a,"requests",[],0,1),r.register(a)}return u.prototype.endpoint=null,u.prototype.map=null,u.prototype.open=!0,u.prototype.requests=null,u.prototype.get=function(e,r){var n,o,u,a,l,c,p;if(u=this,l=u.requests,e&&"string"==typeof e||i({url:e,required:"string"}),null==r||s(r)||i({query_parameters:r,required:"object"}),!u.open)return!1;p=u.map;for(o in p)if(c=p[o],e===c){a=o;break}return a?(n=t.defer(),l.push({resource:a,deferred:n}),r&&(l[l.length-1].query=r),n.promise):!1},u.prototype.flush=function(){var t,r,n,o,u,i,s;if(n=this,u=n.requests,!u.length)return!1;for(r=[],i=0,s=u.length;s>i;i++)o=u[i],r.push(o.deferred),delete o.deferred;return t=e.put(n.endpoint,u),t.success(function(e,t,n,o){var u,i,s,a,l,c,p;for(i=l=0,c=r.length;c>l;i=++l)u=r[i],null!=(a=e[i])?(s={data:a.body,status:a.status,headers:n,config:o},200<=(p=a.status)&&400>p?u.resolve(s):u.reject(s)):u.reject({data:e,status:t,headers:n,config:o})}),t.error(function(e,t,n,o){var u,i,s;for(i=0,s=r.length;s>i;i++)u=r[i],u.reject({data:e,status:t,headers:n,config:o})})},u}()}]),angular.module("ksc").factory("ksc.EditableRecord",["ksc.Record","ksc.error","ksc.util",function(e,t,r){var n,o,u,i,s,a,l,c,p,f,d,y,h,g;return o="_changes",n="_changedKeys",u="_deletedKeys",i="_edited",s="_events",l="_options",c="_parent",p="_parentKey",f="_saved",d=r.defineValue,y=r.hasOwn,h=r.isEnumerable,g=r.isObject,a=function(a){function _(e,r,n,o){null==e&&(e={}),null==r&&(r={}),g(r)||t.ArgumentType({options:r,argument:2,required:"object"}),r.subtreeClass=_,_.__super__.constructor.call(this,e,r,n,o)}return __extends(_,a),_.prototype._changedKeys=null,_.prototype._changes=0,_.prototype._deletedKeys=null,_.prototype._edited=null,_.prototype._clone=function(t,r){var o,i,s,a,l,c;if(null==t&&(t=!1),null==r&&(r=!1),a=this,t){o={},l=r?a[f]:a;for(s in l)c=l[s],c instanceof e&&(c=c._clone(!0,r)),o[s]=c;return o}if(o=new a.constructor(a[f]),!r){for(s in a)(a[n][s]||!y(a[f],s))&&(c=a[s],g(c)&&(c=c._clone(!0)),o[s]=c);if(i=a[u])for(s in a[u])o._delete(s)}return o},_.prototype._delete=function(){var s,a,c,p,g,_,m,v,b;for(_=1<=arguments.length?__slice.call(arguments,0):[],_.length||t.MissingArgument({name:"key",argument:1}),m=this,s=[],c=v=0,b=_.length;b>v;c=++v)if(g=_[c],r.isKeyConform(g)||t.Key({key:g,argument:c,required:"key conform value"}),!c&&(a=m[l].contract)&&t.ContractBreak({key:g,value:value,contract:a[g]}),((p=m[l].idProperty)===g||p instanceof Array&&__indexOf.call(p,g)>=0)&&t.Permission({key:g,description:"._options.idProperty keys can not be deleted"}),y(m[f],g)){if(m[u][g])continue;m[u][g]=!0,m[n][g]||(d(m,o,m[o]+1),d(m[n],g,!0,0,1)),delete m[i][g],Object.defineProperty(m,g,{enumerable:!1}),s.push(g)}else y(m,g)&&(h(m,g)||t.Key({key:g,description:"can not be changed"}),delete m[g],s.push(g));return s.length&&e.emitUpdate(m,"delete",{keys:s}),!!s.length},_.prototype._replace=function(t){var r,a,c,p,y,h,g;h=this,(p=h[s])&&p.halt();try{if(c=h._revert(!1),r=_.__super__._replace.call(this,t,!1)){a=h[l].contract,d(h,i,{}),d(h,o,0),d(h,n,{}),d(h,u,a?null:{}),d(h,f,{});for(y in h)g=h[y],d(h[f],y,g,0,1),_.setProperty(h,y);Object.freeze(h[f])}}finally{p&&p.unhalt()}return(c||r)&&e.emitUpdate(h,"replace"),c||r},_.prototype._revert=function(t){var r,s,a;null==t&&(t=!0),r=!1,a=this;for(s in a[u])delete a[u][s],delete a[n][s],r=!0;for(s in a[i])delete a[i][s],delete a[n][s],r=!0;for(s in a)y(a[f],s)||(delete a[s],r=!0);return r&&t&&(d(a,o,0),e.emitUpdate(a,"revert")),r},_.setProperty=function(s,a){var m,v,b,k,j,O;j=s[f],v=s[i],k=s[l],m=k.contract,b=function(){return m||!s[u][a]?y(v,a)?v[a]:j[a]:void 0},O=function(u){var i,f,b,k,O,w,q,A;if("function"==typeof u&&t.Type({update:u,description:"must not be function"}),((f=s[l].idProperty)===a||f instanceof Array&&__indexOf.call(f,a)>=0)&&null!==u&&"string"!=(A=typeof u)&&"number"!==A&&t.Value({update:u,required:"string or number or null"}),r.identical(j[a],u))delete v[a],i=!0;else if(!r.identical(v[a],u)){if(null!=m&&m._match(a,u),k=u,g(u)){if(g(j[a])){k=j[a];for(b in k)h(k,b)&&!y(u,b)&&k._delete(b)}else O={},m&&(O.contract=m[a].contract),k=new _({},O,s,a);for(b in u)w=u[b],k[b]=w}v[a]=k,i=!0}return v[a]===j[a]&&delete v[a],q=s[n][a],g(j[a])&&j[a]._changes||y(v,a)&&!r.identical(j[a],v[a])?q||(d(s,o,s[o]+1),d(s[n],a,!0,0,1)):q&&(d(s,o,s[o]-1),delete s[n][a]),i?(s[p]&&_.subChanges(s[c],s[p],s[o]),Object.defineProperty(s,a,{enumerable:!0}),e.emitUpdate(s,"set",{key:a})):void 0},r.defineGetSet(s,a,b,O,1)},_.subChanges=function(e,t,r){var u;e[n][t]?r||(d(e,o,e[o]-1),delete e[n][t],u=!0):r&&(d(e,o,e[o]+1),d(e[n],t,!0,0,1),u=!0),u&&e[p]&&_.subChanges(e[c],e[p],e[o])},_}(e)}]),angular.module("ksc").factory("ksc.EditableRestRecord",["$http","ksc.EditableRecord","ksc.Mixin","ksc.RestRecord",function(e,t,r,n){var o;return o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),r.extend(o,n),o.prototype._restSave=function(t){var r;return r=o.getUrl(this),o.async(this,e.put(r,this._entity()),t)},o}(t)}]),angular.module("ksc").service("ksc.error",function(){var e,t,r,n,o,u,i,s,a,l,c,p,f,d;r=function(e){function t(e){var t,r,n;if(r="",e&&"object"==typeof e)for(t in e){n=e[t];try{n=JSON.stringify(n,null,2)}catch(o){n=String(n)}r+="\n  "+t+": "+n}else null!=e&&(r+=String(e));this.message=r}return __extends(t,e),t}(Error),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),n=function(){function r(){}return r.ArgumentType=e,r.ContractBreak=t,r.Http=o,r.Key=u,r.MissingArgument=i,r.Permission=s,r.Type=a,r.Value=l,r}(),p={type:n},d=function(e){return p[f]=function(t){throw new e(t)}};for(f in n)c=n[f],c.prototype.name=f+"Error",d(c);return p}),angular.module("ksc").factory("ksc.EventEmitter",["$interval","$rootScope","$timeout","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s,a,l,c,p,f;return s="__unsubscriber__",a=n.ArgumentType,l=o.isFunction,c=o.isObject,i=function(){function e(){}return e.prototype.names=null,e.prototype.emit=function(){var e,t,r,n,o,u,i,s,a,c,p,f;for(u=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i=null!=this.names?this.names:this.names={},t=null!=i[u]?i[u]:i[u]={},n=!1,t.fired=(t.fired||0)+1,t.lastArgs=e,p=[0,1],a=0,c=p.length;c>a;a++)if(s=p[a],t[s]){f=t[s];for(o in f)r=f[o],l(r)&&(n=!0,s&&delete t[s][o],r.apply(null,e))}return n},e.prototype.instantCall=function(e,t){var r,n;return r=null!=this.names?this.names:this.names={},(null!=(n=r[e])?n.fired:void 0)?(t.apply(null,r[e].lastArgs),!0):!1},e.prototype.push=function(e,t,r){var n,o,i,a,l,c,p,f,d,y;for(c=null!=this.names?this.names:this.names={},i=[],t=t?1:0,d=0,y=e.length;y>d;d++)a=e[d],null==c[a]&&(c[a]={}),n=null!=(f=c[a])[t]?f[t]:f[t]={i:0},n[n.i]=r,i.push({name:a,id:n.i}),n.i+=1;return p=!1,o=u.prototype.unsubscriber(),l=function(){var e,r,n;if(p)return!1;for(p=!0,r=0,n=i.length;n>r;r++)e=i[r],delete c[e.name][t][e.id];return!0},l[s]=!0,o.add(l),o},e}(),p=function(e){return"string"!=typeof e&&a({name:e,argument:1,required:"string"}),e?void 0:n.Value({name:e,description:"must be a non-empty string"})},f=function(e,r,n,o){var u,f,d,y,h;for(null==this.subscriptions&&(this.subscriptions=new i),l(n)||a({callback:n,argument:"last",required:"function"}),(null!=r?r[s]:void 0)||c(r)&&(f=t.isPrototypeOf(r))||(e.push(r),r=null),y=0,h=e.length;h>y;y++)u=e[y],p(u);return d=o.call(this),r?(f?r.$on("$destroy",d):r.add(d),!0):d},u=function(){function n(){this.on=__bind(this.on,this),this.on1=__bind(this.on1,this),this["if"]=__bind(this["if"],this),this.if1=__bind(this.if1,this)}return n.prototype.emit=function(){var e,t,r;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],p(t),this._halt&&(t=this._halt+"#!"+t),(r=null!=this.subscriptions?this.subscriptions:this.subscriptions=new i).emit.apply(r,[t].concat(__slice.call(e)))},n.prototype.emitted=function(e){var t,r,n;return p(e),(null!=(r=t=null!=(n=this.subscriptions)?n.names[e]:void 0)?r.fired:void 0)?t.lastArgs:!1},n.prototype.halt=function(){return this._halt=(this._halt||0)+1},n.prototype.unhalt=function(){return this._halt-=1},n.prototype.if1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o,u;for(n=[],o=0,u=t.length;u>o;o++)r=t[o],this.subscriptions.instantCall(r,e)||n.push(r);return this.subscriptions.push(n,1,e)})},n.prototype["if"]=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o;for(n=0,o=t.length;o>n;n++)r=t[n],this.subscriptions.instantCall(r,e);return this.subscriptions.push(t,0,e)})},n.prototype.on1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,1,e)})},n.prototype.on=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,0,e)})},n.prototype.unsubscriber=function(n){var o,u,i;return o={},i=0,u=function(){var t,n,u;u=null;for(t in o)n=o[t],l(n)?n()||(u=!1):null!=n.$$intervalId?e.cancel(n):r.cancel(n);return u},null!=n&&(t.isPrototypeOf(n)||a({scope:n,required:"$rootScope descendant"}),n.$on("$destroy",u)),u[s]=!0,u.add=function(e){return function(t){var r,n;return r=function(){return delete o[t]},n=function(){return a({unsubscriber:e,argument:1,required:["function","Promise"]})},c(e)?null!=e.$$timeoutId&&null!=e["finally"]?e["finally"](r):null!=e.$$intervalId&&null!=e["finally"]?e["finally"](r):n():l(e)&&e[s]||n(),o[t]=e}(i),i+=1,!0},u},n}()}]),angular.module("ksc").factory("ksc.ListMapper",["ksc.util",function(e){var t,r,n;return n=e.defineValue,r=function(e,t){var r,n,o;if(t)for(n=0,o=t.length;o>n;n++)r=t[n],e=e[r];return e},t=function(){function t(e){var t,r,o;this.parent=e,r=this,o=e.source,n(r,"map",{},0,1),n(r,"pseudo",{},0,1),n(r,"multi",o&&!o._,0,1),n(r,"_sources",[],0,1),t=function(e,n,o,u){var i,s,a,l,c,p;if(l=e.source){if(l._)return t(l._,n,o,u);p=[];for(a in l)s=l[a],n[a]={},o[a]={},c=function(){var e,t,r;for(r=[],e=0,t=u.length;t>e;e++)i=u[e],r.push(i);return r}(),c.push(a),p.push(t(s,n[a],o[a],c));return p}return r._sources.push({names:u,source:e})},t(e,r.map,r.pseudo,[]),Object.freeze(r._sources)}return t.prototype.map=null,t.prototype.multi=null,t.prototype.parent=null,t.prototype.pseudo=null,t.prototype.add=function(e,t){var n,o,u;return o=this,null!=e._id?(n=e._id,u=o.map):(n=e._pseudo,u=o.pseudo),u=r(u,t),u[n]=e},t.prototype.del=function(t,n,o){var u,i;u=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(i=u.pseudo,t=n):i=u.map,i=r(i,o),delete i[t]},t.prototype.has=function(t,n,o){var u,i,s;return i=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(u=n,s=i.parent.pseudo):(u=t,s=i.parent.map),s=r(s,o),s[u]||!1},t.register=function(e){var r;r=new t(e),n(e,"_mapper",r,0,1),n(e,"map",r.map,0,1),n(e,"pseudo",r.pseudo,0,1)},t}()}]),angular.module("ksc").factory("ksc.ListMask",["$rootScope","ksc.EventEmitter","ksc.List","ksc.ListMapper","ksc.ListSorter","ksc.error","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p,f,d,y,h,g,_,m,v;return a="_scopeUnsubscriber",c=u.ArgumentType,d=i.defineGetSet,y=i.defineValue,h=i.isObject,p=Array.prototype.push,l=function(e,t){var r,n,o,u,i;if(o=v(e,t),e.sorter)for(u=0,i=o.length;i>u;u++)r=o[u],n=e.sorter.position(r),Array.prototype.splice.call(e,n,0,r);else p.apply(e,o)},f=function(e,t){var r,n,o;for(o=[];r=Array.prototype.pop.call(e);)n=r._original||r,__indexOf.call(t,n)<0&&o.push(r);o.length&&(o.reverse(),p.apply(e,o))},g=function(e){var t,r,n,o,u,s,a,l;for(i.empty(e),a=e._mapper._sources,n=0,u=a.length;u>n;n++)for(r=a[n],l=r.source,o=0,s=l.length;s>o;o++)t=l[o],e.filter(t)&&p.apply(e,v(e,t))},_=function(e){var t,r,n,o;t=function(){return!0},(r=e.options.filter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({filter_function:n,required:"function"}),r=n,e.update()},d(e,"filter",n,o,1),d(e.options,"filter",n,o,1)},m=function(e){var t,r,n,o;t=function(){return!1},(r=e.options.splitter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({splitter_function:n,required:"function"}),r=n,e.update()},d(e,"splitter",n,o,1),d(e.options,"splitter",n,o,1)},v=function(e,t){var r,n,o,i,s,a,l,c,p;if((s=e.splitter(t))&&s instanceof Array){for(i=[],c=0,p=s.length;p>c;c++){r=s[c],h(r)||u.Type({splitter:e.splitter,description:"If Array is returned, all elements must be objects with override data"}),o=Object.create(t),l=function(e,t){var r,n;return r=function(){return t[e]},n=function(r){return t[e]=r},d(o,e,r,n,1)};for(n in t)l(n,t);for(n in r)a=r[n],y(o,n,a,0,1);y(o,"_original",t),i.push(o)}return i}return[t]},s=function(){function i(r,s,p,f){var d,g,v,b,k,j,O,w,q,A,P,C,S,x,R,K,$,T,L,V,U,E,M,I;(r instanceof Array||"object"!=typeof r)&&(r={_:r}),k=0;for(w in r)O=r[w],O instanceof Array&&O.options&&O.events instanceof t||c({source:O,name:w,required:"List"}),k+=1,y(r,w,O,0,1);Object.freeze(r),r._&&k>1&&c({source:r,conflict:'Can not have unnamed ("_") and named sources mixed'}),h(s)&&(f=p,p=s,s=null),null==p&&(p={}),h(p)||c({options:p,argument:3,required:"object"}),e.isPrototypeOf(p)&&(f=p,p={}),null!=f&&(e.isPrototypeOf(f)||c({scope:f,required:"$rootScope descendant"})),s&&(p.filter=s),v=[],U=this.constructor.prototype;for(g in U)P=U[g],y(v,g,P,0,1);for(E=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],S=0,$=E.length;$>S;S++)g=E[S],v[g]&&y(v,g,void 0);for(y(v,"events",new t,0,1),y(v,"options",p),y(v,"source",r,0,1),_(v),m(v),n.register(v),q=v._mapper._sources,f&&y(v,a,f.$on("$destroy",function(){return delete v[a],v.destroy()})),A=null,d=[],C=function(e){var t;return t=e.source.events.on("update",function(t){return i.update.call(v,t,e.names)}),A?A.add(t):A=t,A.add(e.source.events.on("destroy",function(){return v.destroy()}))},x=0,T=q.length;T>x;x++)j=q[x],M=j.source,__indexOf.call(d,M)>=0&&u.Value({sources:q,conflict:"Source can not be referenced twice to keep list unique"}),d.push(j.source),C(j);for(y(v,"_sourceUnsubscriber",A),o.register(v,p.sorter),R=0,L=q.length;L>R;R++)for(j=q[R],I=j.source,K=0,V=I.length;V>K;K++)b=I[K],v.filter(b)&&(v._mapper.add(b,j.names),l(v,b));return v}return i.prototype._mapper=null,i.prototype.events=null,i.prototype.filter=null,i.prototype.map=null,i.prototype.options=null,i.prototype.pseudo=null,i.prototype.sorter=null,i.prototype.source=null,i.prototype.splitter=null,i.prototype.destroy=r.prototype.destroy,i.prototype.update=function(){var e,t,r,n,o,u,i,s,a,c,p,d,y;for(e={},r=this,n=r._mapper,d=n._sources,s=0,c=d.length;c>s;s++)for(u=d[s],i=u.names,y=u.source,a=0,p=y.length;p>a;a++)o=y[a],t=n.has(o,null,i),r.filter(o)?t||(n.add(o,i),l(r,o),(null!=e.add?e.add:e.add=[]).push(o)):t&&(n.del(o,null,i),(null!=e.cut?e.cut:e.cut=[]).push(o));return e.cut&&f(r,e.cut),g(r),(e.add||e.cut)&&r.events.emit("update",{node:r,action:e}),e},i.update=function(e,t){var r,n,o,u,i,s,a,c,p,d,y,h,_,m,v,b,k,j,O,w,q,A,P,C,S,x,R,K,$,T,L,V;if(r=null,o=[],d=this,c=e.action,y=d._mapper,n=function(e,t){var n;return(null!=(n=null!=r?r:r={})[e]?n[e]:n[e]=[]).push(t)},u=function(e,r,u){return y.has(e,r,t)?(n("cut",u),o.push(u),y.del(e,r,t)):void 0},s=function(e,r,n){var o;return(o=y.has(e,r,t))||y.add(n,t),o},i=function(e,r){var n;return(n=y.has(e,r,t))&&y.del(e,r,t),n},c.cut)for(K=c.cut,A=0,S=K.length;S>A;A++)m=K[A],u(m._id,m._pseudo,m);if(c.add)for($=c.add,P=0,x=$.length;x>P;P++)m=$[P],d.filter(m)&&(s(m._id,m._pseudo,m),l(d,m),n("add",m));if(c.update)for(T=c.update,C=0,R=T.length;R>C;C++)if(e=T[C],L=e,m=L.record,e=L.info,h=L.merge,_=L.move,b=L.source,a=O=null,(v=h||_)&&(a=v.from,O=v.to),d.filter(m))if(k=a&&i(a.map,a.pseudo),j=O?s(O.map,O.pseudo,m):s(m._id,m._pseudo,m),k&&j)n("update",{record:m,info:e,merge:v,source:b}),o.push(b);else if(k)n("update",{record:m,info:e,move:v});else if(j){w={record:m},V={info:e,source:b};for(p in V)q=V[p],null!=q&&(w[p]=q);n("update",w)}else l(d,m),n("add",m);else h?(u(a.map,a.pseudo,b),u(O.map,O.pseudo,m)):_?u(a.map,a.pseudo,m):u(m._id,m._pseudo,m);d.sorter?o.length&&f(d,o):g(d),r&&d.events.emit("update",{node:d,action:r})},i}()}]),angular.module("ksc").factory("ksc.ListSorter",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.defineValue,o=t.isKeyConform,r=function(){function r(u,i){var s,a,l;a=this,n(a,"list",u,0,0),"function"==typeof i?a.fn=i:((o(i)||i instanceof Array)&&(i={key:i}),t.isObject(i)&&(o(s=i.key)||s instanceof Array)||e.Value({sorter:i,requirement:"function or string or array or object: {key: <string|array>, reverse: <bool>, type: 'natural|number|byte'}"}),(l=i.type)?"byte"!==l&&"natural"!==l&&"number"!==l&&e.Value({type:l,required:"byte, natural or number"}):l="natural",n(a,"key",s,0,1),n(a,"reverse",!!i.reverse,0,1),n(a,"type",l,0,1),n(a,"fn",r.getSortFn(a),0,1)),Object.preventExtensions(a)}return r.prototype.fn=null,r.prototype.key=null,r.prototype.list=null,r.prototype.reverse=null,r.prototype.type=null,r.prototype.position=function(t){var r,n,o,u,i,s,a,l;return l=this,n=l.fn,i=l.list,(u=i.length)?(a=0,s=u-1,r=function(t){return("number"!=typeof t||isNaN(t))&&e.Type({sort_fn_output:t,required:"number"}),t},r(n(t,i[a]))<0?a:1===u?1:r(n(t,i[s]))>=0?s+1:(o=function(e,u){var s;return u-1>e?(s=Math.floor((u-e)/2+e),r(n(t,i[s]))<0?o(e,s):o(s,u)):u})(a,s)):0},r.getSortFn=function(e){var t,r,n,u,i,s;return r=e.key,i=e.reverse,s=e.type,i=i?-1:1,t=function(e,t){var r;return function(){var n,o,u;for(u=[],n=0,o=t.length;o>n;n++)r=t[n],null!=e[r]&&u.push(e[r]);return u}().join(" ")},u=function(e){return"number"!=typeof e?"string"==typeof e&&""!==e?Number(e):0/0:e},n=function(e,t){var r,n,o,u,i,s,a,l;if(e=String(e).toLowerCase(),t=String(t).toLowerCase(),s=0,l=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g,e===t)return 0;for(n=e.toLowerCase().match(l),u=t.toLowerCase().match(l),r=null!=n?n.length:0;r>s;)return null==u||void 0===u[s]?1:(o=n[s],i=u[s],s+=1,a=o-i,isNaN(a)?o>=i?1:-1:a);return-1},function(e,a){var l,c;if(o(r)?(e=e[r],a=a[r]):(e=t(e,r),a=t(a,r)),"number"===s){if(l=e,c=a,e=u(e),a=u(a),isNaN(e))return isNaN(a)?n(l,c)*i:-1*i;if(isNaN(a))return 1*i}else null==e&&(e=""),null==a&&(a="");return"natural"===s?n(e,a)*i:("byte"===s&&(e=String(e),a=String(a)),e===a?0:(e>a?1:-1)*i)}},r.register=function(e,n){var o,u,i;i=null,n&&(i=new r(e,n)),o=function(){return i},u=function(t){return t?(i=new r(e,t),Array.prototype.sort.call(e,i.fn),e.events.emit("update",{node:e,action:{sort:!0}})):i=null},t.defineGetSet(e,"sorter",o,u,1),t.defineGetSet(e.options,"sorter",o,u,1)},r}()}]),angular.module("ksc").factory("ksc.List",["$rootScope","ksc.EditableRecord","ksc.EventEmitter","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,u,i,s){var a,l,c,p,f,d,y,h;return l="_scopeUnsubscriber",c=i.ArgumentType,p=s.defineValue,y=s.isObject,h=function(e,t){return"boolean"!=typeof t&&(e.push(t),t=!1),t},f=function(e,t){return e.events.emit("update",{node:e,action:t})},d=function(e,t,r){var n;(n=Array.prototype.splice).call.apply(n,[e,t,0].concat(__slice.call(r)))},a=function(){function a(t,u){var i,a,f,d,y;null==t&&(t={}),a=[],s.isObject(t)||c({options:t,argument:3,required:"object"}),e.isPrototypeOf(t)&&(u=t,t={}),null!=u&&(e.isPrototypeOf(u)||c({scope:u,required:"$rootScope descendant"})),y=this.constructor.prototype;for(i in y)f=y[i],-1===i.indexOf("constructor")&&p(a,i,f,0,1);return t=angular.copy(t),p(a,"options",t),null==(d=a.options).record&&(d.record={}),p(a,"events",new r,0,1),n.register(a),u&&p(a,l,u.$on("$destroy",function(){return delete a[l],a.destroy()})),o.register(a,t.sorter),a}return a.prototype._mapper=null,a.prototype.events=null,a.prototype.map=null,a.prototype.pseudo=null,a.prototype.options=null,a.prototype.sorter=null,a.prototype.destroy=function(){var e,t;if(t=this,Object.isFrozen(t))return!1;t.events.emit("destroy"),"function"==typeof t[l]&&t[l](),"function"==typeof t._sourceUnsubscriber&&t._sourceUnsubscriber(),s.empty(t);for(e in t)"destroy"!==e&&delete t[e];return delete t.options,delete t._sourceUnsubscriber,Object.freeze(t),!0},a.prototype.cut=function(){var e,t,r,n,o,u,s,a,l,c,p,h;for(a=1<=arguments.length?__slice.call(arguments,0):[],a.length||i.MissingArgument({name:"record",argument:1}),t=[],o=this,u=o._mapper,l=[],p=0,h=a.length;h>p;p++)s=a[p],y(s)?(__indexOf.call(o,s)<0&&i.Value({record:s,description:"not found in list"}),u.has(s)||i.Key({record:s,description:"map/pseudo id error"}),u.del(s),t.push(s)):(r=s,(s=u.has(r))||i.Key({id:r,description:"map id error"}),u.del(r),t.push(s._id!==r?r:s)),l.push(s);for(c=[];n=Array.prototype.pop.call(o);)__indexOf.call(l,n)<0&&c.push(n);return c.length&&(c.reverse(),d(o,o.length,c)),e={cut:t},f(o,e),e},a.prototype.empty=function(e){var t,r,n,o,u;n=this,t={cut:[]},n.events.halt();try{for(r=o=0,u=n.length;u>o;r=o+=1)t.cut.push(n.shift())}finally{n.events.unhalt()}return t.cut.length&&f(n,t),e?t:this},a.prototype.pop=function(){return a.remove(this,"pop")},a.prototype.push=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,r.length),n?e:r.length},a.prototype.shift=function(){return a.remove(this,"shift")},a.prototype.unshift=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,0),n?e:r.length},a.prototype.splice=function(){var e,t,r,n,o,u,i,l,p;u=arguments[0],t=arguments[1],r=4<=arguments.length?__slice.call(arguments,2,p=arguments.length-1):(p=2,[]),l=arguments[p++],l=h(r,l),"undefined"==typeof r[0]&&1===r.length&&r.pop(),"boolean"!=typeof t||r.length||(l=t,t=null),i=function(e,t){return"number"==typeof e&&(e>0||0===e)&&e===Math.floor(e)?void 0:c({value:e,argument:t,required:"int >= 0"})},e={},o=this,n=o.length,0>u&&(u=Math.max(n+u,0)),i(u),u=Math.min(n,u),null!=t?(i(t),t=Math.min(n-u,t)):t=n-u,o.events.halt();try{t>0&&(e=o.cut.apply(o,o.slice(u,u+t))),r.length&&s.mergeIn(e,a.add(o,r,u))}finally{o.events.unhalt()}return(e.cut||e.add||e.update)&&f(o,e),l?e:e.cut||[]},a.prototype.reverse=function(){var e;return e=this,e.sorter&&i.Permission("can not reverse an auto-sorted list"),e.length>1&&(Array.prototype.reverse.call(e),f(e,{reverse:!0})),e},a.prototype.sort=function(e){var t,r,n,o,u,s;if(n=this,n.sorter&&i.Permission("can not reverse an auto-sorted list"),n.length>1)for(t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o);return r}(),null==e&&(e=function(e,t){return null===e._id&&null===t._id?e._pseudo-t._pseudo:null===e._id?-1:null===t._id?1:e._id>t._id?1:-1}),Array.prototype.sort.call(n,e),r=u=0,s=n.length;s>u;r=++u)if(o=n[r],o!==t[r]){f(n,{sort:!0});break}return n},a.prototype._recordChange=function(e,t,r){var n,o,a,l,c,y,h,g,_,m;if(e instanceof u||i.Type({record:e,required:"Record"}),l=this,c=l.map,y=l._mapper,n=function(){return p(e,"_pseudo",null),y.add(e)},o={record:e,info:t},r!==e._id){l.events.halt();try{null==e._id?(y.del(r),p(e,"_pseudo",s.uid("record.pseudo")),y.add(e),o.move={from:{map:r},to:{pseudo:e._pseudo}}):null==r?c[e._id]?(o.merge={from:{pseudo:e._pseudo},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(e),l.push(e)):(o.move={from:{pseudo:e._pseudo},to:{map:e._id}},y.del(null,e._pseudo),n()):c[e._id]?(o.merge={from:{map:r},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(r),l.push(e)):(o.move={from:{map:r},to:{map:e._id}},y.del(r),n())}finally{l.events.unhalt()}}if(l.sorter)for(e=o.record,g=_=0,m=l.length;m>_;g=++_)if(a=l[g],a===e){Array.prototype.splice.call(l,g,1),h=l.sorter.position(e),d(l,h,[e]);break}return f(l,{update:[o]})},a.add=function(e,r,n){var o,a,l,c,h,g,_,m,v,b,k,j;r.length||i.MissingArgument({name:"item",argument:1}),o={},c=e._mapper,e.events.halt();try{for(m=[],_=e.options.record,g=_["class"]||t,v=0,k=r.length;k>v;v++)l=r[v],h=l,y(l)||i.Type({item:l,required:"object"}),l instanceof g?(l._parent&&l._parent!==e&&l._parent.cut(l),p(l,"_parent",e)):(l instanceof u&&(l=l._clone(!0)),l=new g(l,_,e)),null!=l._id?((a=c.has(l._id))?(a._replace(l._clone(!0)),(null!=o.update?o.update:o.update=[]).push({record:a,source:h})):(c.add(l),m.push(l),(null!=o.add?o.add:o.add=[]).push(l)),l._pseudo&&p(l,"_pseudo",null)):(p(l,"_pseudo",s.uid("record.pseudo")),c.add(l),m.push(l),(null!=o.add?o.add:o.add=[]).push(l));if(m.length)if(e.sorter)for(b=0,j=m.length;j>b;b++)l=m[b],n=e.sorter.position(l),d(e,n,[l]);else d(e,n,m)}finally{e.events.unhalt()}return f(e,o),o},a.remove=function(e,t){var r;return(r=Array.prototype[t].call(e))&&(e._mapper.del(r),f(e,{cut:[r]})),r},a}()}]),angular.module("ksc").factory("ksc.Mixin",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=function(r,n,o){var u,i,s;for(null!=r&&"boolean"!=typeof r&&(n.unshift(r),r=!0),i=0,s=n.length;s>i;i++)u=n[i],t.isKeyConform(u)||e.Key({property:u,required:"key conform value"});return o(r,n)},o=function(e,r,n,o){var u;return t.hasProperty(e,r)?!1:null==n?!0:(u=__indexOf.call(o,r)>=0,n&&u||!n&&!u)},r=function(){function e(){}return e.extend=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendProto.apply(e,[r,n,t].concat(__slice.call(o))),e.extendInstance.apply(e,[r,n,t].concat(__slice.call(o)))},e.extendInstance=function(){var e,t,r,u;return t=arguments[0],r=arguments[1],e=arguments[2],u=4<=arguments.length?__slice.call(arguments,3):[],n(e,u,function(e,n){var u,i;for(u in r)i=r[u],o(t,u,e,n)&&(t[u]=i)})},e.extendProto=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendInstance.apply(e,[r.prototype,n.prototype,t].concat(__slice.call(o)))},e}()}]),angular.module("ksc").factory("ksc.RecordContract",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.hasOwn,o=t.isObject,r=function(){function t(r){var u,i;if(null===r||r instanceof t)return r;o(r)||e.Type({contract:r,required:"object"});for(i in r)u=r[i],"_"===i.substr(0,1)&&e.Key({key:i,description:'can not start with "_"'}),this[i]=u,u.nullable?u.nullable=!0:delete u.nullable,"object"!==u.type||o(u.contract)||e.Type({contract:u.contract,description:"contract description object is required"}),u.contract?(n(u,"type")&&"object"!==u.type&&e.Type({contract:u.contract,required:"object"}),n(u,"default")&&e.Value({"default":u["default"],contract:u.contract,description:"subcontract can not have default value"}),delete u.type,u.contract=new t(u.contract)):(n(u,"default")&&!n(u,"type")&&null!=t.typeDefaults[typeof u["default"]]&&(u.type=typeof u["default"]),null==t.typeDefaults[u.type]&&e.Type({type:u.type,required:"boolean, number, object, string"})),this._match(i,this._default(i));Object.freeze(this)}return t.prototype._default=function(r){var o,u,i;if(o=this[r],o||e.Key({key:r,description:"Key not found on contract"}),n(o,"default"))return o["default"];if(o.nullable)return null;if(o.contract){u={},i=o.contract;for(r in i)__hasProp.call(i,r)&&(u[r]=o.contract._default(r));return u}return t.typeDefaults[o.type]},t.prototype._match=function(t,r){var n;if(n=this[t],null!=n){if(n.contract&&o(r)||typeof r===n.type)return!0;if(null===r&&n.nullable)return!0}return e.ContractBreak({key:t,value:r,contract:n})},t.finalizeRecord=function(e){e._options.contract&&Object.isExtensible(e)&&Object.preventExtensions(e)},t.typeDefaults={"boolean":!1,number:0,string:""},t}()}]),angular.module("ksc").factory("ksc.Record",["ksc.EventEmitter","ksc.RecordContract","ksc.error","ksc.util",function(e,t,r,n){var o,u,i,s,a,l,c,p,f,d,y,h;return o="_events",u="_id",i="idProperty",s="_options",a="_parent",l="_parentKey",c="_pseudo",f=n.defineValue,d=n.hasOwn,y=n.isObject,h=function(e,t,n){var o;return y(t)?void 0:(o={},o[e]=t,o.argument=n,o.required="object",r.ArgumentType(o))},p=function(){function p(i,p,y,g){var _,m,v,b,k,j,O;null==i&&(i={}),null==p&&(p={}),h("data",i,1),h("options",p,2),m=this,f(m,s,p),d(p,"contract")&&(p.contract=new t(p.contract)),(null!=y||null!=g)&&(h("options",y,3),f(m,a,y),null!=g&&(n.isKeyConform(g)||r.Type({parent_key:g,argument:4,required:"key conform value"}),f(m,l,g),delete m[u],delete m[c])),O=n.propertyRefs(Object.getPrototypeOf(m));for(_ in O)for(b=O[_],k=0,j=b.length;j>k;k++)v=b[k],Object.defineProperty(v,_,{enumerable:!1});null==g&&(f(m,u,void 0),f(m,c,void 0),f(m,o,new e),m[o].halt()),m._replace(i),null!=g?f(m,o,null):m[o].unhalt(),t.finalizeRecord(m)}return p.prototype._events=void 0,p.prototype._id=void 0,p.prototype._options=void 0,p.prototype._parent=void 0,p.prototype._parent_key=void 0,p.prototype._pseudo=void 0,p.prototype._clone=function(e){var t,r,n,o;null==e&&(e=!1),t={},n=this;for(r in n)o=n[r],y(o)&&(o=o._clone(!0)),t[r]=o;return e?t:new n.constructor(t)},p.prototype._entity=function(){return this._clone(!0)},p.prototype._replace=function(e,t){var u,a,c,h,g,_,m,v,b,k,j,O;if(null==t&&(t=!0),v=this,null===v[o]&&r.Permission({key:v[l],description:"can not replace subobject"}),_=v[s],a=_.contract,null==_[i])for(g in e){_[i]=g;break}if(h=function(e){var t;return a&&(null==a[e]&&r.ContractBreak({key:e,contract:a,mismatch:"idProperty"}),"string"!==(t=a[e].type)&&"number"!==t)?r.ContractBreak({key:e,contract:a,required:"string or number"}):void 0},v[o]&&(c=_[i]))if(c instanceof Array)for(j=0,O=c.length;O>j;j++)m=c[j],h(m),null==e[m]&&(e[m]=null);else h(c),null==e[c]&&(e[c]=null);if(u=!1,b=function(e,t){var r,o;if(!n.identical(v[e],t))return y(t)&&(t instanceof p&&(t=t._clone(1)),r=_.subtreeClass||p,o={},a&&(o.contract=a[e].contract),t=new r(t,o,v,e)),u=!0,f(v,e,t,0,1)
},a){for(g in e)k=e[g],a._match(g,k);for(g in a)k=d(e,g)?e[g]:a._default(g),b(g,k)}else{for(g in e)k=e[g],"_"===g.substr(0,1)&&r.Key({key:g,description:'can not start with "_"'}),"function"==typeof k&&r.Type({value:k,description:"can not be function"}),b(g,k);for(g in v)d(e,g)||(delete v[g],u=!0)}return u&&v[o]&&t&&p.emitUpdate(v,"replace"),u},p.emitUpdate=function(e,t,r){var n,i,s,c,f,d,y,h;for(null==r&&(r={}),f=[],d=e;!(n=d[o]);)f.unshift(d[l]),d=d[a];i={node:e},e!==d&&(i.parent=d,i.path=f),i.action=t;for(s in r)y=r[s],i[s]=y;c=d[u],p.setId(d),d[o]._halt||null!=(h=d[a])&&"function"==typeof h._recordChange&&h._recordChange(d,i,c),n.emit("update",i)},p.setId=function(e){var t,r,o,a,l,c,p,d;if(a=e[s][i])if(a instanceof Array){for(t=[],r=p=0,d=a.length;d>p;r=++p)if(l=a[r],n.isKeyConform(e[l]))t.push(e[l]);else if(!r)break;o=t.length?t.join("-"):null,f(e,u,o),f(e,"_primaryId",e[a[0]])}else c=e[a],f(e,u,null!=c?c:null)},p}()}]),angular.module("ksc").factory("ksc.RestList",["$http","$q","ksc.List","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p;return a="restCache",l="restPending",s="_primaryId",p=i.defineValue,c=function(r){function a(){return a.__super__.constructor.apply(this,arguments)}return __extends(a,r),a.prototype.restCache=null,a.prototype.restPending=0,a.prototype.restGetRaw=function(t,r){var i,s,a,c,f,d,y;return"function"==typeof t&&(r=t,t=null),a=this,(i=a.options.endpoint)&&(d=i.url)&&"string"==typeof d||o.Type({"options.endpoint.url":d,required:"string"}),p(a,l,a[l]+1,0,1),(f=n.get(d,t))||(t&&(c=function(){var e;e=[];for(s in t)y=t[s],e.push(encodeURIComponent(s)+"="+encodeURIComponent(y));return e}(),c.length&&(d+=(d.indexOf("?")>-1?"&":"?")+c.join("&"))),f=e.get(d)),u.wrapPromise(f,function(e,t){return p(a,l,a[l]-1,0,1),r(e,t)})},a.prototype.restLoad=function(e,t,r){var n,o,i;return"boolean"!=typeof e&&(r=t,t=e,e=null),"function"==typeof t&&(r=t,t=null),o=this,i=o.options,n=function(){return o.restGetRaw(t,function(e,t){var n,u,i;if(!e)try{n=a.getResponseArray(o,t.data),u=o.push.apply(o,__slice.call(n).concat([!0]))}catch(s){i=s,e=i}return"function"==typeof r?r(e,u,t):void 0})},i.cache&&o.restCache&&!e?r&&u.wrapPromise(o.restCache,r):p(o,"restCache",n(),0,1),o.restCache},a.prototype.restSave=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,1,t,e)},a.prototype.restDelete=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,0,t,e)},a.getResponseArray=function(e,t){var r,n,u,i;if(r=e.options.endpoint,u="responseProperty","undefined"==typeof r[u]){Array.isArray(t)&&(r[u]=null);for(n in t)i=t[n],Array.isArray(i)&&(r[u]=n)}return null!=r[u]&&(t=t[r[u]]),t instanceof Array||o.Value({"options.endpoint.responseProperty":void 0,description:"array type property in response is not found or unspecified"}),t},a.relatedRecords=function(e,t){var r,n,o,u,i;if(null==(r=t[s]))return[t];for(i=[],o=0,u=e.length;u>o;o++)n=e[o],n[s]===r&&i.push(n);return i},a.updateOnSave=function(e,r,n,o){var u,i,a,l,c,p,f,d,y,h,g,_,m,v,b,k;for(f=[],h=[],a=m=0,b=r.length;b>m;a=++m)y=r[a],null!=(c=y[s])||e.options.reloadOnUpdate?(d={},l=y._options.idProperty,c?d[l[0]]=c:d[l]=y._id,f.push(e.restLoad(d))):h.push([y,n[a]]);if(h.length){e.events.halt(),u=[],_=e.events.on("1#!update",function(e){return u.push(e.action.update[0])});try{for(v=0,k=h.length;k>v;v++)g=h[v],y=g[0],i=g[1],y._replace(i)}finally{_(),e.events.unhalt()}u.length&&e.events.emit("update",{node:e,action:{update:u}})}f.length?(p=t.all(f),p.then(o,o)):o()},a.writeBack=function(e,t,r,n){var u,l,c,p,f,d,y,h,g,_,m;for(n&&"function"==typeof n||(n&&r.push(n),n=null),g={},c=_=0,m=r.length;m>_;c=++_)y=r[c],i.isObject(y)||(r[c]=y=e.map[y]),f=y,d=null,h="id:"+(p=null!=y?y._id:void 0),null==(p=null!=y?y._id:void 0)?(d=null!=y?y._pseudo:void 0,h="pseudo:"+d):null!=y[s]&&(h="id:"+y[s]),t?(y=d&&e.pseudo[d]||e.map[p],y||o.Key({key:f,description:"no such record on list"})):(y=e.map[p])||o.Key({key:f,description:"no such record on map"}),g[h]&&o.Value({uid:h,description:"not unique"}),g[h]=y;return r.length||o.MissingArgument({name:"record",argument:1}),l=e.options.endpoint||{},t&&l.bulkSave?(u=String(l.bulkSave).toLowerCase(),"post"!==u&&(u="put"),a.writeBulk(e,u,r,n)):!t&&l.bulkDelete?a.writeBulk(e,"delete",r,n):a.writeSolo(e,t,r,n)},a.writeBulk=function(t,r,n,i){var c,p,f,d,y,h,g;return(g=t.options.endpoint.url)&&"string"==typeof g||o.Type({"options.endpoint.url":g,required:"string"}),h="delete"!==r,p=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)y=n[e],h?r.push(y._entity()):(null==(f=y[s])&&(f=y._id),r.push(f));return r}(),c=[g],h&&c.push(p),t[l]+=1,d=e[r].apply(e,c),u.wrapPromise(d,function(e,r){var o,u,s,c;for(t[l]-=1,o=function(){return"function"==typeof i?i(e,u,r):void 0},u=[],s=0,c=n.length;c>s;s++)y=n[s],u.push.apply(u,a.relatedRecords(t,y));return e||(h?a.updateOnSave(t,n,r.data,o):(t.cut.apply(t,u),o())),o()})},a.writeSolo=function(t,r,n,i){var c,p,f,d,y;return y=[],c=d=null,p=function(e){var t;return t=Array.prototype.slice.call(arguments,1),c=[e,y].concat(__slice.call(t)),d?void 0:("function"==typeof i&&i.apply(null,c),c=null)},f=function(n){var p,f,h,g,_,m,v;return null==(f=n[s])&&(f=n._id),h="delete",_=null!=(m=t.options.record.endpoint)?m.url:void 0,r&&(h="put",n._pseudo&&(h="post",f=null,_=null!=(v=t.options.endpoint)?v.url:void 0)),_&&"string"==typeof _||o.Value({"options.record.endpoint.url":_,required:"string"}),_=_.replace("<id>",f),p=[_],r&&p.push(n._entity()),t[l]+=1,g=e[h].apply(e,p),u.wrapPromise(g,function(e,o){var u;t[l]-=1,u=a.relatedRecords(t,n),e||(r?(d=(d||0)+1,a.updateOnSave(t,[n],[o.data],function(){return d-=1,c&&"function"==typeof i?i.apply(null,c):void 0})):t.cut.apply(t,u)),y.push.apply(y,u)})},u.asyncSquash(n,f,p)},a}(r)}]),angular.module("ksc").factory("ksc.RestRecord",["$http","ksc.Record","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u){var i,s,a,l,c;return i="_options",s="_restCache",a="_restPending",c=u.defineValue,l=function(t){function u(){c(this,a,0),u.__super__.constructor.apply(this,arguments)}return __extends(u,t),u.prototype._restCache=null,u.prototype._restPending=0,u.prototype._restLoad=function(t,n){var a,l;return l=this,a=function(){var t,o;return o=u.getUrl(l),(t=r.get(o))||(t=e.get(o)),u.async(l,t,n)},"boolean"!=typeof t&&(n=t,t=null),l[i].cache&&l[s]&&!t?n&&o.wrapPromise(l[s],n):c(l,s,a()),l[s]},u.async=function(e,t,r){return c(e,a,e[a]+1),o.wrapPromise(t,function(t,n){return c(e,a,e[a]-1),!t&&n.data&&e._replace(n.data),"function"==typeof r?r(t,n):void 0})},u.getUrl=function(e){var t,r;return(t=e[i].endpoint)&&null!=(r=t.url)||n.Value({"_options.endpoint.url":void 0}),"string"!=typeof r&&n.Type({"_options.endpoint.url":r,required:"string"}),r},u}(t)}]),angular.module("ksc").service("ksc.restUtil",["$q","ksc.error",function(e,t){var r;return r=function(){function r(){}return r.asyncSquash=function(n,o,u){var i,s,a,l,c,p,f;return i=0,s=[],c=n.length,f=[],a=function(e,r){var n,o,a,l;return o=r.data,l=r.status,a=r.headers,n=r.config,i+=1,null!=e&&s.push(e),f.push({error:e,data:o,status:l,headers:a,config:n}),i===c&&u?(t=null,1===s.length?t=s[0]:s.length&&(t=s),u.apply(null,[t].concat(__slice.call(f)))):void 0},p=function(){var e,t,u;for(u=[],e=0,t=n.length;t>e;e++)l=n[e],u.push(r.wrapPromise(o(l),a));return u}(),p.length<2?p[0]:e.all(p)},r.wrapPromise=function(e,r){var n,o;return o=function(e){var t,n,o,u,i;return n=e.data,u=e.status,o=e.headers,t=e.config,i=e,r(null,i)},n=function(e){var n,o,u,i,s,a;return o=e.data,s=e.status,i=e.headers,n=e.config,a=e,u=new t.type.Http(e),a.error=u,r(u,a)},e.then(o,n),e},r}()}]),angular.module("ksc").service("ksc.util",["ksc.error",function(e){var t,r,n,o,u,i,s;return n=Object.defineProperty,o=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,r=function(t){return t.length?void 0:e.MissingArgument({name:"reference",argument:1})},t=function(){function t(){}return t.defineGetSet=function(e,t,r,o,u){return"function"!=typeof o&&(u=o,o=function(){}),n(e,t,{configurable:!0,enumerable:!!u,get:r,set:o})},t.defineValue=function(e,t,r,u,i){var s;return(null!=(s=o(e,t))?s.writable:void 0)===!1&&n(e,t,{writable:!0}),n(e,t,{configurable:!0,enumerable:!!i,value:r,writable:!!u})},t.empty=function(){var t,r,n,o,u;for(n=1<=arguments.length?__slice.call(arguments,0):[],n.length||e.MissingArgument({argument:1}),s.apply(this,n)||e.Type({arguments:n,required:"All arguments must be objects"}),o=0,u=n.length;u>o;o++)if(r=n[o],Array.isArray(r))for(;Array.prototype.pop.call(r););else for(t in r)__hasProp.call(r,t)&&delete r[t]},t.hasOwn=function(e,t,r){return e&&e.hasOwnProperty(t)&&(null==r||r===e.propertyIsEnumerable(t))},t.hasProperty=function(e,t){for(;e;){if(e.hasOwnProperty(t))return!0;e=u(e)}return!1},t.identical=function(e,r){var n,o;if(!s(e,r))return e===r;for(n in e)if(o=e[n],!t.identical(o,r[n])||!i(r,n))return!1;for(n in r)if(!i(e,n))return!1;return!0},t.isEnumerable=function(e,t){try{return!!o(e,t).enumerable}catch(r){}return!1},t.isKeyConform=function(e){return!("string"!=typeof e||!e)||"number"==typeof e&&!isNaN(e)},t.isFunction=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],"function"!=typeof e)return!1;return!0},t.isObject=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],!e||"object"!=typeof e)return!1;return!0},t.mergeIn=function(){var t,r,n,o,u,i,a,l;for(u=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],o.length<1&&e.MissingArgument({required:"Merged and mergee objects"}),s(u)||e.Type({target_object:u,argument:1,required:"object"}),t=a=0,l=o.length;l>a;t=++a){n=o[t],s(n)||e.Type({object:n,argument:t+2,required:"object"});for(r in n)i=n[r],u[r]=i}return u},t.propertyRefs=function(t){var r,n,o;for(o={};s(t);){r=!0;for(n in t)__hasProp.call(t,n)&&(Array.isArray(o[n])||(o[n]=[]),o[n].push(t));t=u(t)}return r||e.ArgumentType({object:t,argument:1,accepts:"object"}),o},t.uid=function(r){var n,o;return o=null!=t._uidStore?t._uidStore:t._uidStore={named:{}},null!=r?(t.isKeyConform(r)||e.Key({name:r,requirement:"Key type name"}),n=o.named):(n=o,r="unnamed"),n[r]=(n[r]||0)+1},t}(),i=t.hasOwn,s=t.isObject,t}]);