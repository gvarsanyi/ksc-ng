var __hasProp={}.hasOwnProperty,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;ksc=angular.module("ksc",[]),ksc.factory("ksc.ArrayTracker",["ksc.error","ksc.util",function(e,t){var r,n,o,u,i,s,a,l,c;return n=t.defineGetSet,o=t.defineValue,u=t.hasOwn,i=Array.isArray,s=t.isObject,r=function(){function r(t,a){var c,p,f,d,y,h,g,_,m,v,b,k;for(null==a&&(a={}),u(t,"_tracker")&&e.Value({list:t,description:"List is already tracked"}),i(t)||e.ArgumentType({argument:1,list:t,description:"Must be an array"}),s(a)||e.ArgumentType({argument:2,options:a,description:"Must be an object"}),h=u(a,"store")?a.store:{},s(h)||e.Type({store:h,description:"Must be an object"}),g=this,o(t,"_tracker",g),o(g,"list",t,0,1),o(g,"store",h,0,1),o(g,"origFn",y={}),p=function(t){return null!=t?"function"!=typeof t&&e.Type({fn:t,"Must be a function":"Must be a function"}):t=null,t},f={},k=["del","get","set"],v=0,b=k.length;b>v;v++)d=k[v],f[d]=a[d]||null;_=function(e){return n(g,e,function(){return f[e]||null},function(t){return f[e]=p(t)},1)};for(d in f)c=f[d],f[d]=p(c),_(d);m=function(e){return o(t,e,function(){var t;return t=1<=arguments.length?__slice.call(arguments,0):[],r["_"+e].apply(g,t)})};for(d in r)c=r[d],"_"===d.substr(0,1)&&(d=d.substr(1),y[d]=u(t,d)?{v:t[d]}:{n:1},m(d));l(g)}return r.prototype.list=void 0,r.prototype.origFn=void 0,r.prototype.store=void 0,r.prototype.unload=function(e){var r,n,u,i,s,l,c;l=s=this,u=l.list,i=l.store,a(s),c=s.origFn;for(n in c)r=c[n],r.n?delete u[n]:o(u,n,r.v);delete s.list._tracker,delete s.list,e||t.empty(i)},r.add=function(e,t,n,o){var u,i,s,a,l,p,f,d,y,h;if(null==o&&(o=!0),s=e.list,l=e.store,i=t.length,a=s.length,o&&a>n)for(u=f=h=a-1;f>=n;u=f+=-1)c(e,u+i,l[u],"move");for(u=d=0,y=t.length;y>d;u=++d)p=t[u],c(e,u+n,p),o&&r.getterify(e,u+a);return s.length},r.getElement=function(e,t){return e.get?e.get(t,e.store[t]):e.store[t]},r.getterify=function(e,t){n(e.list,t,function(){return r.getElement(e,t)},function(r){return c(e,t,r)},1)},r.plainify=function(e){var t,r,n,o;n=e.list,o=e.store,t=function(){var e,t,u;for(u=[],r=e=0,t=n.length;t>e;r=e+=1)u.push(o[r]);return u}(),n.length=0,Array.prototype.push.apply(n,t)},r.process=function(e,t){var n,o,u,i,s;for(s=e.list,n=u=0,i=s.length;i>u;n=++u)o=s[n],r.getterify(e,n),c(e,n,o,t)},r.rm=function(e,t){var r,n,o,u,i,s,a,l,p;if(u=e.list,a=e.store,u.length){for(i=u.length,s=u[t],o=l=p=t+1;i>l;o=l+=1)c(e,o-1,a[o],"move");return(r=e.del)&&(n=a[i-1]),u.length=i-1,("function"==typeof r?r(i-1,n):void 0)!==!1&&delete a[i-1],s}},r.setElement=function(e,t,r,n){var o;o=function(){return arguments.length&&(r=arguments[0]),e.store[t]===r?!1:(e.store[t]=r,!0)},e.set?e.set(t,r,o,n||"external"):o()},r._pop=function(){return r.rm(this,this.list.length-1)},r._shift=function(){return r.rm(this,0)},r._push=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,this.list.length)},r._unshift=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,0)},r._splice=function(){var e,t,n,o,u,i,s,a,l,p,f,d,y,h,g,_,m,v,b,k;if(n=arguments[0],e=arguments[1],o=3<=arguments.length?__slice.call(arguments,2):[],_=f=this,i=_.list,p=_.store,u=o.length,a=i.length,n=parseInt(n,10)||0,n=0>n?Math.max(0,a+n):Math.min(n,a),e=parseInt(e,10)||0,e=Math.max(0,Math.min(e,a-n)),l=i.slice(n,n+e),s=function(t){return c(f,t-e+u,p[t],"move")},e>u){for(t=d=m=n+e;a>d;t=d+=1)s(t);for(t=y=0,v=e-u;v>y;t=y+=1)r.rm(f,a-t-1)}else if(u>e)for(t=h=b=a-1,k=n+e;h>=k;t=h+=-1)s(t);if(u){for(t=g=e;u>g;t=g+=1)r.getterify(f,t+a);r.add(f,o,n,0)}return l},r._sort=function(e){var t,r;return r=this,a(r),t=Array.prototype.sort.call(r.list,e),l(r,"reload"),t},r._reverse=function(){var e,t;return t=this,a(t),e=Array.prototype.reverse.call(t.list),l(t,"reload"),e},r}(),a=r.plainify,l=r.process,c=r.setElement,r}]),ksc.service("ksc.batchLoaderRegistry",["ksc.error",function(e){var t;return new(t=function(){function t(){}return t.prototype.map={},t.prototype.get=function(e,t){var r,n,o,u;u=this.map;for(r in u)if(n=u[r],o=n.get(e,t))return o;return!1},t.prototype.register=function(t){var r;return"string"==typeof(r=null!=t?t.endpoint:void 0)&&r||e.Value({endpoint:r,required:"url"}),this.map[r]&&e.Value({endpoint:r,description:"already registered"}),this.map[r]=t},t.prototype.unregister=function(e){return this.map[e.endpoint]?delete this.map[e.endpoint]:!1},t}())}]),ksc.factory("ksc.BatchLoader",["$http","$q","ksc.batchLoaderRegistry","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s;return i=n.ArgumentType,s=o.isObject,u=function(){function u(e,t){var u,a,l,c,p;this.endpoint=e,this.map=t,a=this,e&&"string"==typeof e||i({endpoint:e,required:"string"}),s(t)||i({map:t,required:"object"});for(u in t)p=t[u],"string"==typeof p&&u||n.Type({key:u,url:p,required:"url string"});l=!0,c=function(e){return l&&!e&&a.flush(),l=!!e},o.defineGetSet(a,"open",function(){return l},c,1),o.defineValue(a,"requests",[],0,1),r.register(a)}return u.prototype.endpoint=null,u.prototype.map=null,u.prototype.open=!0,u.prototype.requests=null,u.prototype.get=function(e,r){var n,o,u,a,l,c,p;if(u=this,l=u.requests,e&&"string"==typeof e||i({url:e,required:"string"}),null==r||s(r)||i({query_parameters:r,required:"object"}),!u.open)return!1;p=u.map;for(o in p)if(c=p[o],e===c){a=o;break}return a?(n=t.defer(),l.push({resource:a,deferred:n}),r&&(l[l.length-1].query=r),n.promise):!1},u.prototype.flush=function(){var t,r,n,o,u,i,s;for(n=this,u=n.requests,r=[],i=0,s=u.length;s>i;i++)o=u[i],o.deferred&&(r.push(o.deferred),delete o.deferred);return r.length?(t=e.put(n.endpoint,u),t.success(function(e,t,n,o){var u,i,s,a,l,c,p;for(i=l=0,c=r.length;c>l;i=++l)u=r[i],null!=(a=e[i])?(s={data:a.body,status:a.status,headers:n,config:o},200<=(p=a.status)&&400>p?u.resolve(s):u.reject(s)):u.reject({data:e,status:t,headers:n,config:o})}),t.error(function(e,t,n,o){var u,i,s;for(i=0,s=r.length;s>i;i++)u=r[i],u.reject({data:e,status:t,headers:n,config:o})})):!1},u}()}]),ksc.factory("ksc.EditableRecord",["ksc.Record","ksc.error","ksc.util",function(e,t,r){var n,o,u,i,s,a,l,c,p,f,d,y,h,g,_,m;return l="_array",p="_changes",c="_changedKeys",f="_deletedKeys",d="_edited",y="_events",h="_options",g="_parent",_="_parentKey",m="_saved",o=r.defineValue,u=r.hasOwn,i=Array.isArray,s=r.isEnumerable,a=r.isObject,n=function(n){function v(e,r,n,u){var i;null==e&&(e={}),null==r&&(r={}),a(r)||t.ArgumentType({options:r,argument:2,required:"object"}),r.subtreeClass=v,i=this,o(i,d,{}),o(i,p,0),o(i,c,{}),o(i,f,{}),o(i,m,{}),v.__super__.constructor.call(this,e,r,n,u)}return __extends(v,n),v.prototype._changedKeys=null,v.prototype._changes=0,v.prototype._deletedKeys=null,v.prototype._edited=null,v.prototype._clone=function(t,r){var n,o,i,s,l;if(null==t&&(t=!1),null==r&&(r=!1),i=this,t){n={},s=r?i[m]:i;for(o in s)l=s[o],l instanceof e&&(l=l._clone(!0,r)),n[o]=l;return n}if(n=new i.constructor(i[m]),!r){for(o in i)(i[c][o]||!u(i[m],o))&&(l=i[o],a(l)&&(l=l._clone(!0)),n[o]=l);for(o in i[f])n._delete(o)}return n},v.prototype._delete=function(){var n,a,l,y,g,_,v,b,k;for(_=1<=arguments.length?__slice.call(arguments,0):[],_.length||t.MissingArgument({name:"key",argument:1}),v=this,n=[],l=b=0,k=_.length;k>b;l=++b)if(g=_[l],r.isKeyConform(g,1,l),!l&&(a=v[h].contract)&&t.ContractBreak({key:g,value:value,contract:a[g]}),((y=v[h].idProperty)===g||i(y)&&__indexOf.call(y,g)>=0)&&t.Permission({key:g,description:"._options.idProperty keys can not be deleted"}),u(v[m],g)){if(v[f][g])continue;v[f][g]=!0,v[c][g]||(o(v,p,v[p]+1),o(v[c],g,!0,0,1)),delete v[d][g],Object.defineProperty(v,g,{enumerable:!1}),n.push(g)}else u(v,g)&&(s(v,g)||t.Key({key:g,description:"can not be changed"}),delete v[g],v[d][g]&&(delete v[d][g],o(v,p,v[p]-1),delete v[c][g]),n.push(g));return n.length&&e.emitUpdate(v,"delete",{keys:n}),!!n.length},v.prototype._getProperty=function(t){var r,n;return n=v.__super__._getProperty.apply(this,arguments),r=this,r[f][t]?void 0:u(r[d],t)?e.arrayFilter(r[d][t]):n},v.prototype._replace=function(t){var r,n,o,u;u=this,(o=u[y])&&o.halt();try{n=u._revert(0),r=v.__super__._replace.call(this,t,0)}finally{o&&o.unhalt()}return o&&(n||r)&&e.emitUpdate(u,"replace"),n||r},v.prototype._revert=function(t){var r,n,i;null==t&&(t=!0),r=!1,i=this;for(n in i[f])delete i[f][n],delete i[c][n],r=!0;for(n in i[d])delete i[d][n],delete i[c][n],r=!0;for(n in i)u(i[m],n)||(delete i[n],r=!0);return r&&(o(i,p,0),t&&e.emitUpdate(i,"revert")),r},v.prototype._setProperty=function(n,y,b){var k,O,P,j,A,w,q,x,C,S,R,T,$,M,V,K,L,E,U,I,N,B,F;if(b)return v.__super__._setProperty.apply(this,arguments);if(S=this,T=S[m],A=S[d],P=S[h].contract,e.valueCheck(S,n,y),((q=S[h].idProperty)===n||i(q)&&__indexOf.call(q,n)>=0)&&null!==y&&"string"!=(U=typeof y)&&"number"!==U&&t.Value({value:y,required:"string or number or null"}),y=e.valueWrap(S,n,y),r.identical(T[n],y))delete A[n],O=1;else if(!r.identical(A[n],y)){if(null!=P&&P._match(n,y),R=y,j=function(){var e;for(e in R)s(R,e)&&!u(y,e)&&R._delete(e)},k=null!=y?y[l]:void 0){if(a(T[n]))if(R=T[n],$=R[l]){for(w=K=I=k.length,N=$.length;N>K;w=K+=1)$.pop();for(B=k.slice(0,$.length),w=L=0,E=B.length;E>L;w=++L)x=B[w],$[w]=x;$.push.apply($,k.slice($.length))}else j(),e.arrayify(R),(F=R[l]).push.apply(F,k)}else if(a(y)&&a(T[n])){R=T[n],R[l]&&e.dearrayify(R),j();for(C in y)M=y[C],R._setProperty(C,M)}A[n]=R,O=1}return S[f][n]&&(delete S[f][n],O=1),A[n]===T[n]&&delete A[n],V=S[c][n],a(T[n])&&T[n]._changes||u(A,n)&&!r.identical(T[n],A[n])?V||(o(S,p,S[p]+1),o(S[c],n,!0,0,1)):V&&(o(S,p,S[p]-1),delete S[c][n]),e.getterify(S,n),O&&(S[_]&&v.subChanges(S[g],S[_],S[p]),Object.defineProperty(S,n,{enumerable:!0}),e.emitUpdate(S,"set",{key:n})),!!O},v.subChanges=function(e,t,r){var n;e[c][t]?r||(o(e,p,e[p]-1),delete e[c][t],n=!0):r&&(o(e,p,e[p]+1),o(e[c],t,!0,0,1),n=!0),n&&e[_]&&v.subChanges(e[g],e[_],e[p])},v}(e)}]),ksc.factory("ksc.EditableRestRecord",["$http","ksc.EditableRecord","ksc.Mixin","ksc.RestRecord",function(e,t,r,n){var o;return o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),r.extend(o,n),o.prototype._restSave=function(t){var r;return r=o.getUrl(this),o.async(this,e.put(r,this._entity()),t)},o}(t)}]),ksc.service("ksc.error",function(){var e,t,r,n,o,u,i,s,a,l,c,p,f,d;r=function(e){function t(e){var t,r,n;if(r="",e&&"object"==typeof e)for(t in e){n=e[t];try{n=JSON.stringify(n,null,2)}catch(o){n=String(n)}r+="\n  "+t+": "+n}else null!=e&&(r+=String(e));this.message=r}return __extends(t,e),t}(Error),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),n=function(){function r(){}return r.ArgumentType=e,r.ContractBreak=t,r.Http=o,r.Key=u,r.MissingArgument=i,r.Permission=s,r.Type=a,r.Value=l,r}(),p={type:n},d=function(e){return p[f]=function(t){throw new e(t)}};for(f in n)c=n[f],c.prototype.name=f+"Error",d(c);return p}),ksc.factory("ksc.EventEmitter",["$interval","$rootScope","$timeout","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s,a,l,c,p,f;return s="__unsubscriber__",a=n.ArgumentType,l=o.isFunction,c=o.isObject,i=function(){function e(){}return e.prototype.names=null,e.prototype.emit=function(){var e,t,r,n,o,u,i,s,a,c,p,f;for(u=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i=null!=this.names?this.names:this.names={},t=null!=i[u]?i[u]:i[u]={},n=!1,t.fired=(t.fired||0)+1,t.lastArgs=e,p=[0,1],a=0,c=p.length;c>a;a++)if(s=p[a],t[s]){f=t[s];for(o in f)r=f[o],l(r)&&(n=!0,s&&delete t[s][o],r.apply(null,e))}return n},e.prototype.instantCall=function(e,t){var r,n;return r=null!=this.names?this.names:this.names={},(null!=(n=r[e])?n.fired:void 0)?(t.apply(null,r[e].lastArgs),!0):!1},e.prototype.push=function(e,t,r){var n,o,i,a,l,c,p,f,d,y;for(c=null!=this.names?this.names:this.names={},i=[],t=t?1:0,d=0,y=e.length;y>d;d++)a=e[d],null==c[a]&&(c[a]={}),n=null!=(f=c[a])[t]?f[t]:f[t]={i:0},n[n.i]=r,i.push({name:a,id:n.i}),n.i+=1;return p=!1,o=u.prototype.unsubscriber(),l=function(){var e,r,n;if(p)return!1;for(p=!0,r=0,n=i.length;n>r;r++)e=i[r],delete c[e.name][t][e.id];return!0},l[s]=!0,o.add(l),o},e}(),p=function(e){return"string"!=typeof e&&a({name:e,argument:1,required:"string"}),e?void 0:n.Value({name:e,description:"must be a non-empty string"})},f=function(e,r,n,o){var u,f,d,y,h;for(null==this.subscriptions&&(this.subscriptions=new i),l(n)||a({callback:n,argument:"last",required:"function"}),(null!=r?r[s]:void 0)||c(r)&&(f=t.isPrototypeOf(r))||(e.push(r),r=null),y=0,h=e.length;h>y;y++)u=e[y],p(u);return d=o.call(this),r?(f?r.$on("$destroy",d):r.add(d),!0):d},u=function(){function n(){this.on=__bind(this.on,this),this.on1=__bind(this.on1,this),this["if"]=__bind(this["if"],this),this.if1=__bind(this.if1,this)}return n.prototype.emit=function(){var e,t,r;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],p(t),this._halt&&(t=this._halt+"#!"+t),(r=null!=this.subscriptions?this.subscriptions:this.subscriptions=new i).emit.apply(r,[t].concat(__slice.call(e)))},n.prototype.emitted=function(e){var t,r,n;return p(e),(null!=(r=t=null!=(n=this.subscriptions)?n.names[e]:void 0)?r.fired:void 0)?t.lastArgs:!1},n.prototype.halt=function(){return this._halt=(this._halt||0)+1},n.prototype.unhalt=function(){return this._halt-=1},n.prototype.if1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o,u;for(n=[],o=0,u=t.length;u>o;o++)r=t[o],this.subscriptions.instantCall(r,e)||n.push(r);return this.subscriptions.push(n,1,e)})},n.prototype["if"]=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o;for(n=0,o=t.length;o>n;n++)r=t[n],this.subscriptions.instantCall(r,e);return this.subscriptions.push(t,0,e)})},n.prototype.on1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,1,e)})},n.prototype.on=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,0,e)})},n.prototype.unsubscriber=function(n){var o,u,i;return o={},i=0,u=function(){var t,n,u;u=null;for(t in o)n=o[t],l(n)?n()||(u=!1):null!=n.$$intervalId?e.cancel(n):r.cancel(n);return u},null!=n&&(t.isPrototypeOf(n)||a({scope:n,required:"$rootScope descendant"}),n.$on("$destroy",u)),u[s]=!0,u.add=function(e){return function(t){var r,n;return r=function(){return delete o[t]},n=function(){return a({unsubscriber:e,argument:1,required:["function","Promise"]})},c(e)?null!=e.$$timeoutId&&null!=e["finally"]?e["finally"](r):null!=e.$$intervalId&&null!=e["finally"]?e["finally"](r):n():l(e)&&e[s]||n(),o[t]=e}(i),i+=1,!0},u},n}()}]),ksc.factory("ksc.ListMapper",["ksc.util",function(e){var t,r,n;return n=e.defineValue,r=function(e,t){var r,n,o;if(t)for(n=0,o=t.length;o>n;n++)r=t[n],e=e[r];return e},t=function(){function t(e){var t,r,o;this.parent=e,r=this,o=e.source,n(r,"map",{},0,1),n(r,"pseudo",{},0,1),n(r,"multi",o&&!o._,0,1),n(r,"_sources",[],0,1),t=function(e,n,o,u){var i,s,a,l,c,p;if(l=e.source){if(l._)return t(l._,n,o,u);p=[];for(a in l)s=l[a],n[a]={},o[a]={},c=function(){var e,t,r;for(r=[],e=0,t=u.length;t>e;e++)i=u[e],r.push(i);return r}(),c.push(a),p.push(t(s,n[a],o[a],c));return p}return r._sources.push({names:u,source:e})},t(e,r.map,r.pseudo,[]),Object.freeze(r._sources)}return t.prototype.map=null,t.prototype.multi=null,t.prototype.parent=null,t.prototype.pseudo=null,t.prototype.add=function(e,t){var n,o,u;return o=this,null!=e._id?(n=e._id,u=o.map):(n=e._pseudo,u=o.pseudo),u=r(u,t),u[n]=e},t.prototype.del=function(t,n,o){var u,i;u=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(i=u.pseudo,t=n):i=u.map,i=r(i,o),delete i[t]},t.prototype.has=function(t,n,o){var u,i,s;return i=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(u=n,s=i.parent.pseudo):(u=t,s=i.parent.map),s=r(s,o),s[u]||!1},t.register=function(e){var r;r=new t(e),n(e,"_mapper",r,0,1),n(e,"map",r.map,0,1),n(e,"pseudo",r.pseudo,0,1)},t}()}]),ksc.factory("ksc.ListMask",["$rootScope","ksc.EventEmitter","ksc.List","ksc.ListMapper","ksc.ListSorter","ksc.error","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p,f,d,y,h,g,_,m,v;return a="_scopeUnsubscriber",c=u.ArgumentType,d=i.defineGetSet,y=i.defineValue,h=i.isObject,p=Array.prototype.push,l=function(e,t){var r,n,o,u,i;if(o=v(e,t),e.sorter)for(u=0,i=o.length;i>u;u++)r=o[u],n=e.sorter.position(r),Array.prototype.splice.call(e,n,0,r);else p.apply(e,o)},f=function(e,t){var r,n,o;for(o=[];r=Array.prototype.pop.call(e);)n=r._original||r,__indexOf.call(t,n)<0&&o.push(r);o.length&&(o.reverse(),p.apply(e,o))},g=function(e){var t,r,n,o,u,s,a,l;for(i.empty(e),a=e._mapper._sources,n=0,u=a.length;u>n;n++)for(r=a[n],l=r.source,o=0,s=l.length;s>o;o++)t=l[o],e.filter(t)&&p.apply(e,v(e,t))},_=function(e){var t,r,n,o;t=function(){return!0},(r=e.options.filter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({filter_function:n,required:"function"}),r=n,e.update()},d(e,"filter",n,o,1),d(e.options,"filter",n,o,1)},m=function(e){var t,r,n,o;t=function(){return!1},(r=e.options.splitter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&u.Type({splitter_function:n,required:"function"}),r=n,e.update()},d(e,"splitter",n,o,1),d(e.options,"splitter",n,o,1)},v=function(e,t){var r,n,o,i,s,a,l,c,p;if((s=e.splitter(t))&&s instanceof Array){for(i=[],c=0,p=s.length;p>c;c++){r=s[c],h(r)||u.Type({splitter:e.splitter,description:"If Array is returned, all elements must be objects with override data"}),o=Object.create(t),l=function(e,t){var r,n;return r=function(){return t[e]},n=function(r){return t[e]=r},d(o,e,r,n,1)};for(n in t)l(n,t);for(n in r)a=r[n],y(o,n,a,0,1);y(o,"_original",t),i.push(o)}return i}return[t]},s=function(){function i(r,s,p,f){var d,g,v,b,k,O,P,j,A,w,q,x,C,S,R,T,$,M,V,K,L,E,U,I;(r instanceof Array||"object"!=typeof r)&&(r={_:r}),k=0;for(j in r)P=r[j],P instanceof Array&&P.options&&P.events instanceof t||c({source:P,name:j,required:"List"}),k+=1,y(r,j,P,0,1);Object.freeze(r),r._&&k>1&&c({source:r,conflict:'Can not have unnamed ("_") and named sources mixed'}),h(s)&&(f=p,p=s,s=null),null==p&&(p={}),h(p)||c({options:p,argument:3,required:"object"}),e.isPrototypeOf(p)&&(f=p,p={}),null!=f&&(e.isPrototypeOf(f)||c({scope:f,required:"$rootScope descendant"})),s&&(p.filter=s),v=[],L=this.constructor.prototype;for(g in L)q=L[g],y(v,g,q,0,1);for(E=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],C=0,$=E.length;$>C;C++)g=E[C],v[g]&&y(v,g,void 0);for(y(v,"events",new t,0,1),y(v,"options",p),y(v,"source",r,0,1),_(v),m(v),n.register(v),A=v._mapper._sources,f&&y(v,a,f.$on("$destroy",function(){return delete v[a],v.destroy()})),w=null,d=[],x=function(e){var t;return t=e.source.events.on("update",function(t){return i.update.call(v,t,e.names)}),w?w.add(t):w=t,w.add(e.source.events.on("destroy",function(){return v.destroy()}))},S=0,M=A.length;M>S;S++)O=A[S],U=O.source,__indexOf.call(d,U)>=0&&u.Value({sources:A,conflict:"Source can not be referenced twice to keep list unique"}),d.push(O.source),x(O);for(y(v,"_sourceUnsubscriber",w),o.register(v,p.sorter),R=0,V=A.length;V>R;R++)for(O=A[R],I=O.source,T=0,K=I.length;K>T;T++)b=I[T],v.filter(b)&&(v._mapper.add(b,O.names),l(v,b));return v}return i.prototype._mapper=null,i.prototype.events=null,i.prototype.filter=null,i.prototype.map=null,i.prototype.options=null,i.prototype.pseudo=null,i.prototype.sorter=null,i.prototype.source=null,i.prototype.splitter=null,i.prototype.destroy=r.prototype.destroy,i.prototype.update=function(){var e,t,r,n,o,u,i,s,a,c,p,d,y;for(e={},r=this,n=r._mapper,d=n._sources,s=0,c=d.length;c>s;s++)for(u=d[s],i=u.names,y=u.source,a=0,p=y.length;p>a;a++)o=y[a],t=n.has(o,null,i),r.filter(o)?t||(n.add(o,i),l(r,o),(null!=e.add?e.add:e.add=[]).push(o)):t&&(n.del(o,null,i),(null!=e.cut?e.cut:e.cut=[]).push(o));return e.cut&&f(r,e.cut),g(r),(e.add||e.cut)&&r.events.emit("update",{node:r,action:e}),e},i.update=function(e,t){var r,n,o,u,i,s,a,c,p,d,y,h,_,m,v,b,k,O,P,j,A,w,q,x,C,S,R,T,$,M,V,K;if(r=null,o=[],d=this,c=e.action,y=d._mapper,n=function(e,t){var n;return(null!=(n=null!=r?r:r={})[e]?n[e]:n[e]=[]).push(t)},u=function(e,r,u){return y.has(e,r,t)?(n("cut",u),o.push(u),y.del(e,r,t)):void 0},s=function(e,r,n){var o;return(o=y.has(e,r,t))||y.add(n,t),o},i=function(e,r){var n;return(n=y.has(e,r,t))&&y.del(e,r,t),n},c.cut)for(T=c.cut,w=0,C=T.length;C>w;w++)m=T[w],u(m._id,m._pseudo,m);if(c.add)for($=c.add,q=0,S=$.length;S>q;q++)m=$[q],d.filter(m)&&(s(m._id,m._pseudo,m),l(d,m),n("add",m));if(c.update)for(M=c.update,x=0,R=M.length;R>x;x++)if(e=M[x],V=e,m=V.record,e=V.info,h=V.merge,_=V.move,b=V.source,a=P=null,(v=h||_)&&(a=v.from,P=v.to),d.filter(m))if(k=a&&i(a.map,a.pseudo),O=P?s(P.map,P.pseudo,m):s(m._id,m._pseudo,m),k&&O)n("update",{record:m,info:e,merge:v,source:b}),o.push(b);else if(k)n("update",{record:m,info:e,move:v});else if(O){j={record:m},K={info:e,source:b};for(p in K)A=K[p],null!=A&&(j[p]=A);n("update",j)}else l(d,m),n("add",m);else h?(u(a.map,a.pseudo,b),u(P.map,P.pseudo,m)):_?u(a.map,a.pseudo,m):u(m._id,m._pseudo,m);d.sorter?o.length&&f(d,o):g(d),r&&d.events.emit("update",{node:d,action:r})},i}()}]),ksc.factory("ksc.ListSorter",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.defineValue,o=t.isKeyConform,r=function(){function r(u,i){var s,a,l;a=this,n(a,"list",u,0,0),"function"==typeof i?a.fn=i:((o(i)||i instanceof Array)&&(i={key:i}),t.isObject(i)&&(o(s=i.key)||s instanceof Array)||e.Value({sorter:i,requirement:"function or string or array or object: {key: <string|array>, reverse: <bool>, type: 'natural|number|byte'}"}),(l=i.type)?"byte"!==l&&"natural"!==l&&"number"!==l&&e.Value({type:l,required:"byte, natural or number"}):l="natural",n(a,"key",s,0,1),n(a,"reverse",!!i.reverse,0,1),n(a,"type",l,0,1),n(a,"fn",r.getSortFn(a),0,1)),Object.preventExtensions(a)}return r.prototype.fn=null,r.prototype.key=null,r.prototype.list=null,r.prototype.reverse=null,r.prototype.type=null,r.prototype.position=function(t){var r,n,o,u,i,s,a,l;return l=this,n=l.fn,i=l.list,(u=i.length)?(a=0,s=u-1,r=function(t){return("number"!=typeof t||isNaN(t))&&e.Type({sort_fn_output:t,required:"number"}),t},r(n(t,i[a]))<0?a:1===u?1:r(n(t,i[s]))>=0?s+1:(o=function(e,u){var s;return u-1>e?(s=Math.floor((u-e)/2+e),r(n(t,i[s]))<0?o(e,s):o(s,u)):u})(a,s)):0},r.getSortFn=function(e){var t,r,n,u,i,s;return r=e.key,i=e.reverse,s=e.type,i=i?-1:1,t=function(e,t){var r;return function(){var n,o,u;for(u=[],n=0,o=t.length;o>n;n++)r=t[n],null!=e[r]&&u.push(e[r]);return u}().join(" ")},u=function(e){return"number"!=typeof e?"string"==typeof e&&""!==e?Number(e):0/0:e},n=function(e,t){var r,n,o,u,i,s,a,l;if(e=String(e).toLowerCase(),t=String(t).toLowerCase(),s=0,l=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g,e===t)return 0;for(n=e.toLowerCase().match(l),u=t.toLowerCase().match(l),r=null!=n?n.length:0;r>s;)return null==u||void 0===u[s]?1:(o=n[s],i=u[s],s+=1,a=o-i,isNaN(a)?o>=i?1:-1:a);return-1},function(e,a){var l,c;if(o(r)?(e=e[r],a=a[r]):(e=t(e,r),a=t(a,r)),"number"===s){if(l=e,c=a,e=u(e),a=u(a),isNaN(e))return isNaN(a)?n(l,c)*i:-1*i;if(isNaN(a))return 1*i}else null==e&&(e=""),null==a&&(a="");return"natural"===s?n(e,a)*i:("byte"===s&&(e=String(e),a=String(a)),e===a?0:(e>a?1:-1)*i)}},r.register=function(e,n){var o,u,i;i=null,n&&(i=new r(e,n)),o=function(){return i},u=function(t){return t?(i=new r(e,t),Array.prototype.sort.call(e,i.fn),e.events.emit("update",{node:e,action:{sort:!0}})):i=null},t.defineGetSet(e,"sorter",o,u,1),t.defineGetSet(e.options,"sorter",o,u,1)},r}()}]),ksc.factory("ksc.List",["$rootScope","ksc.EditableRecord","ksc.EventEmitter","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,u,i,s){var a,l,c,p,f,d,y,h;return l="_scopeUnsubscriber",c=i.ArgumentType,p=s.defineValue,y=s.isObject,h=function(e,t){return"boolean"!=typeof t&&(e.push(t),t=!1),t},f=function(e,t){return e.events.emit("update",{node:e,action:t})},d=function(e,t,r){var n;(n=Array.prototype.splice).call.apply(n,[e,t,0].concat(__slice.call(r)))},a=function(){function a(t,u){var i,a,f,d,y;null==t&&(t={}),a=[],s.isObject(t)||c({options:t,argument:3,required:"object"}),e.isPrototypeOf(t)&&(u=t,t={}),null!=u&&(e.isPrototypeOf(u)||c({scope:u,required:"$rootScope descendant"})),y=this.constructor.prototype;for(i in y)f=y[i],-1===i.indexOf("constructor")&&p(a,i,f,0,1);return t=angular.copy(t),p(a,"options",t),null==(d=a.options).record&&(d.record={}),p(a,"events",new r,0,1),n.register(a),u&&p(a,l,u.$on("$destroy",function(){return delete a[l],a.destroy()})),o.register(a,t.sorter),a}return a.prototype._mapper=null,a.prototype.events=null,a.prototype.map=null,a.prototype.pseudo=null,a.prototype.options=null,a.prototype.sorter=null,a.prototype.destroy=function(){var e,t;if(t=this,Object.isFrozen(t))return!1;t.events.emit("destroy"),"function"==typeof t[l]&&t[l](),"function"==typeof t._sourceUnsubscriber&&t._sourceUnsubscriber(),s.empty(t);for(e in t)"destroy"!==e&&delete t[e];return delete t.options,delete t._sourceUnsubscriber,Object.freeze(t),!0},a.prototype.cut=function(){var e,t,r,n,o,u,s,a,l,c,p,h;for(a=1<=arguments.length?__slice.call(arguments,0):[],a.length||i.MissingArgument({name:"record",argument:1}),t=[],o=this,u=o._mapper,l=[],p=0,h=a.length;h>p;p++)s=a[p],y(s)?(__indexOf.call(o,s)<0&&i.Value({record:s,description:"not found in list"}),u.has(s)||i.Key({record:s,description:"map/pseudo id error"}),u.del(s),t.push(s)):(r=s,(s=u.has(r))||i.Key({id:r,description:"map id error"}),u.del(r),t.push(s._id!==r?r:s)),l.push(s);for(c=[];n=Array.prototype.pop.call(o);)__indexOf.call(l,n)<0&&c.push(n);return c.length&&(c.reverse(),d(o,o.length,c)),e={cut:t},f(o,e),e},a.prototype.empty=function(e){var t,r,n,o,u;n=this,t={cut:[]},n.events.halt();try{for(r=o=0,u=n.length;u>o;r=o+=1)t.cut.push(n.shift())}finally{n.events.unhalt()}return t.cut.length&&f(n,t),e?t:this},a.prototype.pop=function(){return a.remove(this,"pop")},a.prototype.push=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,r.length),n?e:r.length},a.prototype.shift=function(){return a.remove(this,"shift")},a.prototype.unshift=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,0),n?e:r.length},a.prototype.splice=function(){var e,t,r,n,o,u,i,l,p;u=arguments[0],t=arguments[1],r=4<=arguments.length?__slice.call(arguments,2,p=arguments.length-1):(p=2,[]),l=arguments[p++],l=h(r,l),"undefined"==typeof r[0]&&1===r.length&&r.pop(),"boolean"!=typeof t||r.length||(l=t,t=null),i=function(e,t){return"number"==typeof e&&(e>0||0===e)&&e===Math.floor(e)?void 0:c({value:e,argument:t,required:"int >= 0"})},e={},o=this,n=o.length,0>u&&(u=Math.max(n+u,0)),i(u),u=Math.min(n,u),null!=t?(i(t),t=Math.min(n-u,t)):t=n-u,o.events.halt();try{t>0&&(e=o.cut.apply(o,o.slice(u,u+t))),r.length&&s.mergeIn(e,a.add(o,r,u))}finally{o.events.unhalt()}return(e.cut||e.add||e.update)&&f(o,e),l?e:e.cut||[]},a.prototype.reverse=function(){var e;return e=this,e.sorter&&i.Permission("can not reverse an auto-sorted list"),e.length>1&&(Array.prototype.reverse.call(e),f(e,{reverse:!0})),e},a.prototype.sort=function(e){var t,r,n,o,u,s;if(n=this,n.sorter&&i.Permission("can not reverse an auto-sorted list"),n.length>1)for(t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o);return r}(),null==e&&(e=function(e,t){return null===e._id&&null===t._id?e._pseudo-t._pseudo:null===e._id?-1:null===t._id?1:e._id>t._id?1:-1}),Array.prototype.sort.call(n,e),r=u=0,s=n.length;s>u;r=++u)if(o=n[r],o!==t[r]){f(n,{sort:!0});break}return n},a.prototype._recordChange=function(e,t,r){var n,o,a,l,c,y,h,g,_,m;if(e instanceof u||i.Type({record:e,required:"Record"}),l=this,c=l.map,y=l._mapper,n=function(){return p(e,"_pseudo",null),y.add(e)},o={record:e,info:t},r!==e._id){l.events.halt();try{null==e._id?(y.del(r),p(e,"_pseudo",s.uid("record.pseudo")),y.add(e),o.move={from:{map:r},to:{pseudo:e._pseudo}}):null==r?c[e._id]?(o.merge={from:{pseudo:e._pseudo},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(e),l.push(e)):(o.move={from:{pseudo:e._pseudo},to:{map:e._id}},y.del(null,e._pseudo),n()):c[e._id]?(o.merge={from:{map:r},to:{map:e._id}},o.record=c[e._id],o.source=e,l.cut(r),l.push(e)):(o.move={from:{map:r},to:{map:e._id}},y.del(r),n())}finally{l.events.unhalt()}}if(l.sorter)for(e=o.record,g=_=0,m=l.length;m>_;g=++_)if(a=l[g],a===e){Array.prototype.splice.call(l,g,1),h=l.sorter.position(e),d(l,h,[e]);break}return f(l,{update:[o]})},a.add=function(e,r,n){var o,a,l,c,y,h,g,_,m,v,b,k;r.length||i.MissingArgument({name:"item",argument:1}),o={},c=e._mapper,e.events.halt();try{for(_=[],g=e.options.record,h=g["class"]||t,m=0,b=r.length;b>m;m++)l=r[m],y=l,l instanceof h?(l._parent&&l._parent!==e&&l._parent.cut(l),p(l,"_parent",e)):(l instanceof u&&(l=l._clone(!0)),l=new h(l,g,e)),null!=l._id?((a=c.has(l._id))?(a._replace(l._clone(!0)),(null!=o.update?o.update:o.update=[]).push({record:a,source:y})):(c.add(l),_.push(l),(null!=o.add?o.add:o.add=[]).push(l)),l._pseudo&&p(l,"_pseudo",null)):(p(l,"_pseudo",s.uid("record.pseudo")),c.add(l),_.push(l),(null!=o.add?o.add:o.add=[]).push(l));if(_.length)if(e.sorter)for(v=0,k=_.length;k>v;v++)l=_[v],n=e.sorter.position(l),d(e,n,[l]);else d(e,n,_)}finally{e.events.unhalt()}return f(e,o),o},a.remove=function(e,t){var r;return(r=Array.prototype[t].call(e))&&(e._mapper.del(r),f(e,{cut:[r]})),r},a}()}]),ksc.factory("ksc.Mixin",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=function(e,r,n){var o,u,i;for(null!=e&&"boolean"!=typeof e&&(r.unshift(e),e=!0),u=0,i=r.length;i>u;u++)o=r[u],t.isKeyConform(o,1);return n(e,r)},o=function(e,r,n,o){var u;return t.hasProperty(e,r)?!1:null==n?!0:(u=__indexOf.call(o,r)>=0,n&&u||!n&&!u)},r=function(){function e(){}return e.extend=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendProto.apply(e,[r,n,t].concat(__slice.call(o))),e.extendInstance.apply(e,[r,n,t].concat(__slice.call(o)))},e.extendInstance=function(){var e,t,r,u;return t=arguments[0],r=arguments[1],e=arguments[2],u=4<=arguments.length?__slice.call(arguments,3):[],n(e,u,function(e,n){var u,i;for(u in r)i=r[u],o(t,u,e,n)&&(t[u]=i)})},e.extendProto=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendInstance.apply(e,[r.prototype,n.prototype,t].concat(__slice.call(o)))
},e}()}]),ksc.factory("ksc.RecordContract",["ksc.error","ksc.util",function(e,t){var r,n,o,u;return r="nullable",o=t.hasOwn,u=t.isObject,n=function(){function n(t){var i,s,a,l,c,p,f,d,y,h;if(null===t||t instanceof n)return t;u(t)||e.Type({contract:t,required:"object"});for(c in t){for(s=t[c],"_"===c.substr(0,1)&&e.Key({key:c,description:'can not start with "_"'}),this[c]=s,s[r]?s[r]=!0:delete s[r],l=0,h=["array","contract","default"],d=0,y=h.length;y>d;d++)a=h[d],s[a]&&(l+=1,l>1&&e.Value({key:a,contract:s,description:"array, default, contract are mutually exclusive"}));f=s.type,!(i=s.array)&&"array"!==f||u(i)||e.Type({array:i,description:"array description required"}),(i=s.array)&&(o(s,"type")&&"array"!==f&&e.Type({type:type,array:i,requiredType:"array"}),delete s.type,f=null),!(p=s.contract)&&"object"!==f||u(p)||e.Type({contract:p,description:"contract description required"}),p&&(o(s,"type")&&"object"!==f&&e.Type({type:type,contract:p,requiredType:"object"}),delete s.type,f=null),i||(p?s.contract=new n(p):(o(s,"default")&&!o(s,"type")&&null!=n.typeDefaults[typeof s["default"]]&&(s.type=f=typeof s["default"]),null==n.typeDefaults[f]&&e.Type({type:f,required:"array, boolean, number, object, string"}))),this._match(c,this._default(c))}Object.freeze(this)}return n.prototype._default=function(t){var u,i,s;if(u=this[t],u||e.Key({key:t,description:"Key not found on contract"}),o(u,"default"))return u["default"];if(u[r])return null;if(u.array)return[];if(u.contract){i={},s=u.contract;for(t in s)__hasProp.call(s,t)&&(i[t]=u.contract._default(t));return i}return n.typeDefaults[u.type]},n.prototype._match=function(t,n){var o;return o=this[t],null!=o&&(o.array&&Array.isArray(n)||o.contract&&u(n)||typeof n===o.type||null===n&&o[r])?!0:e.ContractBreak({key:t,value:n,contract:o})},n.finalizeRecord=function(e){e._options.contract&&Object.isExtensible(e)&&(o(e,"$$hashKey")||t.defineValue(e,"$$hashKey",void 0,1),Object.preventExtensions(e))},n.typeDefaults={"boolean":!1,number:0,string:""},n}()}]),ksc.factory("ksc.Record",["ksc.ArrayTracker","ksc.EventEmitter","ksc.RecordContract","ksc.error","ksc.util",function(e,t,r,n,o){var u,i,s,a,l,c,p,f,d,y,h,g,_,m,v,b,k;return y="_array",h="_events",g="_id",_="_options",m="_parent",v="_parentKey",b="_pseudo",k="_saved",u="contract",i="idProperty",a=o.defineValue,l=o.hasOwn,c=Array.isArray,p=o.isKeyConform,f=o.isObject,d=function(e,t,r){var o;return f(t)?void 0:(o={},o[e]=t,o.argument=r,o.required="object",n.ArgumentType(o))},s=function(){function s(e,i,s,c){var y,O,P,j,A,w,q,x,C,S,R,T;for(null==e&&(e={}),null==i&&(i={}),f(e)||n.Type({data:e,required:"object"}),d("data",e,1),d("options",i,2),P=this,a(P,_,i),a(P,k,{}),l(i,u)&&(y=i[u]=new r(i[u])),(null!=s||null!=c)&&(d("options",s,3),a(P,m,s),null!=c&&(p(c,1,4),a(P,v,c),delete P[g],delete P[b])),R=y?[P,y]:[P],q=0,C=R.length;C>q;q++){w=R[q],T=o.propertyRefs(Object.getPrototypeOf(w));for(O in T)for(A=T[O],x=0,S=A.length;S>x;x++)j=A[x],Object.defineProperty(j,O,{enumerable:!1})}null==c&&(a(P,g,void 0),a(P,b,void 0),a(P,h,new t),P[h].halt()),P._replace(e),null!=c?a(P,h,null):P[h].unhalt(),r.finalizeRecord(P)}return s.prototype._array=void 0,s.prototype._events=void 0,s.prototype._id=void 0,s.prototype._options=void 0,s.prototype._parent=void 0,s.prototype._parentKey=void 0,s.prototype._pseudo=void 0,s.prototype._saved=void 0,s.prototype._clone=function(e){var t,r,n,o;null==e&&(e=!1),t={},n=this;for(r in n)o=n[r],f(o)&&(o=o._clone(1)),t[r]=o;return e?t:new n.constructor(t)},s.prototype._delete=function(){return n.Permission({keys:keys,description:"Read-only Record"})},s.prototype._entity=function(){return this._clone(1)},s.prototype._getProperty=function(e){return p(e,1,1),s.arrayFilter(this[k][e])},s.prototype._replace=function(e,t){var r,o,i,a,p,f,d,g,m;if(null==t&&(t=!0),d=this,a=d[h],null===a&&n.Permission({key:d[v],description:"can not replace subobject"}),s.initIdProperty(d,e),g=!0,c(e))p=function(){var t,r,n;for(n=[],t=0,r=e.length;r>t;t++)m=e[t],n.push(m);return n}(),s.arrayify(d),o=1,r=d[y],r._tracker.set=function(e,t){return d._setProperty(e,t,g)},p.length&&r.push.apply(r,p)&&(o=1);else{s.dearrayify(d),p={};for(f in e)m=e[f],p[f]=m;if(i=d[_][u])for(f in i)m=i[f],l(p,f)||(p[f]=i._default(f));for(f in p)m=p[f],s.getterify(d,f),d._setProperty(f,m,g)&&(o=1)}for(f in d[k])l(p,f)||(delete d[f],delete d[k][f],o=1);return o&&a&&t&&s.emitUpdate(d,"replace"),g=!1,!!o},s.prototype._setProperty=function(e,t,r){var u,i;return u=this,i=u[k],r||n.Permission({key:e,value:t,description:"Read-only Record"}),s.valueCheck(u,e,t),l(i,e)&&o.identical(t,u[e])?!1:(a(i,e,s.valueWrap(u,e,t),0,1),s.getterify(u,e),!0)},s.arrayFilter=function(e){var t,r,n,o,u,i,s,c;if(!(t=null!=e?e[y]:void 0))return e;for(u=e,o={};u&&u.constructor!==Object;){for(c=Object.getOwnPropertyNames(u),i=0,s=c.length;s>i;i++)n=c[i],n===y||"_"!==n.substr(0,1)||l(o,n)||(o[n]=Object.getOwnPropertyDescriptor(u,n));u=Object.getPrototypeOf(u)}for(n in t)"_record"===n||"_"!==n.substr(0,1)||l(o,n)||delete t[n];for(n in o)r=o[n],Object.defineProperty(t,n,r);return a(t,"_record",e),t},s.arrayify=function(t){var r;return a(t,y,r=[]),new e(r,{store:t[k],get:function(e){return t._getProperty(e)},set:function(e,r){return t._setProperty(e,r)},del:function(e){return t._delete(e),!1}})},s.dearrayify=function(e){return delete e[y]},s.emitUpdate=function(e,t,r){var n,o,u,i,a,l,c,p;for(null==r&&(r={}),a=[],l=e;!(n=l[h]);)a.unshift(l[v]),l=l[m];o={node:e},e!==l&&(o.parent=l,o.path=a),o.action=t;for(u in r)c=r[u],o[u]=c;i=l[g],s.setId(l),l[h]._halt||null!=(p=l[m])&&"function"==typeof p._recordChange&&p._recordChange(l,o,i),n.emit("update",o)},s.getterify=function(e,t){l(e,t)||o.defineGetSet(e,t,function(){return e._getProperty(t)},function(r){return e._setProperty(t,r)},1)},s.initIdProperty=function(e,t){var r,o,s,a,l,p,f,d;if(l=e[_],r=l[u],null==l[i])for(a in t){l[i]=a;break}if(s=function(e){var t;return r&&(null==r[e]&&n.ContractBreak({key:e,contract:r,mismatch:"idProperty"}),"string"!==(t=r[e].type)&&"number"!==t)?n.ContractBreak({key:e,contract:r,required:"string or number"}):void 0},e[h]&&(o=l[i]))if(c(o))for(f=0,d=o.length;d>f;f++)p=o[f],s(p),null==t[p]&&(t[p]=null);else s(o),null==t[o]&&(t[o]=null)},s.setId=function(e){var t,r,n,o,u,s,l,f;if(o=e[_][i])if(c(o)){for(t=[],r=l=0,f=o.length;f>l;r=++l)if(u=o[r],p(e[u]))t.push(e[u]);else if(!r)break;n=t.length?t.join("-"):null,a(e,g,n),a(e,"_primaryId",e[o[0]])}else s=e[o],a(e,g,null!=s?s:null)},s.valueCheck=function(e,t,r){var o;p(t,1,1),(o=e[_][u])?o._match(e[y]?"all":t,r):("string"==typeof t&&"_"===t.substr(0,1)&&n.ArgumentType({key:t,argument:1,description:'can not start with "_"'}),"function"==typeof r&&n.Value({value:r,description:"can not be function"}))},s.valueWrap=function(e,t,r){var n,o,i,a;return o=e[_][u],f(r)&&(null!=r._clone&&(r=r._clone(1)),n=e[_].subtreeClass||s,o&&(a=(i=o[t])?i.array?{contract:{all:i.array}}:{contract:i[u]}:{contract:o.all.contract}),r=new n(r,a,e,t)),r},s}()}]),ksc.factory("ksc.RestList",["$http","$q","ksc.List","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u,i){var s,a,l,c,p;return a="restCache",l="restPending",s="_primaryId",p=i.defineValue,c=function(r){function a(){return a.__super__.constructor.apply(this,arguments)}return __extends(a,r),a.prototype.restCache=null,a.prototype.restPending=0,a.prototype.restGetRaw=function(t,r){var i,s,a,c,f,d,y;return"function"==typeof t&&(r=t,t=null),a=this,(i=a.options.endpoint)&&(d=i.url)&&"string"==typeof d||o.Type({"options.endpoint.url":d,required:"string"}),p(a,l,a[l]+1,0,1),(f=n.get(d,t))||(t&&(c=function(){var e;e=[];for(s in t)y=t[s],e.push(encodeURIComponent(s)+"="+encodeURIComponent(y));return e}(),c.length&&(d+=(d.indexOf("?")>-1?"&":"?")+c.join("&"))),f=e.get(d)),u.wrapPromise(f,function(e,t){return p(a,l,a[l]-1,0,1),r(e,t)})},a.prototype.restLoad=function(e,t,r){var n,o,i;return"boolean"!=typeof e&&(r=t,t=e,e=null),"function"==typeof t&&(r=t,t=null),o=this,i=o.options,n=function(){return o.restGetRaw(t,function(e,t){var n,u,i;if(!e)try{n=a.getResponseArray(o,t.data),u=o.push.apply(o,__slice.call(n).concat([!0]))}catch(s){i=s,e=i}return"function"==typeof r?r(e,u,t):void 0})},i.cache&&o.restCache&&!e?r&&u.wrapPromise(o.restCache,r):p(o,"restCache",n(),0,1),o.restCache},a.prototype.restSave=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,1,t,e)},a.prototype.restDelete=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,0,t,e)},a.getResponseArray=function(e,t){var r,n,u,i;if(r=e.options.endpoint,u="responseProperty","undefined"==typeof r[u]){Array.isArray(t)&&(r[u]=null);for(n in t)i=t[n],Array.isArray(i)&&(r[u]=n)}return null!=r[u]&&(t=t[r[u]]),t instanceof Array||o.Value({"options.endpoint.responseProperty":void 0,description:"array type property in response is not found or unspecified"}),t},a.relatedRecords=function(e,t){var r,n,o,u,i;if(null==(r=t[s]))return[t];for(i=[],o=0,u=e.length;u>o;o++)n=e[o],n[s]===r&&i.push(n);return i},a.updateOnSave=function(e,r,n,o){var u,i,a,l,c,p,f,d,y,h,g,_,m,v,b,k;for(f=[],h=[],a=m=0,b=r.length;b>m;a=++m)y=r[a],null!=(c=y[s])||e.options.reloadOnUpdate?(d={},l=y._options.idProperty,c?d[l[0]]=c:d[l]=y._id,f.push(e.restLoad(d))):h.push([y,n[a]]);if(h.length){e.events.halt(),u=[],_=e.events.on("1#!update",function(e){return u.push(e.action.update[0])});try{for(v=0,k=h.length;k>v;v++)g=h[v],y=g[0],i=g[1],y._replace(i)}finally{_(),e.events.unhalt()}u.length&&e.events.emit("update",{node:e,action:{update:u}})}f.length?(p=t.all(f),p.then(o,o)):o()},a.writeBack=function(e,t,r,n){var u,l,c,p,f,d,y,h,g,_,m;for(n&&"function"==typeof n||(n&&r.push(n),n=null),g={},c=_=0,m=r.length;m>_;c=++_)y=r[c],i.isObject(y)||(r[c]=y=e.map[y]),f=y,d=null,h="id:"+(p=null!=y?y._id:void 0),null==(p=null!=y?y._id:void 0)?(d=null!=y?y._pseudo:void 0,h="pseudo:"+d):null!=y[s]&&(h="id:"+y[s]),t?(y=d&&e.pseudo[d]||e.map[p],y||o.Key({key:f,description:"no such record on list"})):(y=e.map[p])||o.Key({key:f,description:"no such record on map"}),g[h]&&o.Value({uid:h,description:"not unique"}),g[h]=y;return r.length||o.MissingArgument({name:"record",argument:1}),l=e.options.endpoint||{},t&&l.bulkSave?(u=String(l.bulkSave).toLowerCase(),"post"!==u&&(u="put"),a.writeBulk(e,u,r,n)):!t&&l.bulkDelete?a.writeBulk(e,"delete",r,n):a.writeSolo(e,t,r,n)},a.writeBulk=function(t,r,n,i){var c,p,f,d,y,h,g;return(g=t.options.endpoint.url)&&"string"==typeof g||o.Type({"options.endpoint.url":g,required:"string"}),h="delete"!==r,p=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)y=n[e],h?r.push(y._entity()):(null==(f=y[s])&&(f=y._id),r.push(f));return r}(),c=[g],h&&c.push(p),t[l]+=1,d=e[r].apply(e,c),u.wrapPromise(d,function(e,r){var o,u,s,c;for(t[l]-=1,o=function(){return"function"==typeof i?i(e,u,r):void 0},u=[],s=0,c=n.length;c>s;s++)y=n[s],u.push.apply(u,a.relatedRecords(t,y));return e||(h?a.updateOnSave(t,n,r.data,o):(t.cut.apply(t,u),o())),o()})},a.writeSolo=function(t,r,n,i){var c,p,f,d,y;return y=[],c=d=null,p=function(e){var t;return t=Array.prototype.slice.call(arguments,1),c=[e,y].concat(__slice.call(t)),d?void 0:("function"==typeof i&&i.apply(null,c),c=null)},f=function(n){var p,f,h,g,_,m,v;return null==(f=n[s])&&(f=n._id),h="delete",_=null!=(m=t.options.record.endpoint)?m.url:void 0,r&&(h="put",n._pseudo&&(h="post",f=null,_=null!=(v=t.options.endpoint)?v.url:void 0)),_&&"string"==typeof _||o.Value({"options.record.endpoint.url":_,required:"string"}),_=_.replace("<id>",f),p=[_],r&&p.push(n._entity()),t[l]+=1,g=e[h].apply(e,p),u.wrapPromise(g,function(e,o){var u;t[l]-=1,u=a.relatedRecords(t,n),e||(r?(d=(d||0)+1,a.updateOnSave(t,[n],[o.data],function(){return d-=1,c&&"function"==typeof i?i.apply(null,c):void 0})):t.cut.apply(t,u)),y.push.apply(y,u)})},u.asyncSquash(n,f,p)},a}(r)}]),ksc.factory("ksc.RestRecord",["$http","ksc.Record","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,u){var i,s,a,l,c;return i="_options",s="_restCache",a="_restPending",c=u.defineValue,l=function(t){function u(){c(this,a,0),u.__super__.constructor.apply(this,arguments)}return __extends(u,t),u.prototype._restCache=null,u.prototype._restPending=0,u.prototype._restLoad=function(t,n){var a,l;return l=this,a=function(){var t,o;return o=u.getUrl(l),(t=r.get(o))||(t=e.get(o)),u.async(l,t,n)},"boolean"!=typeof t&&(n=t,t=null),l[i].cache&&l[s]&&!t?n&&o.wrapPromise(l[s],n):c(l,s,a()),l[s]},u.async=function(e,t,r){return c(e,a,e[a]+1),o.wrapPromise(t,function(t,n){return c(e,a,e[a]-1),!t&&n.data&&e._replace(n.data),"function"==typeof r?r(t,n):void 0})},u.getUrl=function(e){var t,r;return(t=e[i].endpoint)&&null!=(r=t.url)||n.Value({"_options.endpoint.url":void 0}),"string"!=typeof r&&n.Type({"_options.endpoint.url":r,required:"string"}),r},u}(t)}]),ksc.service("ksc.restUtil",["$q","ksc.error",function(e,t){var r;return r=function(){function r(){}return r.asyncSquash=function(n,o,u){var i,s,a,l,c,p,f;return i=0,s=[],c=n.length,f=[],a=function(e,r){var n,o,a,l;return o=r.data,l=r.status,a=r.headers,n=r.config,i+=1,null!=e&&s.push(e),f.push({error:e,data:o,status:l,headers:a,config:n}),i===c&&u?(t=null,1===s.length?t=s[0]:s.length&&(t=s),u.apply(null,[t].concat(__slice.call(f)))):void 0},p=function(){var e,t,u;for(u=[],e=0,t=n.length;t>e;e++)l=n[e],u.push(r.wrapPromise(o(l),a));return u}(),p.length<2?p[0]:e.all(p)},r.wrapPromise=function(e,r){var n,o;return o=function(e){var t,n,o,u,i;return n=e.data,u=e.status,o=e.headers,t=e.config,i=e,r(null,i)},n=function(e){var n,o,u,i,s,a;return o=e.data,s=e.status,i=e.headers,n=e.config,a=e,u=new t.type.Http(e),a.error=u,r(u,a)},e.then(o,n),e},r}()}]),ksc.service("ksc.util",["ksc.error",function(e){var t,r,n,o,u,i,s,a;return n=Object.defineProperty,u=Object.getOwnPropertyDescriptor,i=Object.getPrototypeOf,r=function(t){return t.length?void 0:e.MissingArgument({name:"reference",argument:1})},t=function(){function t(){}return t.defineGetSet=function(e,t,r,o,u){return"function"!=typeof o&&(u=o,o=void 0),n(e,t,{configurable:!0,enumerable:!!u,get:r,set:o})},t.defineValue=function(e,t,r,o,i){var s;return(null!=(s=u(e,t))?s.writable:void 0)===!1&&n(e,t,{writable:!0}),n(e,t,{configurable:!0,enumerable:!!i,value:r,writable:!!o})},t.empty=function(){var t,r,n,o,u,i,s,l,c;for(u=1<=arguments.length?__slice.call(arguments,0):[],u.length||e.MissingArgument({argument:1}),a.apply(this,u)||e.Type({arguments:u,required:"All arguments must be objects"}),i=0,l=u.length;l>i;i++)if(o=u[i],Array.isArray(o))for((t=o.pop)||(t=Array.prototype.pop),r=s=0,c=o.length;c>s;r=s+=1)t.call(o);else for(n in o)__hasProp.call(o,n)&&delete o[n]},t.hasOwn=function(e,t,r){return e&&e.hasOwnProperty(t)&&(null==r||r===e.propertyIsEnumerable(t))},t.hasProperty=function(e,t){for(;e;){if(e.hasOwnProperty(t))return!0;e=i(e)}return!1},t.identical=function(e,r){var n,o;if(!a(e,r))return e===r;e._array&&(e=e._array),r._array&&(r=r._array);for(n in e)if(o=e[n],!t.identical(o,r[n])||!s(r,n))return!1;for(n in r)if(!s(e,n))return!1;return!0},t.isEnumerable=function(e,t){try{return!!u(e,t).enumerable}catch(r){}return!1},t.isKeyConform=function(t,r,n){var o;return"string"==typeof t&&t||"number"==typeof t&&!isNaN(t)?!0:(r&&("string"!=typeof r&&(r="Key conform value"),o={key:t,description:r},n?(o.argument=n,e.ArgumentType(o)):e.Key(o)),!1)},t.isFunction=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],"function"!=typeof e)return!1;return!0},t.isObject=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],!e||"object"!=typeof e)return!1;return!0},t.mergeIn=function(){var t,r,n,o,u,i,s,l;for(u=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],o.length<1&&e.MissingArgument({required:"Merged and mergee objects"}),a(u)||e.Type({target_object:u,argument:1,required:"object"}),t=s=0,l=o.length;l>s;t=++s){n=o[t],a(n)||e.Type({object:n,argument:t+2,required:"object"});for(r in n)i=n[r],u[r]=i}return u},t.propertyRefs=function(t){var r,n,o;for(o={};a(t);){r=!0;for(n in t)__hasProp.call(t,n)&&(Array.isArray(o[n])||(o[n]=[]),o[n].push(t));t=i(t)}return r||e.ArgumentType({object:t,argument:1,accepts:"object"}),o},t.uid=function(e){var r,n;return n=null!=t._uidStore?t._uidStore:t._uidStore={named:{}},null!=e?(t.isKeyConform(e,1),r=n.named):(r=n,e="unnamed"),r[e]=(r[e]||0)+1},t}(),o=t.defineValue,s=t.hasOwn,a=t.isObject,t}]);