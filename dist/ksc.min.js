var __hasProp={}.hasOwnProperty,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;ksc=angular.module("ksc",[]),ksc.factory("ksc.ArrayTracker",["ksc.error","ksc.util",function(e,t){var r,n,o,i,u,s,a,c,l;return n=t.defineGetSet,o=t.defineValue,i=t.hasOwn,u=Array.isArray,s=t.isObject,r=function(){function r(t,a){var l,p,f,d,y,h,g,_,m,v,b,k;for(null==a&&(a={}),i(t,"_tracker")&&e.Value({list:t,description:"List is already tracked"}),u(t)||e.ArgumentType({argument:1,list:t,description:"Must be an array"}),s(a)||e.ArgumentType({argument:2,options:a,description:"Must be an object"}),h=i(a,"store")?a.store:{},s(h)||e.Type({store:h,description:"Must be an object"}),g=this,o(t,"_tracker",g),o(g,"list",t,0,1),o(g,"store",h,0,1),o(g,"origFn",y={}),p=function(t){return null!=t?"function"!=typeof t&&e.Type({fn:t,"Must be a function":"Must be a function"}):t=void 0,t},f={},k=["del","get","set"],v=0,b=k.length;b>v;v++)d=k[v],f[d]=a[d]||void 0;_=function(e){return n(g,e,function(){return f[e]||void 0},function(t){return f[e]=p(t)},1)};for(d in f)l=f[d],f[d]=p(l),_(d);m=function(e){return o(t,e,function(){var t;return t=1<=arguments.length?__slice.call(arguments,0):[],r["_"+e].apply(g,t)})};for(d in r)l=r[d],"_"===d.substr(0,1)&&(d=d.substr(1),y[d]=i(t,d)?{v:t[d]}:{n:1},m(d));c(g)}return r.prototype.unload=function(e){var r,n,i,u,s,c,l;c=s=this,i=c.list,u=c.store,a(s),l=s.origFn;for(n in l)r=l[n],r.n?delete i[n]:o(i,n,r.v);delete s.list._tracker,delete s.list,e||t.empty(u)},r.add=function(e,t,n,o){var i,u,s,a,c,p,f,d,y,h,g;if(null==o&&(o=!0),s=e.list,p=e.store,u=t.length,a=s.length,o&&a>n)for(i=d=g=a-1;d>=n;i=d+=-1)c=p[i],p[i]=void 0,l(e,i+u,c,"move");for(i=y=0,h=t.length;h>y;i=++y)f=t[i],l(e,i+n,f),o&&r.getterify(e,i+a);return s.length},r.getElement=function(e,t){return e.get?e.get(t,e.store[t]):e.store[t]},r.getterify=function(e,t){n(e.list,t,function(){return r.getElement(e,t)},function(r){return l(e,t,r)},1)},r.plainify=function(e){var t,r,n,o;n=e.list,o=e.store,t=function(){var e,t,i;for(i=[],r=e=0,t=n.length;t>e;r=e+=1)i.push(o[r]);return i}(),n.length=0,Array.prototype.push.apply(n,t)},r.process=function(e,t){var n,o,i,u,s;for(s=e.list,n=i=0,u=s.length;u>i;n=++i)o=s[n],r.getterify(e,n),l(e,n,o,t)},r.rm=function(e,t){var r,n,o,i,u,s,a,c,p,f;if(i=e.list,c=e.store,i.length){for(u=i.length,a=i[t],(r=e.del)&&(n=c[u-1]),o=p=f=t+1;u>p;o=p+=1)s=c[o],c[o]=void 0,l(e,o-1,s,"move");return i.length=u-1,("function"==typeof r?r(u-1,n):void 0)!==!1&&delete c[u-1],a}},r.setElement=function(e,t,r,n){var o,i;i=function(){return arguments.length&&(r=arguments[0]),o[t]===r?!1:(o[t]=r,!0)},o=e.store,e.set?e.set(t,r,i,n||"external"):i()},r._pop=function(){return r.rm(this,this.list.length-1)},r._shift=function(){return r.rm(this,0)},r._push=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,this.list.length)},r._unshift=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,0)},r._splice=function(){var e,t,n,o,i,u,s,a,c,p,f,d,y,h,g,_,m,v,b,k;if(n=arguments[0],e=arguments[1],o=3<=arguments.length?__slice.call(arguments,2):[],_=f=this,u=_.list,p=_.store,i=o.length,a=u.length,n=parseInt(n,10)||0,n=0>n?Math.max(0,a+n):Math.min(n,a),e=parseInt(e,10)||0,e=Math.max(0,Math.min(e,a-n)),c=u.slice(n,n+e),s=function(t,r){var n;return n=p[t],r&&(p[t]=void 0),l(f,t-e+i,n,"move")},e>i){for(t=d=m=n+e;a>d;t=d+=1)s(t);for(t=y=0,v=e-i;v>y;t=y+=1)r.rm(f,a-t-1)}else if(i>e)for(t=h=b=a-1,k=n+e;h>=k;t=h+=-1)s(t,1);if(i){for(t=g=e;i>g;t=g+=1)r.getterify(f,t+a);r.add(f,o,n,0)}return c},r._sort=function(e){var t,r;return r=this,a(r),t=Array.prototype.sort.call(r.list,e),c(r,"reload"),t},r._reverse=function(){var e,t;return t=this,a(t),e=Array.prototype.reverse.call(t.list),c(t,"reload"),e},r}(),a=r.plainify,c=r.process,l=r.setElement,r}]),ksc.service("ksc.batchLoaderRegistry",["ksc.error",function(e){var t;return new(t=function(){function t(){}return t.prototype.map={},t.prototype.get=function(e,t){var r,n,o,i;i=this.map;for(r in i)if(n=i[r],o=n.get(e,t))return o;return!1},t.prototype.register=function(t){var r;return"string"==typeof(r=null!=t?t.endpoint:void 0)&&r||e.Value({endpoint:r,required:"url"}),this.map[r]&&e.Value({endpoint:r,description:"already registered"}),this.map[r]=t},t.prototype.unregister=function(e){return this.map[e.endpoint]?delete this.map[e.endpoint]:!1},t}())}]),ksc.factory("ksc.BatchLoader",["$http","$q","ksc.batchLoaderRegistry","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s;return u=n.ArgumentType,s=o.isObject,i=function(){function i(e,t){var i,a,c,l,p;this.endpoint=e,this.map=t,a=this,e&&"string"==typeof e||u({endpoint:e,required:"string"}),s(t)||u({map:t,required:"object"});for(i in t)p=t[i],"string"==typeof p&&i||n.Type({key:i,url:p,required:"url string"});c=!0,l=function(e){return c&&!e&&a.flush(),c=!!e},o.defineGetSet(a,"open",function(){return c},l,1),o.defineValue(a,"requests",[],0,1),r.register(a)}return i.prototype.get=function(e,r){var n,o,i,a,c,l,p;if(i=this,c=i.requests,e&&"string"==typeof e||u({url:e,required:"string"}),null==r||s(r)||u({query_parameters:r,required:"object"}),!i.open)return!1;p=i.map;for(o in p)if(l=p[o],e===l){a=o;break}return a?(n=t.defer(),c.push({resource:a,deferred:n}),r&&(c[c.length-1].query=r),n.promise):!1},i.prototype.flush=function(){var t,r,n,o,i,u,s;for(n=this,i=n.requests,r=[],u=0,s=i.length;s>u;u++)o=i[u],o.deferred&&(r.push(o.deferred),delete o.deferred);return r.length?(t=e.put(n.endpoint,i),t.success(function(e,t,n,o){var i,u,s,a,c,l,p;for(u=c=0,l=r.length;l>c;u=++c)i=r[u],null!=(a=e[u])?(s={data:a.body,status:a.status,headers:n,config:o},200<=(p=a.status)&&400>p?i.resolve(s):i.reject(s)):i.reject({data:e,status:t,headers:n,config:o})}),t.error(function(e,t,n,o){var i,u,s;for(u=0,s=r.length;s>u;u++)i=r[u],i.reject({data:e,status:t,headers:n,config:o})})):!1},i}()}]),ksc.factory("ksc.EditableRecord",["ksc.Record","ksc.error","ksc.util",function(e,t,r){var n,o,i,u,s,a,c,l,p,f,d,y,h,g,_,m;return c="_array",p="_changes",l="_changedKeys",f="_deletedKeys",d="_edited",y="_events",h="_options",g="_parent",_="_parentKey",m="_saved",o=r.defineValue,i=r.hasOwn,u=Array.isArray,s=r.isEnumerable,a=r.isObject,n=function(n){function v(e,r,n,i){var u;null==e&&(e={}),null==r&&(r={}),a(r)||t.ArgumentType({options:r,argument:2,required:"object"}),r.subtreeClass=v,u=this,o(u,d,{}),o(u,p,0),o(u,l,{}),o(u,f,{}),o(u,m,{}),v.__super__.constructor.call(this,e,r,n,i)}return __extends(v,n),v.prototype._changes=0,v.prototype._clone=function(t,r,n){var o,i,u,s,a;if(u=this,o=v.__super__._clone.call(this,t,r),!n){a=u[d];for(i in a)s=a[i],(null!=s?s._clone:void 0)&&(s=s._clone(t,r)),t?o[i]=s:o._setProperty(i,s);for(i in u[f])t?delete o[i]:o._delete(i)}return t||r||e.getAllStatic(u,o),o},v.prototype._delete=function(){var n,a,c,y,g,_,v,b,k;for(_=1<=arguments.length?__slice.call(arguments,0):[],_.length||t.MissingArgument({name:"key",argument:1}),v=this,n=[],c=b=0,k=_.length;k>b;c=++b)if(g=_[c],r.isKeyConform(g,1,c),!c&&(a=v[h].contract)&&t.ContractBreak({key:g,value:value,contract:a[g]}),((y=v._idProperty)===g||u(y)&&__indexOf.call(y,g)>=0)&&t.Permission({key:g,description:"idProperty keys can not be deleted"}),i(v[m],g)){if(v[f][g])continue;v[f][g]=!0,v[l][g]||(o(v,p,v[p]+1),o(v[l],g,!0,0,1)),delete v[d][g],Object.defineProperty(v,g,{enumerable:!1}),n.push(g)}else i(v,g)&&(s(v,g)||t.Key({key:g,description:"can not be changed"}),delete v[g],v[d][g]&&(delete v[d][g],o(v,p,v[p]-1),delete v[l][g]),n.push(g));return n.length&&e.emitUpdate(v,"delete",{keys:n}),!!n.length},v.prototype._getProperty=function(t){var r,n;return r=this,n=v.__super__._getProperty.apply(this,arguments),r[f][t]?void 0:i(r[d],t)?e.arrayFilter(r[d][t]):n},v.prototype._replace=function(t){var r,n,o,i;i=this,(o=i[y])&&o.halt();try{n=i._revert(0),r=v.__super__._replace.call(this,t,0)}finally{o&&o.unhalt()}return o&&(n||r)&&e.emitUpdate(i,"replace"),n||r},v.prototype._revert=function(t){var r,n,i;null==t&&(t=!0),r=!1,i=this;for(n in i[f])delete i[f][n],delete i[l][n],r=!0;for(n in i[d])delete i[d][n],delete i[l][n],r=!0;return r&&(o(i,p,0),t&&e.emitUpdate(i,"revert")),r},v.prototype._setProperty=function(n,y,b){var k,P,A,j,M,O,w,q,S,R,x,T,C,$,F,V,L,I,E,K,U,N,B;if(b)return v.__super__._setProperty.apply(this,arguments);if(R=this,T=R[m],M=R[d],A=R[h].contract,e.valueCheck(R,n,y),((w=R._idProperty)===n||u(w)&&__indexOf.call(w,n)>=0)&&null!==y&&"string"!=(E=typeof y)&&"number"!==E&&t.Value({value:y,required:"string or number or null"}),y=e.valueWrap(R,n,y),r.identical(T[n],y))delete M[n],P=1;else if(!r.identical(M[n],y)){if(null!=A&&A._match(n,y),x=y,j=function(){var e;for(e in x)s(x,e)&&!i(y,e)&&x._delete(e)},k=null!=y?y[c]:void 0){if(a(T[n]))if(x=T[n],C=x[c]){for(O=V=K=k.length,U=C.length;U>V;O=V+=1)C.pop();for(N=k.slice(0,C.length),O=L=0,I=N.length;I>L;O=++L)q=N[O],C[O]=q;C.push.apply(C,k.slice(C.length))}else j(),e.arrayify(x),(B=x[c]).push.apply(B,k)}else if(a(y)&&a(T[n])){x=T[n],x[c]&&e.dearrayify(x),j();for(S in y)$=y[S],x._setProperty(S,$)}M[n]=x,P=1}return R[f][n]&&(delete R[f][n],P=1),M[n]===T[n]&&delete M[n],F=R[l][n],a(T[n])&&T[n]._changes||i(M,n)&&!r.identical(T[n],M[n])?F||(o(R,p,R[p]+1),o(R[l],n,!0,0,1)):F&&(o(R,p,R[p]-1),delete R[l][n]),e.getterify(R,n),P&&(R[_]&&v.subChanges(R[g],R[_],R[p]),Object.defineProperty(R,n,{enumerable:!0}),e.emitUpdate(R,"set",{key:n})),!!P},v.subChanges=function(e,t,r){var n;e[l][t]?r||(o(e,p,e[p]-1),delete e[l][t],n=!0):r&&(o(e,p,e[p]+1),o(e[l],t,!0,0,1),n=!0),n&&e[_]&&v.subChanges(e[g],e[_],e[p])},v}(e)}]),ksc.factory("ksc.EditableRestRecord",["$http","ksc.EditableRecord","ksc.Mixin","ksc.RestRecord",function(e,t,r,n){var o;return o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),r.extend(o,n),o.prototype._restSave=function(t){var r;return r=o.getUrl(this),o.async(this,e.put(r,this._entity()),t)},o}(t)}]),ksc.service("ksc.error",function(){var e,t,r,n,o,i,u,s,a,c,l,p,f,d;r=function(e){function t(e){var t,r,n;if(r="",e&&"object"==typeof e)for(t in e){n=e[t];try{n=JSON.stringify(n,null,2)}catch(o){n=String(n)}r+="\n  "+t+": "+n}else null!=e&&(r+=String(e));this.message=r}return __extends(t,e),t}(Error),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),n=function(){function r(){}return r.ArgumentType=e,r.ContractBreak=t,r.Http=o,r.Key=i,r.MissingArgument=u,r.Permission=s,r.Type=a,r.Value=c,r}(),p={type:n},d=function(e){return p[f]=function(t){throw new e(t)}};for(f in n)l=n[f],l.prototype.name=f+"Error",d(l);return p}),ksc.factory("ksc.EventEmitter",["$interval","$rootScope","$timeout","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s,a,c,l,p,f;return s="__unsubscriber__",a=n.ArgumentType,c=o.isFunction,l=o.isObject,u=function(){function e(){}return e.prototype.emit=function(){var e,t,r,n,o,i,u,s,a,l,p,f;for(i=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],u=null!=this.names?this.names:this.names={},t=null!=u[i]?u[i]:u[i]={},n=!1,t.fired=(t.fired||0)+1,t.lastArgs=e,p=[0,1],a=0,l=p.length;l>a;a++)if(s=p[a],t[s]){f=t[s];for(o in f)r=f[o],c(r)&&(n=!0,s&&delete t[s][o],r.apply(null,e))}return n},e.prototype.instantCall=function(e,t){var r,n;return r=null!=this.names?this.names:this.names={},(null!=(n=r[e])?n.fired:void 0)?(t.apply(null,r[e].lastArgs),!0):!1},e.prototype.push=function(e,t,r){var n,o,u,a,c,l,p,f,d,y;for(l=null!=this.names?this.names:this.names={},u=[],t=t?1:0,d=0,y=e.length;y>d;d++)a=e[d],null==l[a]&&(l[a]={}),n=null!=(f=l[a])[t]?f[t]:f[t]={i:0},n[n.i]=r,u.push({name:a,id:n.i}),n.i+=1;return p=!1,o=i.prototype.unsubscriber(),c=function(){var e,r,n;if(p)return!1;for(p=!0,r=0,n=u.length;n>r;r++)e=u[r],delete l[e.name][t][e.id];return!0},c[s]=!0,o.add(c),o},e}(),p=function(e){return"string"!=typeof e&&a({name:e,argument:1,required:"string"}),e?void 0:n.Value({name:e,description:"must be a non-empty string"})},f=function(e,r,n,o){var i,f,d,y,h;for(null==this.subscriptions&&(this.subscriptions=new u),c(n)||a({callback:n,argument:"last",required:"function"}),(null!=r?r[s]:void 0)||l(r)&&(f=t.isPrototypeOf(r))||(e.push(r),r=null),y=0,h=e.length;h>y;y++)i=e[y],p(i);return d=o.call(this),r?(f?r.$on("$destroy",d):r.add(d),!0):d},i=function(){function n(){this.on=__bind(this.on,this),this.on1=__bind(this.on1,this),this["if"]=__bind(this["if"],this),this.if1=__bind(this.if1,this)}return n.prototype.emit=function(){var e,t,r;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],p(t),this._halt&&(t=this._halt+"#!"+t),(r=null!=this.subscriptions?this.subscriptions:this.subscriptions=new u).emit.apply(r,[t].concat(__slice.call(e)))},n.prototype.emitted=function(e){var t,r,n;return p(e),(null!=(r=t=null!=(n=this.subscriptions)?n.names[e]:void 0)?r.fired:void 0)?t.lastArgs:!1},n.prototype.halt=function(){return this._halt=(this._halt||0)+1},n.prototype.unhalt=function(){return this._halt-=1},n.prototype.if1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o,i;for(n=[],o=0,i=t.length;i>o;o++)r=t[o],this.subscriptions.instantCall(r,e)||n.push(r);return this.subscriptions.push(n,1,e)})},n.prototype["if"]=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o;for(n=0,o=t.length;o>n;n++)r=t[n],this.subscriptions.instantCall(r,e);return this.subscriptions.push(t,0,e)})},n.prototype.on1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,1,e)})},n.prototype.on=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,0,e)})},n.prototype.unsubscriber=function(n){var o,i,u;return o={},u=0,i=function(){var t,n,i;i=null;for(t in o)n=o[t],c(n)?n()||(i=!1):null!=n.$$intervalId?e.cancel(n):r.cancel(n);return i},null!=n&&(t.isPrototypeOf(n)||a({scope:n,required:"$rootScope descendant"}),n.$on("$destroy",i)),i[s]=!0,i.add=function(e){return function(t){var r,n;return r=function(){return delete o[t]},n=function(){return a({unsubscriber:e,argument:1,required:["function","Promise"]})},l(e)?null!=e.$$timeoutId&&null!=e["finally"]?e["finally"](r):null!=e.$$intervalId&&null!=e["finally"]?e["finally"](r):n():c(e)&&e[s]||n(),o[t]=e}(u),u+=1,!0},i},n}()}]),ksc.factory("ksc.ListMapper",["ksc.util",function(e){var t,r;return r=e.defineValue,t=function(){function t(e){var t,n,o,i,u;this.parent=e,i=this,u=e.source,r(i,"multi",u&&!u._,0,1),r(i,"_sources",[],0,1),n=function(e){var t,r,o;if(e.source){o=e.source;for(t in o)if(r=o[t],n(r))return!0;return!1}return null!=e.idProperty},(o=n(e))&&(r(i,"idMap",{},0,1),r(i,"pseudoMap",{},0,1)),t=function(e,r,u,s){var a,c,l,p,f,d;if(null==r&&(r={}),null==u&&(u={}),p=e.source){if(p._)return t(p._,r,u,s);d=[];for(l in p)c=p[l],o&&n(e)&&(r[l]={},u[l]={}),f=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)a=s[e],r.push(a);return r}(),f.push(l),d.push(t(c,r[l],u[l],f));return d}return i._sources.push({names:s,source:e})},t(e,i.idMap,i.pseudoMap,[]),Object.freeze(i._sources)}return t.prototype.add=function(r,n){var o,i,u;return i=this,null!=r._id?(o=r._id,u=i.idMap):(o=r._pseudo,u=i.pseudoMap),u=t.deepTarget(u,n),e.defineGetSet(u,o,function(){return r},function(e){return r._replace(e)},1),r},t.prototype.del=function(r,n,o){var i,u;i=this,e.isObject(r)&&(n=r._pseudo,r=r._id),null!=n?(u=i.pseudoMap,r=n):u=i.idMap,u=t.deepTarget(u,o),delete u[r]},t.prototype.has=function(r,n,o){var i,u,s;return u=this,e.isObject(r)&&(n=r._pseudo,r=r._id),null!=n?(i=n,s=u.parent.pseudoMap):(i=r,s=u.parent.idMap),s=t.deepTarget(s,o),s[i]||!1},t.deepTarget=function(e,t){var r,n,o;if(t)for(n=0,o=t.length;o>n;n++)r=t[n],e=e[r];return e},t.register=function(e){var n;n=new t(e),r(e,"_mapper",n),n.idMap&&(r(e,"idMap",n.idMap),r(e,"pseudoMap",n.pseudoMap))},t}()}]),ksc.factory("ksc.ListMask",["$rootScope","ksc.ArrayTracker","ksc.EventEmitter","ksc.List","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,i,u,s,a){var c,l,p,f,d,y;return l="_scopeUnsubscriber",p=s.ArgumentType,f=a.defineGetSet,d=a.defineValue,y=a.isObject,c=function(){function c(n,a,f,h){var g,_,m,v,b,k,P,A,j,M,O,w,q,S,R,x,T,C,$,F,V,L,I,E;(n instanceof Array||"object"!=typeof n)&&(n={_:n}),b=0;for(A in n)P=n[A],P instanceof Array&&P.options&&P.events instanceof r||p({source:P,name:A,required:"List"}),b+=1,d(n,A,P,0,1);Object.freeze(n),n._&&b>1&&p({source:n,conflict:'Can not have unnamed ("_") and named sources mixed'}),y(a)&&(h=f,f=a,a=null),null==f&&(f={}),y(f)||p({options:f,argument:3,required:"object"}),e.isPrototypeOf(f)&&(h=f,f={}),null!=h&&(e.isPrototypeOf(h)||p({scope:h,required:"$rootScope descendant"})),a&&(f.filter=a),m=[],new t(m,{set:function(e,t,r,n){var o;"external"===n&&(o=m._tracker.store[e])instanceof u?o._replace(t):r()}}),d(m,"_origFn",{}),V=this.constructor.prototype;for(_ in V)O=V[_],null!=O&&"constructor"!==_&&(m._origFn[_]=m[_],d(m,_,O));for(L=["pop","push","reverse","shift","sort","splice","unshift"],q=0,T=L.length;T>q;q++)_=L[q],m._origFn[_]=m[_],d(m,_);for(d(m,"events",new r),d(m,"options",f),d(m,"source",n),c.registerFilter(m),c.registerSplitter(m),o.register(m),j=m._mapper._sources,h&&d(m,l,h.$on("$destroy",function(){return delete m[l],m.destroy()})),M=null,g=[],w=function(e){var t;return t=e.source.events.on("update",function(t){return c.update.call(m,t,e.names)}),M?M.add(t):M=t,M.add(e.source.events.on("destroy",function(){return m.destroy()}))},S=0,C=j.length;C>S;S++)k=j[S],I=k.source,__indexOf.call(g,I)>=0&&s.Value({sources:j,conflict:"Source can not be referenced twice to keep list unique"}),g.push(k.source),w(k);for(d(m,"_sourceUnsubscriber",M),i.register(m,f.sorter),R=0,$=j.length;$>R;R++)for(k=j[R],E=k.source,x=0,F=E.length;F>x;x++)v=E[x],m.filter(v)&&(null!=v._parent.idProperty&&m._mapper.add(v,k.names),c.add(m,v));return m}return c.prototype.destroy=function(){return n.prototype.destroy.call(this)},c.prototype.update=function(){var e,t,r,n,o,i,u,s,a,l,p,f,d,y;for(e={},r=this,o=r._mapper,d=o._sources,a=0,p=d.length;p>a;a++)for(u=d[a],s=u.names,y=u.source,l=0,f=y.length;f>l;l++)i=y[l],t=(n=i._parent.idProperty)?o.has(i,null,s):__indexOf.call(r,i)>=0,r.filter(i)?t||(n&&o.add(i,s),c.add(r,i),(null!=e.add?e.add:e.add=[]).push(i)):t&&(n&&o.del(i,null,s),(null!=e.cut?e.cut:e.cut=[]).push(i));return e.cut&&c.cut(r,e.cut),c.rebuild(r),(e.add||e.cut)&&r.events.emit("update",{node:r,action:e}),e},c.add=function(e,t){var r,n,o,i,u;if(o=c.splitterWrap(e,t),e.sorter)for(i=0,u=o.length;u>i;i++)r=o[i],n=e.sorter.position(r),e._origFn.splice.call(e,n,0,r);else e._origFn.push.apply(e,o)},c.cut=function(e,t){var r,n,o;for(o=[];r=e._origFn.pop();)n=r._original||r,__indexOf.call(t,n)<0&&o.push(r);o.length&&(o.reverse(),e._origFn.push.apply(e,o))},c.rebuild=function(e){var t,r,n,o,i,u,s,l;for(a.empty(e),s=e._mapper._sources,n=0,i=s.length;i>n;n++)for(r=s[n],l=r.source,o=0,u=l.length;u>o;o++)t=l[o],e.filter(t)&&e._origFn.push.apply(e,c.splitterWrap(e,t))},c.registerFilter=function(e){var t,r,n,o;t=function(){return!0},(r=e.options.filter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&s.Type({filter_function:n,required:"function"}),r=n,e.update()},f(e,"filter",n,o,1),f(e.options,"filter",n,o,1)},c.registerSplitter=function(e){var t,r,n,o;t=function(){return!1},(r=e.options.splitter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&s.Type({splitter_function:n,required:"function"}),r=n,e.update()},f(e,"splitter",n,o,1),f(e.options,"splitter",n,o,1)},c.splitterWrap=function(e,t){var r,n,o,i,u,a,c,l,p;if((u=e.splitter(t))&&u instanceof Array){for(i=[],l=0,p=u.length;p>l;l++){r=u[l],y(r)||s.Type({splitter:e.splitter,description:"If Array is returned, all elements must be objects with override data"}),o=Object.create(t),c=function(e,t){var r,n;return r=function(){return t[e]},n=function(r){return t[e]=r},f(o,e,r,n,1)};for(n in t)c(n,t);for(n in r)a=r[n],d(o,n,a,0,1);d(o,"_original",t),i.push(o)}return i}return[t]},c.update=function(e,t){var r,n,o,i,u,s,a,l,p,f,d,y,h,g,_,m,v,b,k,P,A,j,M,O,w,q,S,R,x,T,C,$,F;if(r=null,o=[],d=this,l=e.action,y=d._mapper,n=function(e,t){var n;return(null!=(n=null!=r?r:r={})[e]?n[e]:n[e]=[]).push(t)},p=function(e,r,n){return n._parent.idProperty?[1,y.has(e,r,t)]:[0,__indexOf.call(d,n)>=0]},i=function(e,r,i){var u,s,a;a=p(e,r,i),u=a[0],s=a[1],s&&(n("cut",i),o.push(i),u&&y.del(e,r,t))},s=function(e,r,n){var o,i,u;return u=p(e,r,n),o=u[0],i=u[1],o&&!i&&y.add(n,t),i},u=function(e,r){var n,o,i;return i=p(e,r,_),n=i[0],o=i[1],n&&o&&y.del(e,r,t),o},l.cut)for(x=l.cut,M=0,q=x.length;q>M;M++)_=x[M],i(_._id,_._pseudo,_);if(l.add)for(T=l.add,O=0,S=T.length;S>O;O++)_=T[O],d.filter(_)&&(s(_._id,_._pseudo,_),c.add(d,_),n("add",_));if(l.update)for(C=l.update,w=0,R=C.length;R>w;w++)if(e=C[w],$=e,_=$.record,e=$.info,h=$.merge,g=$.move,v=$.source,a=P=null,(m=h||g)&&(a=m.from,P=m.to),d.filter(_))if(b=a&&u(a.idMap,a.pseudoMap),k=P?s(P.idMap,P.pseudoMap,_):s(_._id,_._pseudo,_),b&&k)n("update",{record:_,info:e,merge:m,source:v}),o.push(v);else if(b)n("update",{record:_,info:e,move:m});else if(k){A={record:_},F={info:e,source:v};for(f in F)j=F[f],null!=j&&(A[f]=j);n("update",A)}else c.add(d,_),n("add",_);else h?(i(a.idMap,a.pseudoMap,v),i(P.idMap,P.pseudoMap,_)):g?i(a.idMap,a.pseudoMap,_):i(_._id,_._pseudo,_);d.sorter?o.length&&c.cut(d,o):c.rebuild(d),r&&d.events.emit("update",{node:d,action:r})},c}()}]),ksc.factory("ksc.ListSorter",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.defineValue,o=t.isKeyConform,r=function(){function r(i,u){var s,a,c;a=this,n(a,"list",i),"function"==typeof u?a.fn=u:((o(u)||u instanceof Array)&&(u={key:u}),t.isObject(u)&&(o(s=u.key)||s instanceof Array)||e.Value({sorter:u,requirement:"function or string or array or object: {key: <string|array>, reverse: <bool>, type: 'natural|number|byte'}"}),(c=u.type)?"byte"!==c&&"natural"!==c&&"number"!==c&&e.Value({type:c,required:"byte, natural or number"}):c="natural",n(a,"key",s,0,1),n(a,"reverse",!!u.reverse,0,1),n(a,"type",c,0,1),n(a,"fn",r.getSortFn(a),0,1)),Object.preventExtensions(a)}return r.prototype.position=function(t){var r,n,o,i,u,s,a,c;return c=this,n=c.fn,u=c.list,(i=u.length)?(a=0,s=i-1,r=function(t){return("number"!=typeof t||isNaN(t))&&e.Type({sort_fn_output:t,required:"number"}),t},r(n(t,u[a]))<0?a:1===i?1:r(n(t,u[s]))>=0?s+1:(o=function(e,i){var s;return i-1>e?(s=Math.floor((i-e)/2+e),r(n(t,u[s]))<0?o(e,s):o(s,i)):i})(a,s)):0},r.getSortFn=function(e){var t,r,n,i,u,s;return r=e.key,u=e.reverse,s=e.type,u=u?-1:1,t=function(e,t){var r;return function(){var n,o,i;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],null!=e[r]&&i.push(e[r]);return i}().join(" ")},i=function(e){return"number"!=typeof e?"string"==typeof e&&""!==e?Number(e):0/0:e},n=function(e,t){var r,n,o,i,u,s,a,c;if(e=String(e).toLowerCase(),t=String(t).toLowerCase(),s=0,c=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g,e===t)return 0;for(n=e.toLowerCase().match(c),i=t.toLowerCase().match(c),r=null!=n?n.length:0;r>s;)return null==i||void 0===i[s]?1:(o=n[s],u=i[s],s+=1,a=o-u,isNaN(a)?o>=u?1:-1:a);return-1},function(e,a){var c,l;if(o(r)?(e=e[r],a=a[r]):(e=t(e,r),a=t(a,r)),"number"===s){if(c=e,l=a,e=i(e),a=i(a),isNaN(e))return isNaN(a)?n(c,l)*u:-1*u;if(isNaN(a))return 1*u}else null==e&&(e=""),null==a&&(a="");return"natural"===s?n(e,a)*u:("byte"===s&&(e=String(e),a=String(a)),e===a?0:(e>a?1:-1)*u)}},r.register=function(e,n){var o,i,u;u=void 0,n&&(u=new r(e,n)),o=function(){return u},i=function(t){return t?(u=new r(e,t),e._origFn.sort(u.fn),e.events.emit("update",{node:e,action:{sort:!0}})):u=void 0},t.defineGetSet(e,"sorter",o,i),t.defineGetSet(e.options,"sorter",o,i,1)},r}()}]),ksc.factory("ksc.List",["$rootScope","ksc.ArrayTracker","ksc.EditableRecord","ksc.EventEmitter","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,i,u,s,a){var c,l,p,f,d;return l="_scopeUnsubscriber",p=s.ArgumentType,f=a.defineValue,d=a.isObject,c=function(){function c(){var r,c,y,h,g,_,m,v,b,k,P,A;m=[],g=v=y=b=void 0;for(c in arguments)r=arguments[c],Array.isArray(r)?(g&&p({argument:r,number:c,description:"Ambiguous: can only take 1 array"}),g=r):d(r)?e.isPrototypeOf(r)?(b&&p({argument:r,number:c,description:"Ambiguous: can only take 1 scope"}),b=r):(v&&p({argument:r,number:c,description:"Ambiguous: can only take 1 object for options"}),v=r):a.isKeyConform(r)?(null!=y&&p({argument:r,number:c,description:"Ambiguous: can only take 1 id_property"}),y=r):p({argument:r,number:c,description:"Unknown type for a List argument"});null!=(null!=v&&null!=(P=v.record)?P.idProperty:void 0)&&y&&p({argument:y,options:v,description:"id_property argument conflicts with .options.record.idProperty"}),v=angular.copy(v)||{},f(m,"options",v),null==v.record&&(v.record={}),u.checkIdProperty(null!=y?y:y=v.record.idProperty),h=function(){return s.Permission({description:"idProperty can not be changed run-time"})},a.defineGetSet(m,"idProperty",function(){return y},h),a.defineGetSet(v.record,"idProperty",function(){return y},h,1),f(m,"_sourceType","List"),f(m,"events",new n),null!=y&&o.register(m),b&&f(m,l,b.$on("$destroy",function(){return delete m[l],m.destroy()})),new t(m,{set:function(e,t,r,n){var o;"external"===n&&(o=m._tracker.store[e])instanceof u?o._replace(t):r()}}),f(m,"_origFn",{}),A=this.constructor.prototype;for(_ in A)k=A[_],null!=k&&"constructor"!==_&&(m._origFn[_]=m[_],f(m,_,k));return i.register(m,v.sorter),g&&m.push.apply(m,g),m}return c.prototype._mapper=void 0,c.prototype._origFn=void 0,c.prototype._tracker=void 0,c.prototype.events=void 0,c.prototype.idMap=void 0,c.prototype.idProperty=void 0,c.prototype.pseudoMap=void 0,c.prototype.options=void 0,c.prototype.destroy=function(){var e;return e=this,Object.isFrozen(e)?!1:(e.events.emit("destroy"),"function"==typeof e[l]&&e[l](),"function"==typeof e._sourceUnsubscriber&&e._sourceUnsubscriber(),a.empty(e),delete e.options,delete e._sourceUnsubscriber,Object.freeze(e),!0)},c.prototype.cut=function(){var e,t,r,n,o,i,u,a,l,p,f,y;for(a=1<=arguments.length?__slice.call(arguments,0):[],a.length||s.MissingArgument({name:"record",argument:1}),t=[],o=this,i=o._mapper,l=[],f=0,y=a.length;y>f;f++)u=a[f],d(u)?(__indexOf.call(o,u)<0&&s.Value({record:u,description:"not found in list"}),i&&(i.has(u)||s.Key({record:u,description:"idMap/pseudoMap id error"}),i.del(u)),t.push(u)):(r=u,(u=i.has(r))||s.Key({id:r,description:"map id error"}),i.del(r),t.push(u._id!==r?r:u)),l.push(u);for(p=[];n=o._origFn.pop();)__indexOf.call(l,n)<0&&p.push(n);return p.length&&(p.reverse(),c.inject(o,o.length,p)),e={cut:t},c.emitAction(o,e),e},c.prototype.empty=function(e){var t,r,n,o,i;n=this,t={cut:[]},n.events.halt();try{for(r=o=0,i=n.length;i>o;r=o+=1)t.cut.push(n.shift())}finally{n.events.unhalt()}return t.cut.length&&c.emitAction(n,t),e?t:this},c.prototype.pop=function(){return c.remove(this,"pop")},c.prototype.push=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=c.normalizeReturnAction(t,n),r=this,e=c.add(r,t,r.length),n?e:r.length},c.prototype.shift=function(){return c.remove(this,"shift")},c.prototype.unshift=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=c.normalizeReturnAction(t,n),r=this,e=c.add(r,t,0),n?e:r.length},c.prototype.splice=function(){var e,t,r,n,o,i,u,s,l;i=arguments[0],t=arguments[1],r=4<=arguments.length?__slice.call(arguments,2,l=arguments.length-1):(l=2,[]),s=arguments[l++],s=c.normalizeReturnAction(r,s),"undefined"==typeof r[0]&&1===r.length&&r.pop(),"boolean"!=typeof t||r.length||(s=t,t=null),u=function(e,t){return"number"==typeof e&&(e>0||0===e)&&e===Math.floor(e)?void 0:p({value:e,argument:t,required:"int >= 0"})},e={},o=this,n=o.length,0>i&&(i=Math.max(n+i,0)),u(i),i=Math.min(n,i),null!=t?(u(t),t=Math.min(n-i,t)):t=n-i,o.events.halt();try{t>0&&(e=o.cut.apply(o,o.slice(i,i+t))),r.length&&a.mergeIn(e,c.add(o,r,i))}finally{o.events.unhalt()}return(e.cut||e.add||e.update)&&c.emitAction(o,e),s?e:e.cut||[]},c.prototype.reverse=function(){var e;return e=this,e.sorter&&s.Permission("can not reverse an auto-sorted list"),e.length>1&&(e._origFn.reverse(),c.emitAction(e,{reverse:!0})),e},c.prototype.sort=function(e){var t,r,n,o,i,u;if(n=this,n.sorter&&s.Permission("can not reverse an auto-sorted list"),n.length>1)for(t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o);return r}(),null==e&&(e=function(e,t){return null===e._id&&null===t._id?e._pseudo-t._pseudo:null===e._id?-1:null===t._id?1:e._id>t._id?1:-1}),n._origFn.sort(e),r=i=0,u=n.length;u>i;r=++i)if(o=n[r],o!==t[r]){c.emitAction(n,{sort:!0});break}return n},c.prototype._recordChange=function(e,t,r){var n,o,i,l,p,d,y,h,g,_;if(e instanceof u||s.Type({record:e,required:"Record"}),l=this,n=function(){return f(e,"_pseudo",null),d.add(e)},o={record:e,info:t},(p=l.idMap)&&(d=l._mapper,r!==e._id)){l.events.halt();try{null==e._id?(d.del(r),f(e,"_pseudo",a.uid("record.pseudoMap")),d.add(e),o.move={from:{idMap:r},to:{pseudoMap:e._pseudo}}):null==r?p[e._id]?(o.merge={from:{pseudoMap:e._pseudo},to:{idMap:e._id}},o.record=p[e._id],o.source=e,l.cut(e),l.push(e)):(o.move={from:{pseudoMap:e._pseudo},to:{idMap:e._id}},d.del(null,e._pseudo),n()):p[e._id]?(o.merge={from:{idMap:r},to:{idMap:e._id}},o.record=p[e._id],o.source=e,l.cut(r),l.push(e)):(o.move={from:{idMap:r},to:{idMap:e._id}},d.del(r),n())}finally{l.events.unhalt()}}if(l.sorter)for(e=o.record,h=g=0,_=l.length;_>g;h=++g)if(i=l[h],i===e){l._origFn.splice(h,1),y=l.sorter.position(e),c.inject(l,y,[e]);break}return c.emitAction(l,{update:[o]})},c.add=function(e,t,n){var o,i,l,p,d,y,h,g,_,m,v,b;t.length||s.MissingArgument({name:"item",argument:1}),o={},p=e._mapper,e.events.halt();try{for(g=[],h=e.options.record,y=h["class"]||r,_=0,v=t.length;v>_;_++)l=t[_],d=l,l instanceof u?(l._parent&&l._parent!==e&&l._parent.cut(l),a.mergeIn(l._options,h),f(l,"_parent",e)):l=new y(l,h,e),l._idProperty!==e.idProperty&&s.Value({"list.idProperty":e.idProperty,"record._idProperty":record._idProperty,description:"record._idProperty conflicts with list.idProperty"}),u.setId(l),null!=l._id?((i=p.has(l._id))?(i._replace(l._clone(1)),(null!=o.update?o.update:o.update=[]).push({record:i,source:d})):(p.add(l),g.push(l),(null!=o.add?o.add:o.add=[]).push(l)),l._pseudo&&f(l,"_pseudo",null)):(p&&(f(l,"_pseudo",a.uid("record.pseudoMap")),p.add(l)),g.push(l),(null!=o.add?o.add:o.add=[]).push(l));if(g.length)if(e.sorter)for(m=0,b=g.length;b>m;m++)l=g[m],n=e.sorter.position(l),c.inject(e,n,[l]);
else c.inject(e,n,g)}finally{e.events.unhalt()}return c.emitAction(e,o),o},c.emitAction=function(e,t){return e.events.emit("update",{node:e,action:t})},c.inject=function(e,t,r){var n;(n=e._origFn.splice).call.apply(n,[e,t,0].concat(__slice.call(r)))},c.normalizeReturnAction=function(e,t){return"boolean"!=typeof t&&(e.push(t),t=!1),t},c.remove=function(e,t){var r,n;return(r=e._origFn[t]())&&(null!=(n=e._mapper)&&n.del(r),c.emitAction(e,{cut:[r]})),r},c}()}]),ksc.factory("ksc.Mixin",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=function(e,r,n){var o,i,u;for(null!=e&&"boolean"!=typeof e&&(r.unshift(e),e=!0),i=0,u=r.length;u>i;i++)o=r[i],t.isKeyConform(o,1);return n(e,r)},o=function(e,r,n,o){var i;return t.hasProperty(e,r)?!1:null==n?!0:(i=__indexOf.call(o,r)>=0,n&&i||!n&&!i)},r=function(){function e(){}return e.extend=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendProto.apply(e,[r,n,t].concat(__slice.call(o))),e.extendInstance.apply(e,[r,n,t].concat(__slice.call(o)))},e.extendInstance=function(){var e,t,r,i;return t=arguments[0],r=arguments[1],e=arguments[2],i=4<=arguments.length?__slice.call(arguments,3):[],n(e,i,function(e,n){var i,u;for(i in r)u=r[i],o(t,i,e,n)&&(t[i]=u)})},e.extendProto=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendInstance.apply(e,[r.prototype,n.prototype,t].concat(__slice.call(o)))},e}()}]),ksc.factory("ksc.RecordContract",["ksc.error","ksc.util",function(e,t){var r,n,o,i,u;return r="nullable",i=t.hasOwn,u=t.isObject,o=t.defineValue,n=function(){function t(n){var o,s,a,c,l,p,f,d,y,h;if(null===n||n instanceof t)return n;u(n)||e.Type({contract:n,required:"object"});for(l in n){for(s=n[l],"_"===l.substr(0,1)&&e.Key({key:l,description:'can not start with "_"'}),this[l]=s,s[r]?s[r]=!0:delete s[r],c=0,h=["array","contract","default"],d=0,y=h.length;y>d;d++)a=h[d],s[a]&&(c+=1,c>1&&e.Value({key:a,contract:s,description:"array, default, contract are mutually exclusive"}));f=s.type,!(o=s.array)&&"array"!==f||u(o)||e.Type({array:o,description:"array description required"}),(o=s.array)&&(i(s,"type")&&"array"!==f&&e.Type({type:type,array:o,requiredType:"array"}),delete s.type,f=null),!(p=s.contract)&&"object"!==f||u(p)||e.Type({contract:p,description:"contract description required"}),p&&(i(s,"type")&&"object"!==f&&e.Type({type:type,contract:p,requiredType:"object"}),delete s.type,f=null),o||(p?s.contract=new t(p):(i(s,"default")&&!i(s,"type")&&null!=t.typeDefaults[typeof s["default"]]&&(s.type=f=typeof s["default"]),null==t.typeDefaults[f]&&e.Type({type:f,required:"array, boolean, number, object, string"}))),this._match(l,this._default(l))}Object.freeze(this)}return t.prototype._default=function(n){var o,u,s;if(o=this[n],o||e.Key({key:n,description:"Key not found on contract"}),i(o,"default"))return o["default"];if(o[r])return null;if(o.array)return[];if(o.contract){u={},s=o.contract;for(n in s)__hasProp.call(s,n)&&(u[n]=o.contract._default(n));return u}return t.typeDefaults[o.type]},t.prototype._match=function(t,n){var o;return o=this[t],null!=o&&(o.array&&Array.isArray(n)||o.contract&&u(n)||typeof n===o.type||null===n&&o[r])?!0:e.ContractBreak({key:t,value:n,contract:o})},t.finalizeRecord=function(e){e._options.contract&&Object.isExtensible(e)&&(i(e,"$$hashKey")||o(e,"$$hashKey",void 0,1),Object.preventExtensions(e))},t.typeDefaults={"boolean":!1,number:0,string:""},t}()}]),ksc.factory("ksc.Record",["ksc.ArrayTracker","ksc.EventEmitter","ksc.RecordContract","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s,a,c,l,p,f,d,y,h,g,_,m,v,b,k;return d="_array",y="_events",h="_id",g="_options",_="_parent",m="_parentKey",v="_primaryId",b="_pseudo",k="_saved",i="contract",s=o.defineGetSet,a=o.defineValue,c=o.hasOwn,l=Array.isArray,p=o.isKeyConform,f=o.isObject,u=function(){function u(e,l,d,P){var A,j,M,O,w,q,S,R,x,T,C,$,F,V,L;for(null==e&&(e={}),null==l&&(l={}),f(e)||n.Type({data:e,required:"object"}),u.objReq("data",e,1),u.objReq("options",l,2),q=this,a(q,g,l),a(q,k,{}),c(l,i)&&(A=l[i]=new r(l[i])),a(q,_,d),(null!=d||null!=P)&&(u.objReq("options",d,3),null!=P&&(p(P,1,4),a(q,m,P),delete q[h],delete q[v],delete q[b])),V=A?[q,A]:[q],T=0,$=V.length;$>T;T++){x=V[T],L=o.propertyRefs(Object.getPrototypeOf(x));for(w in L)for(R=L[w],C=0,F=R.length;F>C;C++)S=R[C],Object.defineProperty(S,w,{enumerable:!1})}j=l.idProperty,null==P&&(a(q,h),a(q,v),a(q,b),a(q,y,new t),u.checkIdProperty(j),M=function(){var e;return null!=j?j:null!=(e=q[_])?e.idProperty:void 0},O=function(e){u.checkIdProperty(e),u.setId(q)},s(q,"_idProperty",M,O),s(l,"idProperty",M,O,1),q[y].halt()),q._replace(e),null!=P?a(q,y,null):q[y].unhalt(),r.finalizeRecord(q)}return u.prototype._clone=function(e,t){var r,n,o,i,s,a,c,l,p;if(i=this,r={},e){l=i[k];for(n in l)a=l[n],(null!=a?a._clone:void 0)&&(a=a._clone(1,t)),r[n]=a}else{s={},p=i[k];for(n in p)a=p[n],(null!=a?a._clone:void 0)&&(t||(s[n]=u.getAllStatic(a)),a=a._clone(0,1,1)),r[n]=a;r=new i.constructor(r);for(n in s){a=s[n];for(o in a)c=a[o],r[n][o]=c}}return t||u.getAllStatic(i,r),r},u.prototype._delete=function(){return n.Permission({keys:keys,description:"Read-only Record"})},u.prototype._entity=function(){return this._clone(1)},u.prototype._getProperty=function(e){return p(e,1,1),u.arrayFilter(this[k][e])},u.prototype._replace=function(e,t){var r,o,s,a,p,f,h,_,v;if(null==t&&(t=!0),h=this,a=h[y],null===a&&n.Permission({key:h[m],description:"can not replace subobject"}),_=!0,l(e))p=function(){var t,r,n;for(n=[],t=0,r=e.length;r>t;t++)v=e[t],n.push(v);return n}(),u.arrayify(h),o=1,r=h[d],r._tracker.set=function(e,t){return h._setProperty(e,t,_)},p.length&&r.push.apply(r,p)&&(o=1);else{u.dearrayify(h),p={};for(f in e)v=e[f],p[f]=v;if(s=h[g][i])for(f in s)v=s[f],c(p,f)||(p[f]=s._default(f));for(f in p)v=p[f],u.getterify(h,f),h._setProperty(f,v,_)&&(o=1)}for(f in h[k])c(p,f)||(delete h[f],delete h[k][f],o=1);return o&&a&&t&&u.emitUpdate(h,"replace"),_=!1,!!o},u.prototype._setProperty=function(e,t,r){var i,s;return i=this,s=i[k],r||n.Permission({key:e,value:t,description:"Read-only Record"}),u.valueCheck(i,e,t),c(s,e)&&o.identical(t,i[e])?!1:(a(s,e,u.valueWrap(i,e,t),0,1),u.getterify(i,e),!0)},u.arrayFilter=function(e){var t,r,n,o,i,u,s,l;if(!(t=null!=e?e[d]:void 0))return e;for(i=e,o={};i&&i.constructor!==Object;){for(l=Object.getOwnPropertyNames(i),u=0,s=l.length;s>u;u++)n=l[u],n===d||"_"!==n.substr(0,1)||c(o,n)||(o[n]=Object.getOwnPropertyDescriptor(i,n));i=Object.getPrototypeOf(i)}for(n in t)"_record"===n||"_"!==n.substr(0,1)||c(o,n)||delete t[n];for(n in o)r=o[n],Object.defineProperty(t,n,r);return a(t,"_record",e),t},u.arrayify=function(t){var r;return a(t,d,r=[]),new e(r,{store:t[k],get:function(e){return t._getProperty(e)},set:function(e,r){return t._setProperty(e,r)},del:function(e){return t._delete(e),!1}})},u.checkIdProperty=function(e){var t,r,o,i,u;if(r=function(){return n.Value({item:o,description:"idProperty items must be key conform"})},null!=e)for(t=l(e)?e:[e],t.length||r(),i=0,u=t.length;u>i;i++)o=t[i],p(o)||r()},u.dearrayify=function(e){return delete e[d]},u.emitUpdate=function(e,t,r){var n,o,i,s,a,c,l,p;for(null==r&&(r={}),a=[],c=e;!(n=c[y]);)a.unshift(c[m]),c=c[_];o={node:e},e!==c&&(o.parent=c,o.path=a),o.action=t;for(i in r)l=r[i],o[i]=l;s=c[h],u.setId(c),c[y]._halt||null!=(p=c[_])&&p._recordChange(c,o,s),n.emit("update",o)},u.getAllStatic=function(e,t){var r,n;null==t&&(t={});for(r in e)n=e[r],c(Object.getOwnPropertyDescriptor(e,r),"value")&&(t[r]=n);return t},u.getterify=function(e,t){c(e,t)||s(e,t,function(){return e._getProperty(t)},function(r){return e._setProperty(t,r)},1)},u.objReq=function(e,t,r){var o;f(t)||(o={},o[e]=t,o.argument=r,o.required="object",n.ArgumentType(o))},u.setId=function(e){var t,r,o,u,s,c,f,d,y,_;if(s=function(t){var r,o;(r=e[g][i])&&(null==r[t]&&n.ContractBreak({key:t,contract:r,mismatch:"idProperty"}),"string"!==(o=r[t].type)&&"number"!==o&&n.ContractBreak({key:t,contract:r,required:"string or number"}),null==e[t]&&n.ContractBreak({key:t,value:e[t],mismatch:"idProperty value must exist (not nullable)"}))},null!=(u=e._idProperty))if(l(u)){for(t=[],r=y=0,_=u.length;_>y;r=++y)if(c=u[r],s(c),p(d=e[c]))t.push(d);else if(!r)break;f=e[u[0]],o=t.length?t.join("-"):f,a(e,h,o),a(e,v,f)}else s(u),a(e,h,e[u]);else a(e,h),a(e,v)},u.valueCheck=function(e,t,r){var o;p(t,1,1),(o=e[g][i])?o._match(e[d]?"all":t,r):("string"==typeof t&&"_"===t.substr(0,1)&&n.ArgumentType({key:t,argument:1,description:'can not start with "_"'}),"function"==typeof r&&n.Value({value:r,description:"can not be function"}))},u.valueWrap=function(e,t,r){var n,o,s,a;return o=e[g][i],f(r)&&(r._clone&&(r=r._clone(1)),n=e[g].subtreeClass||u,o&&(a=(s=o[t])?s.array?{contract:{all:s.array}}:{contract:s[i]}:{contract:o.all.contract}),r=new n(r,a,e,t)),r},u}()}]),ksc.factory("ksc.RestList",["$http","$q","ksc.List","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,i,u){var s,a,c,l,p;return a="restCache",c="restPending",s="_primaryId",p=u.defineValue,l=function(r){function a(){var e;return e=a.__super__.constructor.apply(this,arguments),null==e.idProperty&&o.MissingArgument({required:"idProperty is mandatory for RestList"}),e}return __extends(a,r),a.prototype.restCache=void 0,a.prototype.restPending=0,a.prototype.restGetRaw=function(t,r){var u,s,a,l,f,d,y;return"function"==typeof t&&(r=t,t=null),a=this,(u=a.options.endpoint)&&(d=u.url)&&"string"==typeof d||o.Type({"options.endpoint.url":d,required:"string"}),p(a,c,a[c]+1,0,1),(f=n.get(d,t))||(t&&(l=function(){var e;e=[];for(s in t)y=t[s],e.push(encodeURIComponent(s)+"="+encodeURIComponent(y));return e}(),l.length&&(d+=(d.indexOf("?")>-1?"&":"?")+l.join("&"))),f=e.get(d)),i.wrapPromise(f,function(e,t){return p(a,c,a[c]-1,0,1),r(e,t)})},a.prototype.restLoad=function(e,t,r){var n,o,u;return"boolean"!=typeof e&&(r=t,t=e,e=null),"function"==typeof t&&(r=t,t=null),o=this,u=o.options,n=function(){return o.restGetRaw(t,function(e,t){var n,i,u;if(!e)try{n=a.getResponseArray(o,t.data),i=o.push.apply(o,__slice.call(n).concat([!0]))}catch(s){u=s,e=u}return"function"==typeof r?r(e,i,t):void 0})},u.cache&&o.restCache&&!e?r&&i.wrapPromise(o.restCache,r):p(o,"restCache",n(),0,1),o.restCache},a.prototype.restSave=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,1,t,e)},a.prototype.restDelete=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,0,t,e)},a.getResponseArray=function(e,t){var r,n,i,u;if(r=e.options.endpoint,i="responseProperty","undefined"==typeof r[i]){Array.isArray(t)&&(r[i]=null);for(n in t)u=t[n],Array.isArray(u)&&(r[i]=n)}return null!=r[i]&&(t=t[r[i]]),t instanceof Array||o.Value({"options.endpoint.responseProperty":void 0,description:"array type property in response is not found or unspecified"}),t},a.relatedRecords=function(e,t){var r,n,o,i,u;if(null==(r=t[s]))return[t];for(u=[],o=0,i=e.length;i>o;o++)n=e[o],n[s]===r&&u.push(n);return u},a.updateOnSave=function(e,r,n,o){var i,u,a,c,l,p,f,d,y,h,g,_,m,v,b,k;for(f=[],h=[],a=m=0,b=r.length;b>m;a=++m)y=r[a],null!=(l=y[s])||e.options.reloadOnUpdate?(d={},c=e.idProperty,l?d[c[0]]=l:d[c]=y._id,f.push(e.restLoad(d))):h.push([y,n[a]]);if(h.length){e.events.halt(),i=[],_=e.events.on("1#!update",function(e){return i.push(e.action.update[0])});try{for(v=0,k=h.length;k>v;v++)g=h[v],y=g[0],u=g[1],y._replace(u)}finally{_(),e.events.unhalt()}i.length&&e.events.emit("update",{node:e,action:{update:i}})}f.length?(p=t.all(f),p.then(o,o)):o()},a.writeBack=function(e,t,r,n){var i,c,l,p,f,d,y,h,g,_,m;for(n&&"function"==typeof n||(n&&r.push(n),n=null),g={},l=_=0,m=r.length;m>_;l=++_)y=r[l],u.isObject(y)||(r[l]=y=e.idMap[y]),f=y,d=null,h="id:"+(p=null!=y?y._id:void 0),null==(p=null!=y?y._id:void 0)?(d=null!=y?y._pseudo:void 0,h="pseudo:"+d):null!=y[s]&&(h="id:"+y[s]),t?(y=d&&e.pseudoMap[d]||e.idMap[p],y||o.Key({key:f,description:"no such record on list"})):(y=e.idMap[p])||o.Key({key:f,description:"no such record on .idMap"}),g[h]&&o.Value({uid:h,description:"not unique"}),g[h]=y;return r.length||o.MissingArgument({name:"record",argument:1}),c=e.options.endpoint||{},t&&c.bulkSave?(i=String(c.bulkSave).toLowerCase(),"post"!==i&&(i="put"),a.writeBulk(e,i,r,n)):!t&&c.bulkDelete?a.writeBulk(e,"delete",r,n):a.writeSolo(e,t,r,n)},a.writeBulk=function(t,r,n,u){var l,p,f,d,y,h,g;return(g=t.options.endpoint.url)&&"string"==typeof g||o.Type({"options.endpoint.url":g,required:"string"}),h="delete"!==r,p=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)y=n[e],h?r.push(y._entity()):(null==(f=y[s])&&(f=y._id),r.push(f));return r}(),l=[g],h&&l.push(p),t[c]+=1,d=e[r].apply(e,l),i.wrapPromise(d,function(e,r){var o,i,s,l;for(t[c]-=1,o=function(){return"function"==typeof u?u(e,i,r):void 0},i=[],s=0,l=n.length;l>s;s++)y=n[s],i.push.apply(i,a.relatedRecords(t,y));return e||(h?a.updateOnSave(t,n,r.data,o):(t.cut.apply(t,i),o())),o()})},a.writeSolo=function(t,r,n,u){var l,p,f,d,y;return y=[],l=d=null,p=function(e){var t;return t=Array.prototype.slice.call(arguments,1),l=[e,y].concat(__slice.call(t)),d?void 0:("function"==typeof u&&u.apply(null,l),l=null)},f=function(n){var p,f,h,g,_,m,v;return null==(f=n[s])&&(f=n._id),h="delete",_=null!=(m=t.options.record.endpoint)?m.url:void 0,r&&(h="put",n._pseudo&&(h="post",f=null,_=null!=(v=t.options.endpoint)?v.url:void 0)),_&&"string"==typeof _||o.Value({"options.record.endpoint.url":_,required:"string"}),_=_.replace("<id>",f),p=[_],r&&p.push(n._entity()),t[c]+=1,g=e[h].apply(e,p),i.wrapPromise(g,function(e,o){var i;t[c]-=1,i=a.relatedRecords(t,n),e||(r?(d=(d||0)+1,a.updateOnSave(t,[n],[o.data],function(){return d-=1,l&&"function"==typeof u?u.apply(null,l):void 0})):t.cut.apply(t,i)),y.push.apply(y,i)})},i.asyncSquash(n,f,p)},a}(r)}]),ksc.factory("ksc.RestRecord",["$http","ksc.Record","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,i){var u,s,a,c,l;return u="_options",s="_restCache",a="_restPending",l=i.defineValue,c=function(t){function i(){l(this,a,0),i.__super__.constructor.apply(this,arguments)}return __extends(i,t),i.prototype._restPending=0,i.prototype._restLoad=function(t,n){var a,c;return c=this,a=function(){var t,o;return o=i.getUrl(c),(t=r.get(o))||(t=e.get(o)),i.async(c,t,n)},"boolean"!=typeof t&&(n=t,t=null),c[u].cache&&c[s]&&!t?n&&o.wrapPromise(c[s],n):l(c,s,a()),c[s]},i.async=function(e,t,r){return l(e,a,e[a]+1),o.wrapPromise(t,function(t,n){return l(e,a,e[a]-1),!t&&n.data&&e._replace(n.data),"function"==typeof r?r(t,n):void 0})},i.getUrl=function(e){var t,r;return(t=e[u].endpoint)&&null!=(r=t.url)||n.Value({"_options.endpoint.url":void 0}),"string"!=typeof r&&n.Type({"_options.endpoint.url":r,required:"string"}),r},i}(t)}]),ksc.service("ksc.restUtil",["$q","ksc.error",function(e,t){var r;return r=function(){function r(){}return r.asyncSquash=function(n,o,i){var u,s,a,c,l,p,f;return u=0,s=[],l=n.length,f=[],a=function(e,r){var n,o,a,c;return o=r.data,c=r.status,a=r.headers,n=r.config,u+=1,null!=e&&s.push(e),f.push({error:e,data:o,status:c,headers:a,config:n}),u===l&&i?(t=null,1===s.length?t=s[0]:s.length&&(t=s),i.apply(null,[t].concat(__slice.call(f)))):void 0},p=function(){var e,t,i;for(i=[],e=0,t=n.length;t>e;e++)c=n[e],i.push(r.wrapPromise(o(c),a));return i}(),p.length<2?p[0]:e.all(p)},r.wrapPromise=function(e,r){var n,o;return o=function(e){var t,n,o,i,u;return n=e.data,i=e.status,o=e.headers,t=e.config,u=e,r(null,u)},n=function(e){var n,o,i,u,s,a;return o=e.data,s=e.status,u=e.headers,n=e.config,a=e,i=new t.type.Http(e),a.error=i,r(i,a)},e.then(o,n),e},r}()}]),ksc.service("ksc.util",["ksc.error",function(e){var t,r,n,o,i,u,s,a;return n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,r=function(t){return t.length?void 0:e.MissingArgument({name:"reference",argument:1})},t=function(){function t(){}return t.defineGetSet=function(e,t,r,o,i){return"function"!=typeof o&&(i=o,o=void 0),n(e,t,{configurable:!0,enumerable:!!i,get:r,set:o})},t.defineValue=function(e,t,r,o,u){var s;return(null!=(s=i(e,t))?s.writable:void 0)===!1&&n(e,t,{writable:!0}),n(e,t,{configurable:!0,enumerable:!!u,value:r,writable:!!o})},t.empty=function(){var t,r,n,o,i,u,s,c,l,p;for(i=1<=arguments.length?__slice.call(arguments,0):[],i.length||e.MissingArgument({argument:1}),a.apply(this,i)||e.Type({arguments:i,required:"All arguments must be objects"}),u=0,c=i.length;c>u;u++)if(o=i[u],Array.isArray(o))for(t=o.pop||(null!=(l=o._origFn)?l.pop:void 0)||Array.prototype.pop,r=s=0,p=o.length;p>s;r=s+=1)t.call(o);else for(n in o)__hasProp.call(o,n)&&delete o[n]},t.hasOwn=function(e,t,r){return e&&e.hasOwnProperty(t)&&(null==r||r===e.propertyIsEnumerable(t))},t.hasProperty=function(e,t){for(;e;){if(e.hasOwnProperty(t))return!0;e=u(e)}return!1},t.identical=function(e,r){var n,o;if(!a(e,r))return e===r;e._array&&(e=e._array),r._array&&(r=r._array);for(n in e)if(o=e[n],!t.identical(o,r[n])||!s(r,n))return!1;for(n in r)if(!s(e,n))return!1;return!0},t.isEnumerable=function(e,t){try{return!!i(e,t).enumerable}catch(r){}return!1},t.isKeyConform=function(t,r,n){var o;return"string"==typeof t&&t||"number"==typeof t&&!isNaN(t)?!0:(r&&("string"!=typeof r&&(r="Key conform value"),o={key:t,description:r},n?(o.argument=n,e.ArgumentType(o)):e.Key(o)),!1)},t.isFunction=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],"function"!=typeof e)return!1;return!0},t.isObject=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],!e||"object"!=typeof e)return!1;return!0},t.mergeIn=function(){var t,r,n,o,i,u,s,c;for(i=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],o.length<1&&e.MissingArgument({required:"Merged and mergee objects"}),a(i)||e.Type({target_object:i,argument:1,required:"object"}),t=s=0,c=o.length;c>s;t=++s){n=o[t],a(n)||e.Type({object:n,argument:t+2,required:"object"});for(r in n)u=n[r],i[r]=u}return i},t.propertyRefs=function(t){var r,n,o;for(o={};a(t);){r=!0;for(n in t)__hasProp.call(t,n)&&(Array.isArray(o[n])||(o[n]=[]),o[n].push(t));t=u(t)}return r||e.ArgumentType({object:t,argument:1,accepts:"object"}),o},t.uid=function(e){var r,n;return n=null!=t._uidStore?t._uidStore:t._uidStore={named:{}},null!=e?(t.isKeyConform(e,1),r=n.named):(r=n,e="unnamed"),r[e]=(r[e]||0)+1},t}(),o=t.defineValue,s=t.hasOwn,a=t.isObject,t}]);