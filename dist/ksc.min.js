var __hasProp={}.hasOwnProperty,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;ksc=angular.module("ksc",[]),ksc.factory("ksc.ArrayTracker",["ksc.error","ksc.util",function(e,t){var r,n,o,i,u,s,a,l,c;return n=t.defineGetSet,o=t.defineValue,i=t.hasOwn,u=Array.isArray,s=t.isObject,r=function(){function r(t,a){var c,p,f,d,y,h,g,_,m,v,b,k;for(null==a&&(a={}),i(t,"_tracker")&&e.Value({list:t,description:"List is already tracked"}),u(t)||e.ArgumentType({argument:1,list:t,description:"Must be an array"}),s(a)||e.ArgumentType({argument:2,options:a,description:"Must be an object"}),h=i(a,"store")?a.store:{},s(h)||e.Type({store:h,description:"Must be an object"}),g=this,o(t,"_tracker",g),o(g,"list",t,0,1),o(g,"store",h,0,1),o(g,"origFn",y={}),p=function(t){return null!=t?"function"!=typeof t&&e.Type({fn:t,"Must be a function":"Must be a function"}):t=null,t},f={},k=["del","get","set"],v=0,b=k.length;b>v;v++)d=k[v],f[d]=a[d]||null;_=function(e){return n(g,e,function(){return f[e]||null},function(t){return f[e]=p(t)},1)};for(d in f)c=f[d],f[d]=p(c),_(d);m=function(e){return o(t,e,function(){var t;return t=1<=arguments.length?__slice.call(arguments,0):[],r["_"+e].apply(g,t)})};for(d in r)c=r[d],"_"===d.substr(0,1)&&(d=d.substr(1),y[d]=i(t,d)?{v:t[d]}:{n:1},m(d));l(g)}return r.prototype.list=void 0,r.prototype.origFn=void 0,r.prototype.store=void 0,r.prototype.unload=function(e){var r,n,i,u,s,l,c;l=s=this,i=l.list,u=l.store,a(s),c=s.origFn;for(n in c)r=c[n],r.n?delete i[n]:o(i,n,r.v);delete s.list._tracker,delete s.list,e||t.empty(u)},r.add=function(e,t,n,o){var i,u,s,a,l,p,f,d,y,h;if(null==o&&(o=!0),s=e.list,l=e.store,u=t.length,a=s.length,o&&a>n)for(i=f=h=a-1;f>=n;i=f+=-1)c(e,i+u,l[i],"move");for(i=d=0,y=t.length;y>d;i=++d)p=t[i],c(e,i+n,p),o&&r.getterify(e,i+a);return s.length},r.getElement=function(e,t){return e.get?e.get(t,e.store[t]):e.store[t]},r.getterify=function(e,t){n(e.list,t,function(){return r.getElement(e,t)},function(r){return c(e,t,r)},1)},r.plainify=function(e){var t,r,n,o;n=e.list,o=e.store,t=function(){var e,t,i;for(i=[],r=e=0,t=n.length;t>e;r=e+=1)i.push(o[r]);return i}(),n.length=0,Array.prototype.push.apply(n,t)},r.process=function(e,t){var n,o,i,u,s;for(s=e.list,n=i=0,u=s.length;u>i;n=++i)o=s[n],r.getterify(e,n),c(e,n,o,t)},r.rm=function(e,t){var r,n,o,i,u,s,a,l,p;if(i=e.list,a=e.store,i.length){for(u=i.length,s=i[t],o=l=p=t+1;u>l;o=l+=1)c(e,o-1,a[o],"move");return(r=e.del)&&(n=a[u-1]),i.length=u-1,("function"==typeof r?r(u-1,n):void 0)!==!1&&delete a[u-1],s}},r.setElement=function(e,t,r,n){var o;o=function(){return arguments.length&&(r=arguments[0]),e.store[t]===r?!1:(e.store[t]=r,!0)},e.set?e.set(t,r,o,n||"external"):o()},r._pop=function(){return r.rm(this,this.list.length-1)},r._shift=function(){return r.rm(this,0)},r._push=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,this.list.length)},r._unshift=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],r.add(this,e,0)},r._splice=function(){var e,t,n,o,i,u,s,a,l,p,f,d,y,h,g,_,m,v,b,k;if(n=arguments[0],e=arguments[1],o=3<=arguments.length?__slice.call(arguments,2):[],_=f=this,u=_.list,p=_.store,i=o.length,a=u.length,n=parseInt(n,10)||0,n=0>n?Math.max(0,a+n):Math.min(n,a),e=parseInt(e,10)||0,e=Math.max(0,Math.min(e,a-n)),l=u.slice(n,n+e),s=function(t){return c(f,t-e+i,p[t],"move")},e>i){for(t=d=m=n+e;a>d;t=d+=1)s(t);for(t=y=0,v=e-i;v>y;t=y+=1)r.rm(f,a-t-1)}else if(i>e)for(t=h=b=a-1,k=n+e;h>=k;t=h+=-1)s(t);if(i){for(t=g=e;i>g;t=g+=1)r.getterify(f,t+a);r.add(f,o,n,0)}return l},r._sort=function(e){var t,r;return r=this,a(r),t=Array.prototype.sort.call(r.list,e),l(r,"reload"),t},r._reverse=function(){var e,t;return t=this,a(t),e=Array.prototype.reverse.call(t.list),l(t,"reload"),e},r}(),a=r.plainify,l=r.process,c=r.setElement,r}]),ksc.service("ksc.batchLoaderRegistry",["ksc.error",function(e){var t;return new(t=function(){function t(){}return t.prototype.map={},t.prototype.get=function(e,t){var r,n,o,i;i=this.map;for(r in i)if(n=i[r],o=n.get(e,t))return o;return!1},t.prototype.register=function(t){var r;return"string"==typeof(r=null!=t?t.endpoint:void 0)&&r||e.Value({endpoint:r,required:"url"}),this.map[r]&&e.Value({endpoint:r,description:"already registered"}),this.map[r]=t},t.prototype.unregister=function(e){return this.map[e.endpoint]?delete this.map[e.endpoint]:!1},t}())}]),ksc.factory("ksc.BatchLoader",["$http","$q","ksc.batchLoaderRegistry","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s;return u=n.ArgumentType,s=o.isObject,i=function(){function i(e,t){var i,a,l,c,p;this.endpoint=e,this.map=t,a=this,e&&"string"==typeof e||u({endpoint:e,required:"string"}),s(t)||u({map:t,required:"object"});for(i in t)p=t[i],"string"==typeof p&&i||n.Type({key:i,url:p,required:"url string"});l=!0,c=function(e){return l&&!e&&a.flush(),l=!!e},o.defineGetSet(a,"open",function(){return l},c,1),o.defineValue(a,"requests",[],0,1),r.register(a)}return i.prototype.endpoint=null,i.prototype.map=null,i.prototype.open=!0,i.prototype.requests=null,i.prototype.get=function(e,r){var n,o,i,a,l,c,p;if(i=this,l=i.requests,e&&"string"==typeof e||u({url:e,required:"string"}),null==r||s(r)||u({query_parameters:r,required:"object"}),!i.open)return!1;p=i.map;for(o in p)if(c=p[o],e===c){a=o;break}return a?(n=t.defer(),l.push({resource:a,deferred:n}),r&&(l[l.length-1].query=r),n.promise):!1},i.prototype.flush=function(){var t,r,n,o,i,u,s;for(n=this,i=n.requests,r=[],u=0,s=i.length;s>u;u++)o=i[u],o.deferred&&(r.push(o.deferred),delete o.deferred);return r.length?(t=e.put(n.endpoint,i),t.success(function(e,t,n,o){var i,u,s,a,l,c,p;for(u=l=0,c=r.length;c>l;u=++l)i=r[u],null!=(a=e[u])?(s={data:a.body,status:a.status,headers:n,config:o},200<=(p=a.status)&&400>p?i.resolve(s):i.reject(s)):i.reject({data:e,status:t,headers:n,config:o})}),t.error(function(e,t,n,o){var i,u,s;for(u=0,s=r.length;s>u;u++)i=r[u],i.reject({data:e,status:t,headers:n,config:o})})):!1},i}()}]),ksc.factory("ksc.EditableRecord",["ksc.Record","ksc.error","ksc.util",function(e,t,r){var n,o,i,u,s,a,l,c,p,f,d,y,h,g,_,m;return l="_array",p="_changes",c="_changedKeys",f="_deletedKeys",d="_edited",y="_events",h="_options",g="_parent",_="_parentKey",m="_saved",o=r.defineValue,i=r.hasOwn,u=Array.isArray,s=r.isEnumerable,a=r.isObject,n=function(n){function v(e,r,n,i){var u;null==e&&(e={}),null==r&&(r={}),a(r)||t.ArgumentType({options:r,argument:2,required:"object"}),r.subtreeClass=v,u=this,o(u,d,{}),o(u,p,0),o(u,c,{}),o(u,f,{}),o(u,m,{}),v.__super__.constructor.call(this,e,r,n,i)}return __extends(v,n),v.prototype._changedKeys=null,v.prototype._changes=0,v.prototype._deletedKeys=null,v.prototype._edited=null,v.prototype._clone=function(t,r,n){var o,i,u,s,a;if(u=this,o=v.__super__._clone.call(this,t,r),!n){a=u[d];for(i in a)s=a[i],(null!=s?s._clone:void 0)&&(s=s._clone(t,r)),t?o[i]=s:o._setProperty(i,s);for(i in u[f])t?delete o[i]:o._delete(i)}return t||r||e.getAllStatic(u,o),o},v.prototype._delete=function(){var n,a,l,y,g,_,v,b,k;for(_=1<=arguments.length?__slice.call(arguments,0):[],_.length||t.MissingArgument({name:"key",argument:1}),v=this,n=[],l=b=0,k=_.length;k>b;l=++b)if(g=_[l],r.isKeyConform(g,1,l),!l&&(a=v[h].contract)&&t.ContractBreak({key:g,value:value,contract:a[g]}),((y=v._idProperty)===g||u(y)&&__indexOf.call(y,g)>=0)&&t.Permission({key:g,description:"idProperty keys can not be deleted"}),i(v[m],g)){if(v[f][g])continue;v[f][g]=!0,v[c][g]||(o(v,p,v[p]+1),o(v[c],g,!0,0,1)),delete v[d][g],Object.defineProperty(v,g,{enumerable:!1}),n.push(g)}else i(v,g)&&(s(v,g)||t.Key({key:g,description:"can not be changed"}),delete v[g],v[d][g]&&(delete v[d][g],o(v,p,v[p]-1),delete v[c][g]),n.push(g));return n.length&&e.emitUpdate(v,"delete",{keys:n}),!!n.length},v.prototype._getProperty=function(t){var r,n;return r=this,n=v.__super__._getProperty.apply(this,arguments),r[f][t]?void 0:i(r[d],t)?e.arrayFilter(r[d][t]):n},v.prototype._replace=function(t){var r,n,o,i;i=this,(o=i[y])&&o.halt();try{n=i._revert(0),r=v.__super__._replace.call(this,t,0)}finally{o&&o.unhalt()}return o&&(n||r)&&e.emitUpdate(i,"replace"),n||r},v.prototype._revert=function(t){var r,n,i;null==t&&(t=!0),r=!1,i=this;for(n in i[f])delete i[f][n],delete i[c][n],r=!0;for(n in i[d])delete i[d][n],delete i[c][n],r=!0;return r&&(o(i,p,0),t&&e.emitUpdate(i,"revert")),r},v.prototype._setProperty=function(n,y,b){var k,P,M,A,O,j,w,q,S,x,C,R,T,$,V,L,K,I,E,U,N,B,F;if(b)return v.__super__._setProperty.apply(this,arguments);if(x=this,R=x[m],O=x[d],M=x[h].contract,e.valueCheck(x,n,y),((w=x._idProperty)===n||u(w)&&__indexOf.call(w,n)>=0)&&null!==y&&"string"!=(E=typeof y)&&"number"!==E&&t.Value({value:y,required:"string or number or null"}),y=e.valueWrap(x,n,y),r.identical(R[n],y))delete O[n],P=1;else if(!r.identical(O[n],y)){if(null!=M&&M._match(n,y),C=y,A=function(){var e;for(e in C)s(C,e)&&!i(y,e)&&C._delete(e)},k=null!=y?y[l]:void 0){if(a(R[n]))if(C=R[n],T=C[l]){for(j=L=U=k.length,N=T.length;N>L;j=L+=1)T.pop();for(B=k.slice(0,T.length),j=K=0,I=B.length;I>K;j=++K)q=B[j],T[j]=q;T.push.apply(T,k.slice(T.length))}else A(),e.arrayify(C),(F=C[l]).push.apply(F,k)}else if(a(y)&&a(R[n])){C=R[n],C[l]&&e.dearrayify(C),A();for(S in y)$=y[S],C._setProperty(S,$)}O[n]=C,P=1}return x[f][n]&&(delete x[f][n],P=1),O[n]===R[n]&&delete O[n],V=x[c][n],a(R[n])&&R[n]._changes||i(O,n)&&!r.identical(R[n],O[n])?V||(o(x,p,x[p]+1),o(x[c],n,!0,0,1)):V&&(o(x,p,x[p]-1),delete x[c][n]),e.getterify(x,n),P&&(x[_]&&v.subChanges(x[g],x[_],x[p]),Object.defineProperty(x,n,{enumerable:!0}),e.emitUpdate(x,"set",{key:n})),!!P},v.subChanges=function(e,t,r){var n;e[c][t]?r||(o(e,p,e[p]-1),delete e[c][t],n=!0):r&&(o(e,p,e[p]+1),o(e[c],t,!0,0,1),n=!0),n&&e[_]&&v.subChanges(e[g],e[_],e[p])},v}(e)}]),ksc.factory("ksc.EditableRestRecord",["$http","ksc.EditableRecord","ksc.Mixin","ksc.RestRecord",function(e,t,r,n){var o;return o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),r.extend(o,n),o.prototype._restSave=function(t){var r;return r=o.getUrl(this),o.async(this,e.put(r,this._entity()),t)},o}(t)}]),ksc.service("ksc.error",function(){var e,t,r,n,o,i,u,s,a,l,c,p,f,d;r=function(e){function t(e){var t,r,n;if(r="",e&&"object"==typeof e)for(t in e){n=e[t];try{n=JSON.stringify(n,null,2)}catch(o){n=String(n)}r+="\n  "+t+": "+n}else null!=e&&(r+=String(e));this.message=r}return __extends(t,e),t}(Error),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(r),n=function(){function r(){}return r.ArgumentType=e,r.ContractBreak=t,r.Http=o,r.Key=i,r.MissingArgument=u,r.Permission=s,r.Type=a,r.Value=l,r}(),p={type:n},d=function(e){return p[f]=function(t){throw new e(t)}};for(f in n)c=n[f],c.prototype.name=f+"Error",d(c);return p}),ksc.factory("ksc.EventEmitter",["$interval","$rootScope","$timeout","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s,a,l,c,p,f;return s="__unsubscriber__",a=n.ArgumentType,l=o.isFunction,c=o.isObject,u=function(){function e(){}return e.prototype.names=null,e.prototype.emit=function(){var e,t,r,n,o,i,u,s,a,c,p,f;for(i=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],u=null!=this.names?this.names:this.names={},t=null!=u[i]?u[i]:u[i]={},n=!1,t.fired=(t.fired||0)+1,t.lastArgs=e,p=[0,1],a=0,c=p.length;c>a;a++)if(s=p[a],t[s]){f=t[s];for(o in f)r=f[o],l(r)&&(n=!0,s&&delete t[s][o],r.apply(null,e))}return n},e.prototype.instantCall=function(e,t){var r,n;return r=null!=this.names?this.names:this.names={},(null!=(n=r[e])?n.fired:void 0)?(t.apply(null,r[e].lastArgs),!0):!1},e.prototype.push=function(e,t,r){var n,o,u,a,l,c,p,f,d,y;for(c=null!=this.names?this.names:this.names={},u=[],t=t?1:0,d=0,y=e.length;y>d;d++)a=e[d],null==c[a]&&(c[a]={}),n=null!=(f=c[a])[t]?f[t]:f[t]={i:0},n[n.i]=r,u.push({name:a,id:n.i}),n.i+=1;return p=!1,o=i.prototype.unsubscriber(),l=function(){var e,r,n;if(p)return!1;for(p=!0,r=0,n=u.length;n>r;r++)e=u[r],delete c[e.name][t][e.id];return!0},l[s]=!0,o.add(l),o},e}(),p=function(e){return"string"!=typeof e&&a({name:e,argument:1,required:"string"}),e?void 0:n.Value({name:e,description:"must be a non-empty string"})},f=function(e,r,n,o){var i,f,d,y,h;for(null==this.subscriptions&&(this.subscriptions=new u),l(n)||a({callback:n,argument:"last",required:"function"}),(null!=r?r[s]:void 0)||c(r)&&(f=t.isPrototypeOf(r))||(e.push(r),r=null),y=0,h=e.length;h>y;y++)i=e[y],p(i);return d=o.call(this),r?(f?r.$on("$destroy",d):r.add(d),!0):d},i=function(){function n(){this.on=__bind(this.on,this),this.on1=__bind(this.on1,this),this["if"]=__bind(this["if"],this),this.if1=__bind(this.if1,this)}return n.prototype.emit=function(){var e,t,r;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],p(t),this._halt&&(t=this._halt+"#!"+t),(r=null!=this.subscriptions?this.subscriptions:this.subscriptions=new u).emit.apply(r,[t].concat(__slice.call(e)))},n.prototype.emitted=function(e){var t,r,n;return p(e),(null!=(r=t=null!=(n=this.subscriptions)?n.names[e]:void 0)?r.fired:void 0)?t.lastArgs:!1},n.prototype.halt=function(){return this._halt=(this._halt||0)+1},n.prototype.unhalt=function(){return this._halt-=1},n.prototype.if1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o,i;for(n=[],o=0,i=t.length;i>o;o++)r=t[o],this.subscriptions.instantCall(r,e)||n.push(r);return this.subscriptions.push(n,1,e)})},n.prototype["if"]=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){var r,n,o;for(n=0,o=t.length;o>n;n++)r=t[n],this.subscriptions.instantCall(r,e);return this.subscriptions.push(t,0,e)})},n.prototype.on1=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,1,e)})},n.prototype.on=function(){var e,t,r,n;return t=3<=arguments.length?__slice.call(arguments,0,n=arguments.length-2):(n=0,[]),r=arguments[n++],e=arguments[n++],f.call(this,t,r,e,function(){return this.subscriptions.push(t,0,e)})},n.prototype.unsubscriber=function(n){var o,i,u;return o={},u=0,i=function(){var t,n,i;i=null;for(t in o)n=o[t],l(n)?n()||(i=!1):null!=n.$$intervalId?e.cancel(n):r.cancel(n);return i},null!=n&&(t.isPrototypeOf(n)||a({scope:n,required:"$rootScope descendant"}),n.$on("$destroy",i)),i[s]=!0,i.add=function(e){return function(t){var r,n;return r=function(){return delete o[t]},n=function(){return a({unsubscriber:e,argument:1,required:["function","Promise"]})},c(e)?null!=e.$$timeoutId&&null!=e["finally"]?e["finally"](r):null!=e.$$intervalId&&null!=e["finally"]?e["finally"](r):n():l(e)&&e[s]||n(),o[t]=e}(u),u+=1,!0},i},n}()}]),ksc.factory("ksc.ListMapper",["ksc.util",function(e){var t,r,n;return n=e.defineValue,r=function(e,t){var r,n,o;if(t)for(n=0,o=t.length;o>n;n++)r=t[n],e=e[r];return e},t=function(){function t(e){var t,r,o,i,u;this.parent=e,i=this,u=e.source,n(i,"multi",u&&!u._,0,1),n(i,"_sources",[],0,1),r=function(e){var t,n,o;if(e.source){o=e.source;for(t in o)if(n=o[t],r(n))return!0;return!1}return null!=e.idProperty},(o=r(e))&&(n(i,"idMap",{},0,1),n(i,"pseudoMap",{},0,1)),t=function(e,n,u,s){var a,l,c,p,f,d;if(null==n&&(n={}),null==u&&(u={}),p=e.source){if(p._)return t(p._,n,u,s);d=[];for(c in p)l=p[c],o&&r(e)&&(n[c]={},u[c]={}),f=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)a=s[e],r.push(a);return r}(),f.push(c),d.push(t(l,n[c],u[c],f));return d}return i._sources.push({names:s,source:e})},t(e,i.idMap,i.pseudoMap,[]),Object.freeze(i._sources)}return t.prototype.idMap=null,t.prototype.multi=null,t.prototype.parent=null,t.prototype.pseudoMap=null,t.prototype.add=function(e,t){var n,o,i;return o=this,null!=e._id?(n=e._id,i=o.idMap):(n=e._pseudo,i=o.pseudoMap),i=r(i,t),i[n]=e},t.prototype.del=function(t,n,o){var i,u;i=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(u=i.pseudoMap,t=n):u=i.idMap,u=r(u,o),delete u[t]},t.prototype.has=function(t,n,o){var i,u,s;return u=this,e.isObject(t)&&(n=t._pseudo,t=t._id),null!=n?(i=n,s=u.parent.pseudoMap):(i=t,s=u.parent.idMap),s=r(s,o),s[i]||!1},t.register=function(e){var r;r=new t(e),n(e,"_mapper",r),r.idMap&&(n(e,"idMap",r.idMap),n(e,"pseudoMap",r.pseudoMap))},t}()}]),ksc.factory("ksc.ListMask",["$rootScope","ksc.EventEmitter","ksc.List","ksc.ListMapper","ksc.ListSorter","ksc.error","ksc.util",function(e,t,r,n,o,i,u){var s,a,l,c,p,f,d,y,h,g,_,m,v;return a="_scopeUnsubscriber",c=i.ArgumentType,d=u.defineGetSet,y=u.defineValue,h=u.isObject,p=Array.prototype.push,l=function(e,t){var r,n,o,i,u;if(o=v(e,t),e.sorter)for(i=0,u=o.length;u>i;i++)r=o[i],n=e.sorter.position(r),Array.prototype.splice.call(e,n,0,r);else p.apply(e,o)},f=function(e,t){var r,n,o;for(o=[];r=Array.prototype.pop.call(e);)n=r._original||r,__indexOf.call(t,n)<0&&o.push(r);o.length&&(o.reverse(),p.apply(e,o))},g=function(e){var t,r,n,o,i,s,a,l;for(u.empty(e),a=e._mapper._sources,n=0,i=a.length;i>n;n++)for(r=a[n],l=r.source,o=0,s=l.length;s>o;o++)t=l[o],e.filter(t)&&p.apply(e,v(e,t))},_=function(e){var t,r,n,o;t=function(){return!0},(r=e.options.filter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&i.Type({filter_function:n,required:"function"}),r=n,e.update()},d(e,"filter",n,o,1),d(e.options,"filter",n,o,1)},m=function(e){var t,r,n,o;t=function(){return!1},(r=e.options.splitter)||(r=t),n=function(){return r},o=function(n){return n||(n=t),"function"!=typeof n&&i.Type({splitter_function:n,required:"function"}),r=n,e.update()},d(e,"splitter",n,o,1),d(e.options,"splitter",n,o,1)},v=function(e,t){var r,n,o,u,s,a,l,c,p;if((s=e.splitter(t))&&s instanceof Array){for(u=[],c=0,p=s.length;p>c;c++){r=s[c],h(r)||i.Type({splitter:e.splitter,description:"If Array is returned, all elements must be objects with override data"}),o=Object.create(t),l=function(e,t){var r,n;return r=function(){return t[e]},n=function(r){return t[e]=r},d(o,e,r,n,1)};for(n in t)l(n,t);for(n in r)a=r[n],y(o,n,a,0,1);y(o,"_original",t),u.push(o)}return u}return[t]},s=function(){function u(r,s,p,f){var d,g,v,b,k,P,M,A,O,j,w,q,S,x,C,R,T,$,V,L,K,I,E,U;(r instanceof Array||"object"!=typeof r)&&(r={_:r}),k=0;for(A in r)M=r[A],M instanceof Array&&M.options&&M.events instanceof t||c({source:M,name:A,required:"List"}),k+=1,y(r,A,M,0,1);Object.freeze(r),r._&&k>1&&c({source:r,conflict:'Can not have unnamed ("_") and named sources mixed'}),h(s)&&(f=p,p=s,s=null),null==p&&(p={}),h(p)||c({options:p,argument:3,required:"object"}),e.isPrototypeOf(p)&&(f=p,p={}),null!=f&&(e.isPrototypeOf(f)||c({scope:f,required:"$rootScope descendant"})),s&&(p.filter=s),v=[],K=this.constructor.prototype;for(g in K)w=K[g],y(v,g,w);for(I=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],S=0,T=I.length;T>S;S++)g=I[S],v[g]&&y(v,g);for(y(v,"events",new t),y(v,"options",p),y(v,"source",r),_(v),m(v),n.register(v),O=v._mapper._sources,f&&y(v,a,f.$on("$destroy",function(){return delete v[a],v.destroy()})),j=null,d=[],q=function(e){var t;return t=e.source.events.on("update",function(t){return u.update.call(v,t,e.names)}),j?j.add(t):j=t,j.add(e.source.events.on("destroy",function(){return v.destroy()}))},x=0,$=O.length;$>x;x++)P=O[x],E=P.source,__indexOf.call(d,E)>=0&&i.Value({sources:O,conflict:"Source can not be referenced twice to keep list unique"}),d.push(P.source),q(P);for(y(v,"_sourceUnsubscriber",j),o.register(v,p.sorter),C=0,V=O.length;V>C;C++)for(P=O[C],U=P.source,R=0,L=U.length;L>R;R++)b=U[R],v.filter(b)&&(null!=b._parent.idProperty&&v._mapper.add(b,P.names),l(v,b));return v}return u.prototype._mapper=void 0,u.prototype.events=void 0,u.prototype.filter=void 0,u.prototype.idMap=void 0,u.prototype.options=void 0,u.prototype.pseudoMap=void 0,u.prototype.sorter=void 0,u.prototype.source=void 0,u.prototype.splitter=void 0,u.prototype.destroy=r.prototype.destroy,u.prototype.update=function(){var e,t,r,n,o,i,u,s,a,c,p,d,y,h;for(e={},r=this,o=r._mapper,y=o._sources,a=0,p=y.length;p>a;a++)for(u=y[a],s=u.names,h=u.source,c=0,d=h.length;d>c;c++)i=h[c],t=(n=i._parent.idProperty)?o.has(i,null,s):__indexOf.call(r,i)>=0,r.filter(i)?t||(n&&o.add(i,s),l(r,i),(null!=e.add?e.add:e.add=[]).push(i)):t&&(n&&o.del(i,null,s),(null!=e.cut?e.cut:e.cut=[]).push(i));return e.cut&&f(r,e.cut),g(r),(e.add||e.cut)&&r.events.emit("update",{node:r,action:e}),e},u.update=function(e,t){var r,n,o,i,u,s,a,c,p,d,y,h,_,m,v,b,k,P,M,A,O,j,w,q,S,x,C,R,T,$,V,L,K;if(r=null,o=[],y=this,c=e.action,h=y._mapper,n=function(e,t){var n;return(null!=(n=null!=r?r:r={})[e]?n[e]:n[e]=[]).push(t)},p=function(e,r,n){return n._parent.idProperty?[1,h.has(e,r,t)]:[0,__indexOf.call(y,n)>=0]},i=function(e,r,i){var u,s,a;a=p(e,r,i),u=a[0],s=a[1],s&&(n("cut",i),o.push(i),u&&h.del(e,r,t))},s=function(e,r,n){var o,i,u;return u=p(e,r,n),o=u[0],i=u[1],o&&!i&&h.add(n,t),i},u=function(e,r){var n,o,i;return i=p(e,r,v),n=i[0],o=i[1],n&&o&&h.del(e,r,t),o},c.cut)for(T=c.cut,w=0,x=T.length;x>w;w++)v=T[w],i(v._id,v._pseudo,v);if(c.add)for($=c.add,q=0,C=$.length;C>q;q++)v=$[q],y.filter(v)&&(s(v._id,v._pseudo,v),l(y,v),n("add",v));if(c.update)for(V=c.update,S=0,R=V.length;R>S;S++)if(e=V[S],L=e,v=L.record,e=L.info,_=L.merge,m=L.move,k=L.source,a=A=null,(b=_||m)&&(a=b.from,A=b.to),y.filter(v))if(P=a&&u(a.idMap,a.pseudoMap),M=A?s(A.idMap,A.pseudoMap,v):s(v._id,v._pseudo,v),P&&M)n("update",{record:v,info:e,merge:b,source:k}),o.push(k);else if(P)n("update",{record:v,info:e,move:b});else if(M){O={record:v},K={info:e,source:k};for(d in K)j=K[d],null!=j&&(O[d]=j);n("update",O)}else l(y,v),n("add",v);else _?(i(a.idMap,a.pseudoMap,k),i(A.idMap,A.pseudoMap,v)):m?i(a.idMap,a.pseudoMap,v):i(v._id,v._pseudo,v);y.sorter?o.length&&f(y,o):g(y),r&&y.events.emit("update",{node:y,action:r})},u}()}]),ksc.factory("ksc.ListSorter",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=t.defineValue,o=t.isKeyConform,r=function(){function r(i,u){var s,a,l;a=this,n(a,"list",i),"function"==typeof u?a.fn=u:((o(u)||u instanceof Array)&&(u={key:u}),t.isObject(u)&&(o(s=u.key)||s instanceof Array)||e.Value({sorter:u,requirement:"function or string or array or object: {key: <string|array>, reverse: <bool>, type: 'natural|number|byte'}"}),(l=u.type)?"byte"!==l&&"natural"!==l&&"number"!==l&&e.Value({type:l,required:"byte, natural or number"}):l="natural",n(a,"key",s,0,1),n(a,"reverse",!!u.reverse,0,1),n(a,"type",l,0,1),n(a,"fn",r.getSortFn(a),0,1)),Object.preventExtensions(a)}return r.prototype.fn=null,r.prototype.key=null,r.prototype.list=null,r.prototype.reverse=null,r.prototype.type=null,r.prototype.position=function(t){var r,n,o,i,u,s,a,l;return l=this,n=l.fn,u=l.list,(i=u.length)?(a=0,s=i-1,r=function(t){return("number"!=typeof t||isNaN(t))&&e.Type({sort_fn_output:t,required:"number"}),t},r(n(t,u[a]))<0?a:1===i?1:r(n(t,u[s]))>=0?s+1:(o=function(e,i){var s;return i-1>e?(s=Math.floor((i-e)/2+e),r(n(t,u[s]))<0?o(e,s):o(s,i)):i})(a,s)):0},r.getSortFn=function(e){var t,r,n,i,u,s;return r=e.key,u=e.reverse,s=e.type,u=u?-1:1,t=function(e,t){var r;return function(){var n,o,i;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],null!=e[r]&&i.push(e[r]);return i}().join(" ")},i=function(e){return"number"!=typeof e?"string"==typeof e&&""!==e?Number(e):0/0:e},n=function(e,t){var r,n,o,i,u,s,a,l;if(e=String(e).toLowerCase(),t=String(t).toLowerCase(),s=0,l=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g,e===t)return 0;for(n=e.toLowerCase().match(l),i=t.toLowerCase().match(l),r=null!=n?n.length:0;r>s;)return null==i||void 0===i[s]?1:(o=n[s],u=i[s],s+=1,a=o-u,isNaN(a)?o>=u?1:-1:a);return-1},function(e,a){var l,c;if(o(r)?(e=e[r],a=a[r]):(e=t(e,r),a=t(a,r)),"number"===s){if(l=e,c=a,e=i(e),a=i(a),isNaN(e))return isNaN(a)?n(l,c)*u:-1*u;if(isNaN(a))return 1*u}else null==e&&(e=""),null==a&&(a="");return"natural"===s?n(e,a)*u:("byte"===s&&(e=String(e),a=String(a)),e===a?0:(e>a?1:-1)*u)}},r.register=function(e,n){var o,i,u;u=null,n&&(u=new r(e,n)),o=function(){return u},i=function(t){return t?(u=new r(e,t),Array.prototype.sort.call(e,u.fn),e.events.emit("update",{node:e,action:{sort:!0}})):u=null},t.defineGetSet(e,"sorter",o,i),t.defineGetSet(e.options,"sorter",o,i,1)},r}()}]),ksc.factory("ksc.List",["$rootScope","ksc.EditableRecord","ksc.EventEmitter","ksc.ListMapper","ksc.ListSorter","ksc.Record","ksc.error","ksc.util",function(e,t,r,n,o,i,u,s){var a,l,c,p,f,d,y,h;return l="_scopeUnsubscriber",c=u.ArgumentType,p=s.defineValue,y=s.isObject,h=function(e,t){return"boolean"!=typeof t&&(e.push(t),t=!1),t},f=function(e,t){return e.events.emit("update",{node:e,action:t})},d=function(e,t,r){var n;(n=Array.prototype.splice).call.apply(n,[e,t,0].concat(__slice.call(r)))},a=function(){function a(){var t,a,f,d,h,g,_,m,v,b,k,P;_=[],h=m=f=v=void 0;for(a in arguments)t=arguments[a],Array.isArray(t)?(h&&c({argument:t,number:a,description:"Ambiguous: can only take 1 array"}),h=t):y(t)?e.isPrototypeOf(t)?(v&&c({argument:t,number:a,description:"Ambiguous: can only take 1 scope"}),v=t):(m&&c({argument:t,number:a,description:"Ambiguous: can only take 1 object for options"}),m=t):s.isKeyConform(t)?(null!=f&&c({argument:t,number:a,description:"Ambiguous: can only take 1 id_property"}),f=t):c({argument:t,number:a,description:"Unknown type for a List argument"});null!=(null!=m&&null!=(k=m.record)?k.idProperty:void 0)&&f&&c({argument:f,options:m,description:"id_property argument conflicts with .options.record.idProperty"}),P=this.constructor.prototype;for(g in P)b=P[g],"constructor"!==g&&p(_,g,b);return m=angular.copy(m)||{},p(_,"options",m),null==m.record&&(m.record={}),i.checkIdProperty(null!=f?f:f=m.record.idProperty),d=function(){return u.Permission({description:"idProperty can not be changed run-time"})},s.defineGetSet(_,"idProperty",function(){return f},d),s.defineGetSet(m.record,"idProperty",function(){return f},d,1),p(_,"_sourceType","List"),p(_,"events",new r),null!=f&&n.register(_),v&&p(_,l,v.$on("$destroy",function(){return delete _[l],_.destroy()})),o.register(_,m.sorter),h&&_.push.apply(_,h),_}return a.prototype._mapper=void 0,a.prototype.events=void 0,a.prototype.idMap=void 0,a.prototype.idProperty=void 0,a.prototype.pseudoMap=void 0,a.prototype.options=void 0,a.prototype.sorter=void 0,a.prototype.destroy=function(){var e;return e=this,Object.isFrozen(e)?!1:(e.events.emit("destroy"),"function"==typeof e[l]&&e[l](),"function"==typeof e._sourceUnsubscriber&&e._sourceUnsubscriber(),s.empty(e),delete e.options,delete e._sourceUnsubscriber,Object.freeze(e),!0)},a.prototype.cut=function(){var e,t,r,n,o,i,s,a,l,c,p,h;for(a=1<=arguments.length?__slice.call(arguments,0):[],a.length||u.MissingArgument({name:"record",argument:1}),t=[],o=this,i=o._mapper,l=[],p=0,h=a.length;h>p;p++)s=a[p],y(s)?(__indexOf.call(o,s)<0&&u.Value({record:s,description:"not found in list"}),i&&(i.has(s)||u.Key({record:s,description:"idMap/pseudoMap id error"}),i.del(s)),t.push(s)):(r=s,(s=i.has(r))||u.Key({id:r,description:"map id error"}),i.del(r),t.push(s._id!==r?r:s)),l.push(s);for(c=[];n=Array.prototype.pop.call(o);)__indexOf.call(l,n)<0&&c.push(n);return c.length&&(c.reverse(),d(o,o.length,c)),e={cut:t},f(o,e),e},a.prototype.empty=function(e){var t,r,n,o,i;n=this,t={cut:[]},n.events.halt();try{for(r=o=0,i=n.length;i>o;r=o+=1)t.cut.push(n.shift())}finally{n.events.unhalt()}return t.cut.length&&f(n,t),e?t:this},a.prototype.pop=function(){return a.remove(this,"pop")},a.prototype.push=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,r.length),n?e:r.length},a.prototype.shift=function(){return a.remove(this,"shift")},a.prototype.unshift=function(){var e,t,r,n,o;return t=2<=arguments.length?__slice.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],n=h(t,n),r=this,e=a.add(r,t,0),n?e:r.length},a.prototype.splice=function(){var e,t,r,n,o,i,u,l,p;i=arguments[0],t=arguments[1],r=4<=arguments.length?__slice.call(arguments,2,p=arguments.length-1):(p=2,[]),l=arguments[p++],l=h(r,l),"undefined"==typeof r[0]&&1===r.length&&r.pop(),"boolean"!=typeof t||r.length||(l=t,t=null),u=function(e,t){return"number"==typeof e&&(e>0||0===e)&&e===Math.floor(e)?void 0:c({value:e,argument:t,required:"int >= 0"})},e={},o=this,n=o.length,0>i&&(i=Math.max(n+i,0)),u(i),i=Math.min(n,i),null!=t?(u(t),t=Math.min(n-i,t)):t=n-i,o.events.halt();try{t>0&&(e=o.cut.apply(o,o.slice(i,i+t))),r.length&&s.mergeIn(e,a.add(o,r,i))}finally{o.events.unhalt()}return(e.cut||e.add||e.update)&&f(o,e),l?e:e.cut||[]},a.prototype.reverse=function(){var e;return e=this,e.sorter&&u.Permission("can not reverse an auto-sorted list"),e.length>1&&(Array.prototype.reverse.call(e),f(e,{reverse:!0})),e},a.prototype.sort=function(e){var t,r,n,o,i,s;if(n=this,n.sorter&&u.Permission("can not reverse an auto-sorted list"),n.length>1)for(t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o);return r}(),null==e&&(e=function(e,t){return null===e._id&&null===t._id?e._pseudo-t._pseudo:null===e._id?-1:null===t._id?1:e._id>t._id?1:-1}),Array.prototype.sort.call(n,e),r=i=0,s=n.length;s>i;r=++i)if(o=n[r],o!==t[r]){f(n,{sort:!0});break}return n},a.prototype._recordChange=function(e,t,r){var n,o,a,l,c,y,h,g,_,m;if(e instanceof i||u.Type({record:e,required:"Record"}),l=this,n=function(){return p(e,"_pseudo",null),y.add(e)},o={record:e,info:t},(c=l.idMap)&&(y=l._mapper,r!==e._id)){l.events.halt();try{null==e._id?(y.del(r),p(e,"_pseudo",s.uid("record.pseudoMap")),y.add(e),o.move={from:{idMap:r},to:{pseudoMap:e._pseudo}}):null==r?c[e._id]?(o.merge={from:{pseudoMap:e._pseudo},to:{idMap:e._id}},o.record=c[e._id],o.source=e,l.cut(e),l.push(e)):(o.move={from:{pseudoMap:e._pseudo},to:{idMap:e._id}},y.del(null,e._pseudo),n()):c[e._id]?(o.merge={from:{idMap:r},to:{idMap:e._id}},o.record=c[e._id],o.source=e,l.cut(r),l.push(e)):(o.move={from:{idMap:r},to:{idMap:e._id}},y.del(r),n())}finally{l.events.unhalt()}}if(l.sorter)for(e=o.record,g=_=0,m=l.length;m>_;g=++_)if(a=l[g],a===e){Array.prototype.splice.call(l,g,1),h=l.sorter.position(e),d(l,h,[e]);break}return f(l,{update:[o]})},a.add=function(e,r,n){var o,a,l,c,y,h,g,_,m,v,b,k;r.length||u.MissingArgument({name:"item",argument:1}),o={},c=e._mapper,e.events.halt();try{for(_=[],g=e.options.record,h=g["class"]||t,m=0,b=r.length;b>m;m++)l=r[m],y=l,l instanceof i?(l._parent&&l._parent!==e&&l._parent.cut(l),s.mergeIn(l._options,g),p(l,"_parent",e)):l=new h(l,g,e),l._idProperty!==e.idProperty&&u.Value({"list.idProperty":e.idProperty,"record._idProperty":record._idProperty,description:"record._idProperty conflicts with list.idProperty"}),i.setId(l),null!=l._id?((a=c.has(l._id))?(a._replace(l._clone(1)),(null!=o.update?o.update:o.update=[]).push({record:a,source:y})):(c.add(l),_.push(l),(null!=o.add?o.add:o.add=[]).push(l)),l._pseudo&&p(l,"_pseudo",null)):(c&&(p(l,"_pseudo",s.uid("record.pseudoMap")),c.add(l)),_.push(l),(null!=o.add?o.add:o.add=[]).push(l));
if(_.length)if(e.sorter)for(v=0,k=_.length;k>v;v++)l=_[v],n=e.sorter.position(l),d(e,n,[l]);else d(e,n,_)}finally{e.events.unhalt()}return f(e,o),o},a.remove=function(e,t){var r,n;return(r=Array.prototype[t].call(e))&&(null!=(n=e._mapper)&&n.del(r),f(e,{cut:[r]})),r},a}()}]),ksc.factory("ksc.Mixin",["ksc.error","ksc.util",function(e,t){var r,n,o;return n=function(e,r,n){var o,i,u;for(null!=e&&"boolean"!=typeof e&&(r.unshift(e),e=!0),i=0,u=r.length;u>i;i++)o=r[i],t.isKeyConform(o,1);return n(e,r)},o=function(e,r,n,o){var i;return t.hasProperty(e,r)?!1:null==n?!0:(i=__indexOf.call(o,r)>=0,n&&i||!n&&!i)},r=function(){function e(){}return e.extend=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendProto.apply(e,[r,n,t].concat(__slice.call(o))),e.extendInstance.apply(e,[r,n,t].concat(__slice.call(o)))},e.extendInstance=function(){var e,t,r,i;return t=arguments[0],r=arguments[1],e=arguments[2],i=4<=arguments.length?__slice.call(arguments,3):[],n(e,i,function(e,n){var i,u;for(i in r)u=r[i],o(t,i,e,n)&&(t[i]=u)})},e.extendProto=function(){var t,r,n,o;return r=arguments[0],n=arguments[1],t=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],e.extendInstance.apply(e,[r.prototype,n.prototype,t].concat(__slice.call(o)))},e}()}]),ksc.factory("ksc.RecordContract",["ksc.error","ksc.util",function(e,t){var r,n,o,i,u;return r="nullable",i=t.hasOwn,u=t.isObject,o=t.defineValue,n=function(){function t(n){var o,s,a,l,c,p,f,d,y,h;if(null===n||n instanceof t)return n;u(n)||e.Type({contract:n,required:"object"});for(c in n){for(s=n[c],"_"===c.substr(0,1)&&e.Key({key:c,description:'can not start with "_"'}),this[c]=s,s[r]?s[r]=!0:delete s[r],l=0,h=["array","contract","default"],d=0,y=h.length;y>d;d++)a=h[d],s[a]&&(l+=1,l>1&&e.Value({key:a,contract:s,description:"array, default, contract are mutually exclusive"}));f=s.type,!(o=s.array)&&"array"!==f||u(o)||e.Type({array:o,description:"array description required"}),(o=s.array)&&(i(s,"type")&&"array"!==f&&e.Type({type:type,array:o,requiredType:"array"}),delete s.type,f=null),!(p=s.contract)&&"object"!==f||u(p)||e.Type({contract:p,description:"contract description required"}),p&&(i(s,"type")&&"object"!==f&&e.Type({type:type,contract:p,requiredType:"object"}),delete s.type,f=null),o||(p?s.contract=new t(p):(i(s,"default")&&!i(s,"type")&&null!=t.typeDefaults[typeof s["default"]]&&(s.type=f=typeof s["default"]),null==t.typeDefaults[f]&&e.Type({type:f,required:"array, boolean, number, object, string"}))),this._match(c,this._default(c))}Object.freeze(this)}return t.prototype._default=function(n){var o,u,s;if(o=this[n],o||e.Key({key:n,description:"Key not found on contract"}),i(o,"default"))return o["default"];if(o[r])return null;if(o.array)return[];if(o.contract){u={},s=o.contract;for(n in s)__hasProp.call(s,n)&&(u[n]=o.contract._default(n));return u}return t.typeDefaults[o.type]},t.prototype._match=function(t,n){var o;return o=this[t],null!=o&&(o.array&&Array.isArray(n)||o.contract&&u(n)||typeof n===o.type||null===n&&o[r])?!0:e.ContractBreak({key:t,value:n,contract:o})},t.finalizeRecord=function(e){e._options.contract&&Object.isExtensible(e)&&(i(e,"$$hashKey")||o(e,"$$hashKey",void 0,1),Object.preventExtensions(e))},t.typeDefaults={"boolean":!1,number:0,string:""},t}()}]),ksc.factory("ksc.Record",["ksc.ArrayTracker","ksc.EventEmitter","ksc.RecordContract","ksc.error","ksc.util",function(e,t,r,n,o){var i,u,s,a,l,c,p,f,d,y,h,g,_,m,v,b,k,P;return y="_array",h="_events",g="_id",_="_options",m="_parent",v="_parentKey",b="_primaryId",k="_pseudo",P="_saved",i="contract",s=o.defineGetSet,a=o.defineValue,l=o.hasOwn,c=Array.isArray,p=o.isKeyConform,f=o.isObject,d=function(e,t,r){var o;return f(t)?void 0:(o={},o[e]=t,o.argument=r,o.required="object",n.ArgumentType(o))},u=function(){function u(e,c,y,M){var A,O,j,w,q,S,x,C,R,T,$,V,L,K,I;for(null==e&&(e={}),null==c&&(c={}),f(e)||n.Type({data:e,required:"object"}),d("data",e,1),d("options",c,2),S=this,a(S,_,c),a(S,P,{}),l(c,i)&&(A=c[i]=new r(c[i])),a(S,m,y),(null!=y||null!=M)&&(d("options",y,3),null!=M&&(p(M,1,4),a(S,v,M),delete S[g],delete S[b],delete S[k])),K=A?[S,A]:[S],T=0,V=K.length;V>T;T++){R=K[T],I=o.propertyRefs(Object.getPrototypeOf(R));for(q in I)for(C=I[q],$=0,L=C.length;L>$;$++)x=C[$],Object.defineProperty(x,q,{enumerable:!1})}O=c.idProperty,null==M&&(a(S,g),a(S,b),a(S,k),a(S,h,new t),u.checkIdProperty(O),j=function(){var e;return null!=O?O:null!=(e=S[m])?e.idProperty:void 0},w=function(e){u.checkIdProperty(e),u.setId(S)},s(S,"_idProperty",j,w),s(c,"idProperty",j,w,1),S[h].halt()),S._replace(e),null!=M?a(S,h,null):S[h].unhalt(),r.finalizeRecord(S)}return u.prototype._array=void 0,u.prototype._events=void 0,u.prototype._id=void 0,u.prototype._idProperty=void 0,u.prototype._options=void 0,u.prototype._parent=void 0,u.prototype._parentKey=void 0,u.prototype._pseudo=void 0,u.prototype._saved=void 0,u.prototype._clone=function(e,t){var r,n,o,i,s,a,l,c,p;if(i=this,r={},e){c=i[P];for(n in c)a=c[n],(null!=a?a._clone:void 0)&&(a=a._clone(1,t)),r[n]=a}else{s={},p=i[P];for(n in p)a=p[n],(null!=a?a._clone:void 0)&&(t||(s[n]=u.getAllStatic(a)),a=a._clone(0,1,1)),r[n]=a;r=new i.constructor(r);for(n in s){a=s[n];for(o in a)l=a[o],r[n][o]=l}}return t||u.getAllStatic(i,r),r},u.prototype._delete=function(){return n.Permission({keys:keys,description:"Read-only Record"})},u.prototype._entity=function(){return this._clone(1)},u.prototype._getProperty=function(e){return p(e,1,1),u.arrayFilter(this[P][e])},u.prototype._replace=function(e,t){var r,o,s,a,p,f,d,g,m;if(null==t&&(t=!0),d=this,a=d[h],null===a&&n.Permission({key:d[v],description:"can not replace subobject"}),g=!0,c(e))p=function(){var t,r,n;for(n=[],t=0,r=e.length;r>t;t++)m=e[t],n.push(m);return n}(),u.arrayify(d),o=1,r=d[y],r._tracker.set=function(e,t){return d._setProperty(e,t,g)},p.length&&r.push.apply(r,p)&&(o=1);else{u.dearrayify(d),p={};for(f in e)m=e[f],p[f]=m;if(s=d[_][i])for(f in s)m=s[f],l(p,f)||(p[f]=s._default(f));for(f in p)m=p[f],u.getterify(d,f),d._setProperty(f,m,g)&&(o=1)}for(f in d[P])l(p,f)||(delete d[f],delete d[P][f],o=1);return o&&a&&t&&u.emitUpdate(d,"replace"),g=!1,!!o},u.prototype._setProperty=function(e,t,r){var i,s;return i=this,s=i[P],r||n.Permission({key:e,value:t,description:"Read-only Record"}),u.valueCheck(i,e,t),l(s,e)&&o.identical(t,i[e])?!1:(a(s,e,u.valueWrap(i,e,t),0,1),u.getterify(i,e),!0)},u.arrayFilter=function(e){var t,r,n,o,i,u,s,c;if(!(t=null!=e?e[y]:void 0))return e;for(i=e,o={};i&&i.constructor!==Object;){for(c=Object.getOwnPropertyNames(i),u=0,s=c.length;s>u;u++)n=c[u],n===y||"_"!==n.substr(0,1)||l(o,n)||(o[n]=Object.getOwnPropertyDescriptor(i,n));i=Object.getPrototypeOf(i)}for(n in t)"_record"===n||"_"!==n.substr(0,1)||l(o,n)||delete t[n];for(n in o)r=o[n],Object.defineProperty(t,n,r);return a(t,"_record",e),t},u.arrayify=function(t){var r;return a(t,y,r=[]),new e(r,{store:t[P],get:function(e){return t._getProperty(e)},set:function(e,r){return t._setProperty(e,r)},del:function(e){return t._delete(e),!1}})},u.checkIdProperty=function(e){var t,r,o,i,u;if(r=function(){return n.Value({item:o,description:"idProperty items must be key conform"})},null!=e)for(t=c(e)?e:[e],t.length||r(),i=0,u=t.length;u>i;i++)o=t[i],p(o)||r()},u.dearrayify=function(e){return delete e[y]},u.emitUpdate=function(e,t,r){var n,o,i,s,a,l,c,p;for(null==r&&(r={}),a=[],l=e;!(n=l[h]);)a.unshift(l[v]),l=l[m];o={node:e},e!==l&&(o.parent=l,o.path=a),o.action=t;for(i in r)c=r[i],o[i]=c;s=l[g],u.setId(l),l[h]._halt||null!=(p=l[m])&&p._recordChange(l,o,s),n.emit("update",o)},u.getAllStatic=function(e,t){var r,n;null==t&&(t={});for(r in e)n=e[r],l(Object.getOwnPropertyDescriptor(e,r),"value")&&(t[r]=n);return t},u.getterify=function(e,t){l(e,t)||s(e,t,function(){return e._getProperty(t)},function(r){return e._setProperty(t,r)},1)},u.setId=function(e){var t,r,o,u,s,l,f,d,y,h;if(s=function(t){var r,o;(r=e[_][i])&&(null==r[t]&&n.ContractBreak({key:t,contract:r,mismatch:"idProperty"}),"string"!==(o=r[t].type)&&"number"!==o&&n.ContractBreak({key:t,contract:r,required:"string or number"}),null==e[t]&&n.ContractBreak({key:t,value:e[t],mismatch:"idProperty value must exist (not nullable)"}))},null!=(u=e._idProperty))if(c(u)){for(t=[],r=y=0,h=u.length;h>y;r=++y)if(l=u[r],s(l),p(d=e[l]))t.push(d);else if(!r)break;f=e[u[0]],o=t.length?t.join("-"):f,a(e,g,o),a(e,b,f)}else s(u),a(e,g,e[u]);else a(e,g),a(e,b)},u.valueCheck=function(e,t,r){var o;p(t,1,1),(o=e[_][i])?o._match(e[y]?"all":t,r):("string"==typeof t&&"_"===t.substr(0,1)&&n.ArgumentType({key:t,argument:1,description:'can not start with "_"'}),"function"==typeof r&&n.Value({value:r,description:"can not be function"}))},u.valueWrap=function(e,t,r){var n,o,s,a;return o=e[_][i],f(r)&&(r._clone&&(r=r._clone(1)),n=e[_].subtreeClass||u,o&&(a=(s=o[t])?s.array?{contract:{all:s.array}}:{contract:s[i]}:{contract:o.all.contract}),r=new n(r,a,e,t)),r},u}()}]),ksc.factory("ksc.RestList",["$http","$q","ksc.List","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,i,u){var s,a,l,c,p;return a="restCache",l="restPending",s="_primaryId",p=u.defineValue,c=function(r){function a(){var e;return e=a.__super__.constructor.apply(this,arguments),null==e.idProperty&&o.MissingArgument({required:"idProperty is mandatory for RestList"}),e}return __extends(a,r),a.prototype.restCache=void 0,a.prototype.restPending=0,a.prototype.restGetRaw=function(t,r){var u,s,a,c,f,d,y;return"function"==typeof t&&(r=t,t=null),a=this,(u=a.options.endpoint)&&(d=u.url)&&"string"==typeof d||o.Type({"options.endpoint.url":d,required:"string"}),p(a,l,a[l]+1,0,1),(f=n.get(d,t))||(t&&(c=function(){var e;e=[];for(s in t)y=t[s],e.push(encodeURIComponent(s)+"="+encodeURIComponent(y));return e}(),c.length&&(d+=(d.indexOf("?")>-1?"&":"?")+c.join("&"))),f=e.get(d)),i.wrapPromise(f,function(e,t){return p(a,l,a[l]-1,0,1),r(e,t)})},a.prototype.restLoad=function(e,t,r){var n,o,u;return"boolean"!=typeof e&&(r=t,t=e,e=null),"function"==typeof t&&(r=t,t=null),o=this,u=o.options,n=function(){return o.restGetRaw(t,function(e,t){var n,i,u;if(!e)try{n=a.getResponseArray(o,t.data),i=o.push.apply(o,__slice.call(n).concat([!0]))}catch(s){u=s,e=u}return"function"==typeof r?r(e,i,t):void 0})},u.cache&&o.restCache&&!e?r&&i.wrapPromise(o.restCache,r):p(o,"restCache",n(),0,1),o.restCache},a.prototype.restSave=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,1,t,e)},a.prototype.restDelete=function(){var e,t,r;return t=2<=arguments.length?__slice.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],a.writeBack(this,0,t,e)},a.getResponseArray=function(e,t){var r,n,i,u;if(r=e.options.endpoint,i="responseProperty","undefined"==typeof r[i]){Array.isArray(t)&&(r[i]=null);for(n in t)u=t[n],Array.isArray(u)&&(r[i]=n)}return null!=r[i]&&(t=t[r[i]]),t instanceof Array||o.Value({"options.endpoint.responseProperty":void 0,description:"array type property in response is not found or unspecified"}),t},a.relatedRecords=function(e,t){var r,n,o,i,u;if(null==(r=t[s]))return[t];for(u=[],o=0,i=e.length;i>o;o++)n=e[o],n[s]===r&&u.push(n);return u},a.updateOnSave=function(e,r,n,o){var i,u,a,l,c,p,f,d,y,h,g,_,m,v,b,k;for(f=[],h=[],a=m=0,b=r.length;b>m;a=++m)y=r[a],null!=(c=y[s])||e.options.reloadOnUpdate?(d={},l=e.idProperty,c?d[l[0]]=c:d[l]=y._id,f.push(e.restLoad(d))):h.push([y,n[a]]);if(h.length){e.events.halt(),i=[],_=e.events.on("1#!update",function(e){return i.push(e.action.update[0])});try{for(v=0,k=h.length;k>v;v++)g=h[v],y=g[0],u=g[1],y._replace(u)}finally{_(),e.events.unhalt()}i.length&&e.events.emit("update",{node:e,action:{update:i}})}f.length?(p=t.all(f),p.then(o,o)):o()},a.writeBack=function(e,t,r,n){var i,l,c,p,f,d,y,h,g,_,m;for(n&&"function"==typeof n||(n&&r.push(n),n=null),g={},c=_=0,m=r.length;m>_;c=++_)y=r[c],u.isObject(y)||(r[c]=y=e.idMap[y]),f=y,d=null,h="id:"+(p=null!=y?y._id:void 0),null==(p=null!=y?y._id:void 0)?(d=null!=y?y._pseudo:void 0,h="pseudo:"+d):null!=y[s]&&(h="id:"+y[s]),t?(y=d&&e.pseudoMap[d]||e.idMap[p],y||o.Key({key:f,description:"no such record on list"})):(y=e.idMap[p])||o.Key({key:f,description:"no such record on .idMap"}),g[h]&&o.Value({uid:h,description:"not unique"}),g[h]=y;return r.length||o.MissingArgument({name:"record",argument:1}),l=e.options.endpoint||{},t&&l.bulkSave?(i=String(l.bulkSave).toLowerCase(),"post"!==i&&(i="put"),a.writeBulk(e,i,r,n)):!t&&l.bulkDelete?a.writeBulk(e,"delete",r,n):a.writeSolo(e,t,r,n)},a.writeBulk=function(t,r,n,u){var c,p,f,d,y,h,g;return(g=t.options.endpoint.url)&&"string"==typeof g||o.Type({"options.endpoint.url":g,required:"string"}),h="delete"!==r,p=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)y=n[e],h?r.push(y._entity()):(null==(f=y[s])&&(f=y._id),r.push(f));return r}(),c=[g],h&&c.push(p),t[l]+=1,d=e[r].apply(e,c),i.wrapPromise(d,function(e,r){var o,i,s,c;for(t[l]-=1,o=function(){return"function"==typeof u?u(e,i,r):void 0},i=[],s=0,c=n.length;c>s;s++)y=n[s],i.push.apply(i,a.relatedRecords(t,y));return e||(h?a.updateOnSave(t,n,r.data,o):(t.cut.apply(t,i),o())),o()})},a.writeSolo=function(t,r,n,u){var c,p,f,d,y;return y=[],c=d=null,p=function(e){var t;return t=Array.prototype.slice.call(arguments,1),c=[e,y].concat(__slice.call(t)),d?void 0:("function"==typeof u&&u.apply(null,c),c=null)},f=function(n){var p,f,h,g,_,m,v;return null==(f=n[s])&&(f=n._id),h="delete",_=null!=(m=t.options.record.endpoint)?m.url:void 0,r&&(h="put",n._pseudo&&(h="post",f=null,_=null!=(v=t.options.endpoint)?v.url:void 0)),_&&"string"==typeof _||o.Value({"options.record.endpoint.url":_,required:"string"}),_=_.replace("<id>",f),p=[_],r&&p.push(n._entity()),t[l]+=1,g=e[h].apply(e,p),i.wrapPromise(g,function(e,o){var i;t[l]-=1,i=a.relatedRecords(t,n),e||(r?(d=(d||0)+1,a.updateOnSave(t,[n],[o.data],function(){return d-=1,c&&"function"==typeof u?u.apply(null,c):void 0})):t.cut.apply(t,i)),y.push.apply(y,i)})},i.asyncSquash(n,f,p)},a}(r)}]),ksc.factory("ksc.RestRecord",["$http","ksc.Record","ksc.batchLoaderRegistry","ksc.error","ksc.restUtil","ksc.util",function(e,t,r,n,o,i){var u,s,a,l,c;return u="_options",s="_restCache",a="_restPending",c=i.defineValue,l=function(t){function i(){c(this,a,0),i.__super__.constructor.apply(this,arguments)}return __extends(i,t),i.prototype._restCache=null,i.prototype._restPending=0,i.prototype._restLoad=function(t,n){var a,l;return l=this,a=function(){var t,o;return o=i.getUrl(l),(t=r.get(o))||(t=e.get(o)),i.async(l,t,n)},"boolean"!=typeof t&&(n=t,t=null),l[u].cache&&l[s]&&!t?n&&o.wrapPromise(l[s],n):c(l,s,a()),l[s]},i.async=function(e,t,r){return c(e,a,e[a]+1),o.wrapPromise(t,function(t,n){return c(e,a,e[a]-1),!t&&n.data&&e._replace(n.data),"function"==typeof r?r(t,n):void 0})},i.getUrl=function(e){var t,r;return(t=e[u].endpoint)&&null!=(r=t.url)||n.Value({"_options.endpoint.url":void 0}),"string"!=typeof r&&n.Type({"_options.endpoint.url":r,required:"string"}),r},i}(t)}]),ksc.service("ksc.restUtil",["$q","ksc.error",function(e,t){var r;return r=function(){function r(){}return r.asyncSquash=function(n,o,i){var u,s,a,l,c,p,f;return u=0,s=[],c=n.length,f=[],a=function(e,r){var n,o,a,l;return o=r.data,l=r.status,a=r.headers,n=r.config,u+=1,null!=e&&s.push(e),f.push({error:e,data:o,status:l,headers:a,config:n}),u===c&&i?(t=null,1===s.length?t=s[0]:s.length&&(t=s),i.apply(null,[t].concat(__slice.call(f)))):void 0},p=function(){var e,t,i;for(i=[],e=0,t=n.length;t>e;e++)l=n[e],i.push(r.wrapPromise(o(l),a));return i}(),p.length<2?p[0]:e.all(p)},r.wrapPromise=function(e,r){var n,o;return o=function(e){var t,n,o,i,u;return n=e.data,i=e.status,o=e.headers,t=e.config,u=e,r(null,u)},n=function(e){var n,o,i,u,s,a;return o=e.data,s=e.status,u=e.headers,n=e.config,a=e,i=new t.type.Http(e),a.error=i,r(i,a)},e.then(o,n),e},r}()}]),ksc.service("ksc.util",["ksc.error",function(e){var t,r,n,o,i,u,s,a;return n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,r=function(t){return t.length?void 0:e.MissingArgument({name:"reference",argument:1})},t=function(){function t(){}return t.defineGetSet=function(e,t,r,o,i){return"function"!=typeof o&&(i=o,o=void 0),n(e,t,{configurable:!0,enumerable:!!i,get:r,set:o})},t.defineValue=function(e,t,r,o,u){var s;return(null!=(s=i(e,t))?s.writable:void 0)===!1&&n(e,t,{writable:!0}),n(e,t,{configurable:!0,enumerable:!!u,value:r,writable:!!o})},t.empty=function(){var t,r,n,o,i,u,s,l,c;for(i=1<=arguments.length?__slice.call(arguments,0):[],i.length||e.MissingArgument({argument:1}),a.apply(this,i)||e.Type({arguments:i,required:"All arguments must be objects"}),u=0,l=i.length;l>u;u++)if(o=i[u],Array.isArray(o))for((t=o.pop)||(t=Array.prototype.pop),r=s=0,c=o.length;c>s;r=s+=1)t.call(o);else for(n in o)__hasProp.call(o,n)&&delete o[n]},t.hasOwn=function(e,t,r){return e&&e.hasOwnProperty(t)&&(null==r||r===e.propertyIsEnumerable(t))},t.hasProperty=function(e,t){for(;e;){if(e.hasOwnProperty(t))return!0;e=u(e)}return!1},t.identical=function(e,r){var n,o;if(!a(e,r))return e===r;e._array&&(e=e._array),r._array&&(r=r._array);for(n in e)if(o=e[n],!t.identical(o,r[n])||!s(r,n))return!1;for(n in r)if(!s(e,n))return!1;return!0},t.isEnumerable=function(e,t){try{return!!i(e,t).enumerable}catch(r){}return!1},t.isKeyConform=function(t,r,n){var o;return"string"==typeof t&&t||"number"==typeof t&&!isNaN(t)?!0:(r&&("string"!=typeof r&&(r="Key conform value"),o={key:t,description:r},n?(o.argument=n,e.ArgumentType(o)):e.Key(o)),!1)},t.isFunction=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],"function"!=typeof e)return!1;return!0},t.isObject=function(){var e,t,n,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],r(t),n=0,o=t.length;o>n;n++)if(e=t[n],!e||"object"!=typeof e)return!1;return!0},t.mergeIn=function(){var t,r,n,o,i,u,s,l;for(i=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],o.length<1&&e.MissingArgument({required:"Merged and mergee objects"}),a(i)||e.Type({target_object:i,argument:1,required:"object"}),t=s=0,l=o.length;l>s;t=++s){n=o[t],a(n)||e.Type({object:n,argument:t+2,required:"object"});for(r in n)u=n[r],i[r]=u}return i},t.propertyRefs=function(t){var r,n,o;for(o={};a(t);){r=!0;for(n in t)__hasProp.call(t,n)&&(Array.isArray(o[n])||(o[n]=[]),o[n].push(t));t=u(t)}return r||e.ArgumentType({object:t,argument:1,accepts:"object"}),o},t.uid=function(e){var r,n;return n=null!=t._uidStore?t._uidStore:t._uidStore={named:{}},null!=e?(t.isKeyConform(e,1),r=n.named):(r=n,e="unnamed"),r[e]=(r[e]||0)+1},t}(),o=t.defineValue,s=t.hasOwn,a=t.isObject,t}]);